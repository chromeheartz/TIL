## 에러다루기

### 02. try ~ catch

---

예외를 처리하는 `try ~ catch` 문법

#### 왜 예외를 처리한다 라고 할까?

`클라이언트` 단에서 마주칠 수 있는 문제인데 사용자의 입력을 받을 때가 있다. 이런때에 문제가 생기는데 프로그램에서 `모든 버그를 수정하고 감지` 할 수 있다면 좋지만 사실 모든 에러를 찾아내는건 어렵고 불가능에 가깝다.

```js
try {
  // 예외가 예상되는 코드 혹은 발생시킬 코드
} catch (error) {
  // 예외를 처리하는 코드
} finally {
}
```

사용자가 어떻게 사용하고 어떤 에러를 일으킬지 모든것을 예측할수는 없기 때문이다. 이런때에 사용하는 것이 `예외 처리` 이다.

```js
function handleSubmit(input) {
  // 중요하지 않다고 생각하는 핸들링
  try {
    // 예외가 예상되는 코드 혹은 발생시킬 코드
  } catch (error) {
    // 예외를 처리하는 코드
  } finally {
  }
}
```

보통 가장 많이 하는 실수는 `중요하지 않다고 생각하는 핸들링` 을 `try` 문에 넣지 않는 실수가 있다.
⭐️ `사용자의 input` 을 받는 순간 모든 것은 중요한데, 중요하지 않다고 허술하게 생각해서 아무이유없이 `try` 에는 `서버 통신 / 정규식` 만 넣었다가 낭패를 보는 경우가 있다.

✅ `함수 안에서 try / catch` 를 사용한다면 모든것을 `try / catch` 안에 포함시키는 것이 예측하지 못한 에러 유발을 줄인다

```js
try {
  // 예외가 예상되는 코드 혹은 발생시킬 코드
  try {
  } catch (error) {
  } finally {
  }
} catch (error) {
  // 예외를 처리하는 코드
} finally {
}
```

또한 중첩으로 `try / catch` 를 넣는 경우가 있는데, 이런 경우를 방지하기 위해 `try / catch` 는 `함수 단위` 로 사용하고, 그리고 안 쓸 경우에는 그 함수가 사용될 곳에서 처리를 해주면 좋다.

```js
function util() {
  return; // some code
}

function handleSubmit(input) {
  // 중요하지 않다고 생각하는 핸들링
  try {
    // 예외가 예상되는 코드 혹은 발생시킬 코드
    util();
  } catch (error) {
    // 예외를 처리하는 코드
  } finally {
  }
}
```

해당 `util` 함수에서 무언가 코드를 넣는데 함수 단위에서 사용해야 한다고 했으니 예외를 util 사용하는 코드에서 처리하면 된다. 모든 함수에 `try / catch` 를 넣으면 피곤.

#### 에러 던지기

```js
function handleSubmit(input) {
  // 중요하지 않다고 생각하는 핸들링
  try {
    // 예외가 예상되는 코드 혹은 발생시킬 코드
  } catch (error) {
    // 1. 개발자를 위한 에러처리 => 동료 개발자에게 ~~~ TDZ
    console.error(error);
    console.warn(error);

    // 2. 사용자를 위한 예외처리 => 사용자가 볼 수 있다고 생각
    // alert(error) // X
    alert("잠시만 기다려주세요, 문제가 있으니 다시 시도해주세요"); // O

    // 3. 사용자에게 사용을 제안 => 어딘가로 이동 시켜서 사용자에게 알려주기
    history.back();

    // 4. 에러 로그 수집
    sentry.전송();

    // 5. 재귀 호출
    handleSubmit();
  } finally {
  }
}
```

`console.error(error)` 자주 하는 실수가 이렇게 콘솔에 에러만 던지는 것인데 `catch` 문에서 해야할 중요한 예외처리가 있다.

- 개발자를 위한 예외처리 `TDZ`
- 사용자를 위한 예외처리
  - 서버가 주는 에러 그대로 노출하지 않기
- 사용자에게 사용을 제안
  - 안전한 어딘가로 이동
  - 어떠한 엘리먼트로 focus
  - ...
- 에러 로그 수집
  - `sentry` 같은것으로 에러를 수집
- 재귀 호출
  - 비추천하지만 간혹 필요한 경우가 있다.

### 📌 정리

> ✅ `try / catch` 를 사용해서 예외처리를 할 수 있는데 이를 잘 활용하는 방법이 중요하다. 개발자끼리 뿐만 아니라 사용자를 위한 예외처리를 하는 것도 중요하고, 에러 로그를 수집해서 어떠한 에러가 많이 발생하는지 캐치하는것도 좋다.
