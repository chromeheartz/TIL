## React-Redux

### 04. redux-thunk

---

### 📌 비동기

미들웨어는 여러개를 연결할 수 있는데 `redux-thunk` 를 사용할것이다

> `redux-thunk`
> 비동기를 제어하는 미들웨어

기본적으로 미들웨어는 `3단 함수` 로 구성이 되고 기본 액션은 `return dispatch(action)` 이다.
기존 것과는 다른게 추가되는데 `typeof action === 'function'` 조건이 추가된다.

기존에는 액션을 객체라고 얘기했는데, 리덕스와 약속을 하는 개념이다. 객체말고 `함수를 액션으로 두겠다` 라고 명시하는 뜻.

> ⭐️ 기본적으로 액션은 `동기` 라고 했는데, 동기면 `객체` 다.
> 근데 `비동기` 라는것을 구별해주기 위해 `객체 대신 함수` 를 넣어주기로 하는것.
> 사실 함수가 아니라 객체로도 처리가 가능한데 `thunk` 라는 것은 이렇게 처리를 한다.

```js
const thunkMiddleware = (store) => (dispatch) => (action) => {
  if (typeof action === "fnunction") {
    // 비동기
    return action(store.dispatch, store.getState);
  }
  return dispatch(action);
};
```

함수면 실행할 수 있고 그 안에 `store.dispatch, store.getState` 가 들어간다.

#### 이렇게 액션 함수에 `두 개의 인수` 를 넣어서 실행하면 어디로 전달될까?

여기서 중요한 포인트가 나오는데 `비동기 액션` 은 다 함수로 만들것이다. `액션 크리에이터` 와 구별점이 필요해지는것.

```js
// user.js
const logIn = (data) => {
  // async action creator
  return (dispatch, getState) => {
    dispatch(logInRequest(data)); // action creator
    setTimeout(() => {
      dispatch(
        logInSuccess({
          userId: 1,
          nickname: "bibiboy",
        })
      );
    }, 2000);
  };
};

const logInRequest = (data) => {
  // action creator
  return {
    type: "LOG_IN_REQUEST",
    data,
  };
};

const logInSuccess = () => {
  // action creator
  return {
    type: "LOG_IN_SUCCESS",
  };
};
```

이런 형태로 `async action creator` 는 객체를 반환하는 것이 아닌 `함수` 를 반환한다. 함수에 들어갈 인자로는 `action(store.dispatch, store.getState)` 여기서 넣어준 값을 받을 수 있다. 임의로 만들었으니 순서는 상관없다.

`setTimeout` 은 시뮬레이션 하기 위해 서버에서 응답이 오는 시간을 임의로 만든것. `request, success` 는 `동기 액션`. 결국 비동기도 어떻게 보면 눈속임이다.

> 비동기도 `비동기 액션 크리에이터` 라는 기능을 `미들웨어` 를 통해 추가한 다음 동기를 한번 부르고 그 다음 비동기 작업안에서 비동기 작업이 끝날 때 동기를 한번 더 부르고 동기들 간의 액션 순서를 조작하는 그런 정도이다.

여기서 눈여겨볼 점은 `logIn` 에서 `data` 를 매개변수를 통해서 받아서 `logInRequest` 에 넘겨주는것.
