## React-Redux

### 08. immer

---

### ğŸ“Œ Immer

`...prevState` ëŠ” ì‚¬ì‹¤ ë§¤ìš° ì§ê´€ì ì´ì§€ ì•Šì€ ë°©ë²•ì´ë‹¤.
ì§ê´€ì ì¸ ë°©ë²•ì€ `state.data = null` ì´ëŸ°ì‹ì´ ì§ê´€ì ì´ë‹¤.
â­ï¸ `ë¶ˆë³€ì„±` ì„ ì§€í‚¤ê¸° ìœ„í•´ í•˜ëŠ” ê²ƒì¸ë° ê¹Šì–´ì§€ë©´ ë” ì§€ì €ë¶„ í•´ì§ˆ ìˆ˜ ìˆë‹¤.

```js
// ë¶ˆë³€ì„±
deep: {
  ...prevState.deep,
  deeper: {
    ...prevState.deeper,
    deepest: {
      ...prevState.deepest,
        a: 'b',
    }
  }
}

// ì§ê´€ì 
state.data = null;
state.deep.deeper.deepest.a = 'b';
```

ê¹Šê²Œ ë“¤ì–´ê°€ ìˆëŠ” ê°ì²´ë¥¼ ë°”ê¾¸ë ¤ë©´ ë¦¬ë•ìŠ¤ì—ì„œëŠ” `ë¶ˆë³€ì„±` ì½”ë“œ ì²˜ëŸ¼ ê¸¸ê²Œ ì¨ì•¼ í•œë‹¤.
ê·¸ë˜ì„œ ì´ëŸ°ê²ƒì„ í¸í•˜ê²Œ í•´ì£¼ëŠ” ê²ƒì´ `Immer` ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
ê¸°ì¡´ì— `ì´ë®¤í„°ë¸”` ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ìˆì—ˆì§€ë§Œ ë”°ë¡œ ê³µë¶€í•´ì•¼í•  ì •ë„ì¸ë° `Immer` ëŠ” ë”°ë¡œ ê³µë¶€í•  í•„ìš” ì—†ì´ ì§ê´€ì ì´ë‹¤.

> `Recap`
> `ë¦¬ë“€ì„œì˜ ì—­í• ` ì€ `action` ì´ ìˆìœ¼ë©´ `action` ì„ `dispatch` í–ˆì„ ë•Œ ê·¸ ì•¡ì…˜ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤í…Œì´íŠ¸ë¥¼ ë§Œë“¤ì–´ ë‚¸ë‹¤. ë¦¬í„´ ê°’ì€ `ë‹¤ìŒ ìŠ¤í…Œì´íŠ¸`

ê²°êµ­ ì´ì „ ìŠ¤í…Œì´íŠ¸ì™€ ì•¡ì…˜ì„ ë°›ì•„ì„œ ë‹¤ìŒ ìŠ¤í…Œì´íŠ¸ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” í•¨ìˆ˜ê°€ `ë¦¬ë“€ì„œ` ì¸ë°, `Immer` ë„ ë˜‘ê°™ë‹¤.

```js
// Immer default
nextState = produce(prevState, (draft) => {});
```

ì´ í˜•íƒœê°€ `Immer` ì˜ ê¸°ë³¸ ê¼´ì´ë‹¤.
`produce` ë¼ëŠ” í•¨ìˆ˜ëŠ” `ì´ì „ ìŠ¤í…Œì´íŠ¸, ì•¡ì…˜ ê°™ì€ ë¶€ë¶„` ì„ ë°›ì•„ì„œ ë‹¤ìŒ ìŠ¤í…Œì´íŠ¸ë¥¼ ë§Œë“¤ì–´ ë‚¸ë‹¤.
`reducer` ì•ˆì— `return` êµ¬ë¬¸ì„ ë§Œë“¤ì–´ `produce` ê¸°ë³¸ í˜•íƒœë¥¼ ë„£ì–´ì£¼ê³  ê·¸ ì•ˆì— ê¸°ì¡´ì— ì¼ë˜ `switch` êµ¬ë¬¸ì„ ë„£ì–´ì£¼ë©´ ì¤€ë¹„ê°€ ëœê²ƒì´ë‹¤.

ğŸ“ `draft`

`draft` ëŠ” `prevState` ë‘ ë˜‘ê°™ì€ë° `ë³µì‚¬ë³¸` ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.
`prevState` ìì²´ë¥¼ ë°”ê¾¸ë©´ ë¶ˆë³€ì„±ì´ ê¹¨ì§€ê²Œ ë˜ë‹ˆ ë°”ê¾¸ë©´ ì•ˆë˜ê³  ëŒ€ì‹  ë³µì‚¬ë³¸ì¸ `draft` ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆì–´ì§„ë‹¤.

```js
// ê¸°ì¡´
...prevState,
isLoggingIn: true,

// Immer
const userReducer = (prevState = initialState, action) => {
  return produce(prevState, (draft) => {
    switch (action.type) {
      case "LOG_IN_REQUEST":
        draft.data = null;
        draft.isLoggingIn = true;
        break;
      case "LOG_IN_SUCCESS":
        draft.data = action.data;
        draft.isLoggingIn = false;
        break;
      case "LOG_IN_FAILURE":
        draft.data = null;
        draft.isLoggingIn = false;
      case "LOG_OUT":
        draft.data = null
      default:
        return prevState;
    }
  });
};
```

ì—„ì²­ `ì§ê´€ì ` ì¸ ì½”ë“œë¡œ ë°”ë€ë‹¤. ì‹¤ì œë¡œ í”„ë¡œì íŠ¸ë¥¼ ì­‰ ì§„í–‰í•˜ë‹¤ë³´ê²Œë˜ë©´ ë¶ˆë©´ì„±ì„ ì§€í‚¤ê¸° ìœ„í•´ ì—„ì²­ ê¸¸ì–´ì§€ëŠ” ê²½ìš°ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤. ì˜ˆì‹œì½”ë“œë¥¼ ë³´ë©´ í•­ìƒ `ì–•ì€ ë³µì‚¬ ë¶ˆë³€ì„±` ì„ ì§˜ë ¤ê³  ë‚´ê°€ ë°”ê¾¸ê³  ì‹¶ì€ ê³³ê¹Œì§€ ì°¾ì•„ë‚´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸´ë‹¤. `Immer` ì™€ëŠ” ì°¨ì´ê°€ í¬ë‹¤.

```js
// example code
const postIndex = state.mainPosts.findIndex((v) => v.id === action.data.postId);
const post = { ...state.mainPosts[postIndex] };
post.Comments = [dummyComment(action.data.content), ...post.Comments];
const mainPosts = [...state.mainPosts];
mainPosts[postIndex] = post;
return {
  ...state,
  mainPosts,
  addCommentLoading: false,
  addCommentDone: true,
};

// Immer
const post = draft.mainPosts.find((v) => v.id === action.data.PostId);
post.Comments.unshift(action.data);
draft.addCommentLoading = false;
draft.addCommentDone = true;
```

### ğŸ“Œ ì‹¤í–‰

í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í–ˆë˜ ë¬¸ë²•ì´ ì•„ì§ ì •ì‹ ë¬¸ë²•ì´ ì•„ë‹ˆë¼ì„œ ë°”ë²¨ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•´ì¤€ë‹¤

```
npm i @babel/plugin-proposal-class-properties
```

ì¶”ê°€ë¡œ `webbpack.config` ë¥¼ ì„¤ì •í•´ì¤˜ë„ ì‹¤í–‰ì´ ì•ˆë˜ê³  ìˆë‹¤.
ë†“ì¹˜ê³  ìˆì—ˆë˜ ë¶€ë¶„ì€ `App.jsx` ì—ì„œ `class App` ë¶€ë¶„ì— `extends Component` ë¡œ ìƒì†ì„ ë°›ì•„ì•¼í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
