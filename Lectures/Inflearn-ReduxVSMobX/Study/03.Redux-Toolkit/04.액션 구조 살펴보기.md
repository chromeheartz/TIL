## Redux-Toolkit

### 04. ì•¡ì…˜ êµ¬ì¡° ì‚´í´ë³´ê¸°

---

### ğŸ“Œ ì•¡ì…˜ êµ¬ì¡° ì‚´í´ë³´ê¸°

ì‹¤ì œ ì‚¬ìš©í•œë‹¤ê³  ìƒê°ì„ í–ˆì„ ë•Œ `logOut` ì²˜ëŸ¼ ì–´ë–¤ ìŠ¬ë¼ì´ìŠ¤ì— ì¢…ì†ë˜ì–´ ìˆëŠ” ì• ë“¤ì€

```js
const onLogout = useCallback(() => {
  dispatch(userSlice.actions.logOut());
}, []);
```

ì¦‰, ë™ê¸° ì•¡ì…˜ë“¤ì€ `slice.actions` ì— ìˆë‹¤. âœ… `ë¹„ë™ê¸°` ë©´ ì¢…ì†ë˜ì–´ ìˆë”ë¼ë„ `extraReducers` ë¡œ ê°€ê¸° ë•Œë¬¸ì— ë”°ë¡œ ë¹ ì§€ê²Œ ëœë‹¤.

### ğŸ“Œ getDefaultMiddleware

```js
// ê¸°ì¡´
const store = configureStore({
  reducer,
  middleware: [firstMiddleware, ...getDefaultMiddleware],
  devTools: process.env.NODE_ENV !== "production",
});

// ìˆ˜ì •
const store = configureStore({
  reducer,
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(firstMiddleware),
  devTools: process.env.NODE_ENV !== "production",
});
```

`getDefaultMiddleware` ê°€ ê¸°ì¡´ì— ê°•ì¢Œì—ì„œ í–ˆë˜ ë°©ì‹ëŒ€ë¡œí•˜ë©´ ì˜¤ë¥˜ê°€ ë‚˜ì„œ ê³µì‹ë¬¸ì„œë¥¼ ë³´ê³  ìˆ˜ì •í–ˆë‹¤.

> **getDefaultMiddleware DOCS ğŸ‘‰ [`getDefaultMiddleware`]**

[`getDefaultMiddleware`]: https://redux-toolkit.js.org/api/getDefaultMiddleware

### ğŸ“Œ redux devtools í™•ì¸

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-12-28 á„‹á…©á„Œá…¥á†« 11 32 20](https://github.com/chromeheartz/TIL/assets/95161113/3a6adf47-e966-4b16-9d85-35220796ae98)

`redux devtools` ë¥¼ ë³´ë©´ `init` ì´ë‹ˆì…œ ìŠ¤í…Œì´íŠ¸ëŠ” ì•Œì•„ì„œ ì˜ ë“¤ì–´ê°€ìˆê³  ë¡œê·¸ì¸ì„ ëˆ„ë¥´ê²Œë˜ë©´ `ë¹„ë™ê¸° ì•¡ì…˜` ì´ê¸° ë•Œë¬¸ì— `pending => fulfilled` ë¡œ ì§„í–‰ì´ ë˜ê³ , `action.payload` ì— ë“¤ì–´ì˜¨ ê°’ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

`logOut` ì€ ë™ê¸°ì´ê¸°ë•Œë¬¸ì— `pending` ì´ ë”°ë¡œ ì•ˆë‚˜ì˜¨ë‹¤.

### ğŸ“Œ throw new Error

í˜„ì‹¤ì ì¸ ë¡œê·¸ì¸ ì—ëŸ¬ë¥¼ í™•ì¸ í•´ë³´ê¸° ìœ„í•´ `throw new Error` ë¡œ ë˜ì§€ë©´ ì—ëŸ¬ê°€ ë‚˜ê¸° ë•Œë¬¸ì— `Rejected` ìƒíƒœê°€ ë‚˜ì˜¤ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

```js
exports.logIn = createAsyncThunk("user/logIn", async (data, thunkAPI) => {
  throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  return await delay(500, {
    userId: 1,
    nickname: "bibi",
  });
});
```

ì¢€ ë” êµ¬ì²´ì ì¸ ë°ì´í„°ëŠ” `action` ì—ì„œ ë³´ë©´ ë˜ëŠ”ë° íœë”©ì¼ë•Œë¥¼ ë³´ë©´ `meta=>arg` ì— ë“¤ì–´ìˆë‹¤.
ì´ ëœ»ì€ `action.meta.arg` ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-12-29 á„‹á…©á„’á…® 2 52 34](https://github.com/chromeheartz/TIL/assets/95161113/7e1218d3-76b2-45d4-90f2-cf69f1317ee6)

âœ… íˆ´í‚·ì˜ íŠ¹ì§•ìœ¼ë¡œëŠ” `ìš”ì²­ë§ˆë‹¤ ë¦¬í€˜ìŠ¤íŠ¸ ì•„ì´ë””` ë¥¼ ë¶™ì—¬ì¤€ë‹¤. ìš”ì²­ ì•„ì´ë””ëŠ” ê°™ì€ ìš”ì²­ì„ ì—¬ëŸ¬ë²ˆ í–ˆì„ ë•Œ ì–´ë–¤ê²Œ ì–´ë–¤ ìš”ì²­ì¸ì§€ë¥¼ êµ¬ë¶„í•  ë•Œ ì‚¬ìš©ëœë‹¤.
ë§¤ë²ˆ `ëœë¤` í•˜ê²Œ ë§Œë“¤ì–´ì§.

> ë¹„ë™ê¸° ìš”ì²­ 3ë²ˆì„ ë³´ë‚´ë©´ ê·¸ 3ë²ˆë§ˆë‹¤ ê°ê° ë‹¤ë¥¸ ê²ƒì„ í•´ì£¼ê³  ì‹¶ê±°ë‚˜ ê°ê° ë¡œë”© ìƒíƒœë¥¼ ë”°ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ê±°ë‚˜í•˜ë©´ ë¦¬í€˜ìŠ¤íŠ¸ ì•„ì´ë””ë¥¼ ì‚¬ìš©í•´ì„œ ìƒíƒœ/ì—ëŸ¬ê°€ ì–´ë–¤ ìš”ì²­ì— ì†í•´ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê¸° ì‰½ë‹¤.
> ì¦‰, í˜„ì¬ ìŠ¤í¬ë¦°ìƒ·ì˜ `pending / rejected` ë‘˜ì˜ requestIdëŠ” ê°™ìŒ.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-12-29 á„‹á…©á„’á…® 3 20 25](https://github.com/chromeheartz/TIL/assets/95161113/011b0c76-2486-4832-8755-699e1ace0cf3)

ì´ëŸ°ì‹ìœ¼ë¡œ ë¹„ë™ê¸°ê°€ ì¼ì–´ë‚˜ê²Œ ë¼ë„ ê²°êµ­ `requestId` ë¥¼ í™•ì¸í•˜ë©´ ê°ê°ì˜ ì§ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤ëŠ” ëœ».

ë™ê¸° ì•¡ì…˜ì€ ì‹¤íŒ¨í•  ë¦¬ê°€ ì—†ì„ê²ƒì´ë‹¤. ë¬¸ë²• ì—ëŸ¬ ì´ëŸ°ê²ƒì´ ìˆì§€ ì•ŠëŠ”ì´ìƒ. ì¦‰, ë™ê¸° ì•¡ì…˜ì€ ì„±ê³µ ìƒíƒœë§Œ ìˆê¸° ë•Œë¬¸ì— `Action.payload` ë§Œ ìˆë‹¤.
ì‹¤íŒ¨í–ˆì„ë•Œì—ëŠ” `Action.error` / `meta` ëŠ” ì²˜ìŒì— ë„£ì–´ì¤¬ë˜ ë°ì´í„°ë¡œ ë³´ë©´ ëœë‹¤.

#### âœ… Immer ì‚¬ìš©ì‹œ ë¶ˆë³€ì„±ì´ ê¹¨ì§€ëŠ” ê²½ìš°

`state = 123` ì´ëŸ° ê²ƒì´ ìƒê¸°ê¸´ í•˜ëŠ”ë° ì´ëŸ´ë•Œì— ë¶ˆë³€ì„±ì´ ê¹¨ì§€ê²Œ ëœë‹¤. ìŠ¤í…Œì´íŠ¸ ìì²´ë¥¼ ë°”ê¾¸ëŠ” ê²½ìš°.
íŠ¹íˆ `ìŠ¬ë¼ì´ìŠ¤` ë¥¼ ì˜ê²Œ ìª¼ê°¤ ìˆ˜ë¡ ê°ì²´ê°€ ì•„ë‹ˆë¼ ë‹¨ìˆœí•œ ê°’ì„ ê°€ì§„ ìŠ¬ë¼ì´ìŠ¤ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ”ë° `return state` ë¥¼ í•´ì„œ ë‚´ë³´ë‚´ì£¼ì–´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸´ë‹¤.
`push` ê°™ì€ ê²ƒì„ ì¨ì„œ ë¶ˆë³€ì„±ì´ ëŠê¸°ê²Œí•˜ë©´ ì§ì ‘ ëª…ì‹œì ìœ¼ë¡œ `return`

> ì¢€ ë” ì¢‹ì€ ë°©ë²•ì€ `builder` ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
> `addCase` ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë° ìš”ì ì€ `ì²´ì´ë‹` ì‹ìœ¼ë¡œ êµ¬í˜„ì´ ëœë‹¤.
> âœ… ì´ê±¸ ì¶”ì²œí•˜ëŠ” ì´ìœ ëŠ” ì¶”í›„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ì‹œ `íƒ€ì… ì¶”ë¡ ` ì´ ì˜ëœë‹¤.

```js
const postSlice = createSlice({
  name: "post",
  initialState,
  reducers: {},
  extraReducers: (builder) =>
    builder
      .addCase(addPost.pending, (state, action) => {})
      .addCase(addPost.fulfilled, (state, action) => {
        state.list.push(action.payload);
      })
      .addCase(addPost.rejected, (state, action) => {}),
});
```

#### íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì•ˆì“¸ê±°ë©´ ì–´ë–»ê²Œ í•¨?

`builder` ë¥¼ ì•ˆì¨ë„ ë˜ëŠ”ë° ë” ì¢‹ì€ì ì´ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `reducer` ì—ëŠ” ë””í´íŠ¸ê°€ ìˆëŠ”ë° ìŠ¤ìœ„ì¹˜ë¬¸ì˜ ë””í´íŠ¸ë¥¼ ì–´ë–»ê²Œ í• ì§€ ì‘ì„±í•  ìˆ˜ ìˆë‹¤

```js
.addDefaultCase((state, action) => {
  // default
}),
```

ë˜í•œ `addMatcher` ê°€ ìˆì–´ì„œ ì•ìœ¼ë¡œ ì½”ë”©ì„ í•´ë‚˜ê°€ë‹¤ë³´ë©´ `pending / fulfilled / rejected` ê°€ ì„¸íŠ¸ë¡œ 3ê°œì”© ìŒ“ì´ê²Œ ë˜ëŠ”ë° ê³µí†µì ì¸ ë¶€ë¶„ë“¤ì„ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ìˆë‹¤.
`pending` ì˜ ì¡°ê±´ì„ ì¡ì•„ì„œ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ìˆëŠ”ê²ƒì´ë‹¤.

```js
.addMatcher((action) => {
  return action.type.includes('/pending')
}, (state, action) => {
  state.isLoading = true;
})
```

ì´ê²Œ í•„ìš”í•œ ì´ìœ ëŠ” ë³´í†µ ìŠ¤ìœ„ì¹˜ë¬¸ìœ¼ë¡œ í–ˆì„ ë•Œ ê³µí†µì ì¸ ê²ƒì„ í• ë•Œì— `CASE` ë¥¼ ë™ì‹œì— ì¼ì—ˆëŠ”ë° ì´ë ‡ê²Œ ì ì§€ ì•Šì•„ë„ `addMatcher` ë¥¼ ì‚¬ìš©í•´ì„œ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ”ê²ƒì´ë‹¤.

```js
switch() {
  CASE 'add_pending':
  CASE 'update_pending:
    state.isLoading = true;
    break;
}
```
