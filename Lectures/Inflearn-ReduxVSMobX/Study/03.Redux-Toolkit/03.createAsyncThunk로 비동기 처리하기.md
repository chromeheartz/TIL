## Redux-Toolkit

### 03. createAsyncThunkë¡œ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ê¸°

---

### ğŸ“Œ createAsyncThunk

```js
// actions/post.js
const { createAsyncThunk } = require("@reduxjs/toolkit");

const delay = (time, value) =>
  new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(value);
    }, time);
  });

exports.addPost = createAsyncThunk("post/add", async (data, thunkAPI) => {
  return await delay(500, data);
});
```

ì‹¤ì œ ì„œë²„ê°€ ì—†ë‹¤ë³´ë‹ˆ ì„œë²„ë¥¼ í‰ë‚´ë‚´ê¸° ìœ„í•´ `ë”œë ˆì´` ê°€ í•„ìš”í•˜ë‹¤.
ë”œë ˆì´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ êµ¬í˜„í•´ë†“ì•˜ë‹¤. ì´ë ‡ê²Œ í”„ë¡œë¯¸ìŠ¤ë¡œ ê°€ì§œ ë”œë ˆì´ê°€ ìˆë‹¤ê³  ì¹˜ë©´ `result` ëŠ” 500msì´ˆ ë’¤ì— ë°ì´í„°ë¥¼ ì‘ë‹µí•œë‹¤ê³  í•´ì¤„ê²ƒì´ë‹¤.

âœ… ì‚¬ì‹¤ì€ ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ì´ëŸ°ê²ƒë“¤ì„ ì„œë²„ìª½ìœ¼ë¡œ ë³´ë‚¸ ë‹¤ìŒì— ì‘ë‹µì„ ë°›ì•„ì„œ ì˜¤ëŠ” ê²ƒ. ê·¸ ì‹œê°„ì„ êµ¬í˜„í–ˆë‹¤ê³  ê°€ì •

```js
// actions/user.js
const logIn = createAsyncThunk("user/logIn", async (data, thunkAPI) => {
  console.log(data);
  // const state = thunkAPI.getState();
  const result = await delay(500, {
    userId: 1,
    nickname: "bibi",
  });
  return result;
  // data return
});
```

â­ï¸ ì—¬ê¸°ì„œ í•œê°€ì§€ íŒì€ `Async Await` ì—ëŠ” `Try Catch` ë¬¸ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì€ë° `createAsyncThunk` ì—ì„œëŠ” ì‚¬ìš©ì„ ì•ˆí•˜ëŠ”ê²Œ ì¢‹ë‹¤. ì™œëƒí•˜ë©´ `Try Catch` ë¡œ ê°ì‹¸ë²„ë¦¬ë©´ ì—ëŸ¬ê°€ ë°œìƒì„ ì•ˆí•˜ê¸° ë•Œë¬¸. ì—ëŸ¬ê°€ ë°œìƒì„ í•´ì•¼ `thunk` ê°€ `rejected` ìƒíƒœë¡œ ê°€ê²Œ ë˜ëŠ”ë°, ì—ëŸ¬ê°€ ì—†ìœ¼ë©´ ë¬´ì¡°ê±´ ì„±ê³µìƒíƒœ `FullFilled` ìƒíƒœë¡œ ë„˜ì–´ê°€ê²Œ ë˜ëŠ”ê²ƒì´ë‹¤.

#### `(data, thunkAPI)` ì—ì„œ dataëŠ” ì–´ë””ì„œ ì˜¤ëŠ” ê²ƒì¼ê¹Œ?

ë¡œê·¸ì¸ì„ ì‹¤ì œë¡œ ê°€ì ¸ë‹¤ ì“¸ë•Œì—ëŠ” ì•¡ì…˜ì—ì„œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©ì„ í•˜ê²Œ ë˜ëŠ”ë° ì¦‰, `dispatch(logIn({...}))` ... ë¶€ë¶„ì´ dataê°€ ë˜ëŠ”ê²ƒì´ë‹¤.

```js
// reducers/user.js
const userSlice = createSlice({
  name: "user",
  initialState,
  reducers: {
    logOut(state, action) {
      state.data = null;
    },
  },
  extraReducers: {
    [logIn.pending](state, action) {
      state.isLoggingIn = true;
    },
    [logIn.fulfilled](state, action) {
      state.data = action.payload;
      state.isLoggingIn = true;
    },
    [logIn.rejected](state, action) {
      state.data = null;
      state.isLogginIn = false;
    },
  },
});
```

ì´ì œ `logIn` ì„ sliceì— ë„£ì–´ì£¼ì–´ì•¼ í•˜ëŠ”ë° `ë¹„ë™ê¸°` ëŠ” `extraReducers` ì— ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤. ê´€ê³„ê°€ ìˆë”ë¼ë„ ì¼ë‹¨ ë¹„ë™ê¸°ëŠ” `extra` ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

ğŸ“ `[logIn.pending]` ì´ ë¬¸ë²•ì€ `ê°ì²´ì˜ ë™ì  ë‹¤ì´ë‚˜ë¯¹ ì†ì„±` ì´ë¼ëŠ” ë¬¸ë²•ì´ë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ `immer` ê°€ ì ìš©ë˜ì–´ ìˆì–´ ì¡°ê¸ˆ ì§ê´€ì ìœ¼ë¡œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.

âœ… `action` ì— ë“¤ì–´ìˆëŠ” dataëŠ” `payload` ì´ë‹¤.
ì „ì—ëŠ” ì•¡ì…˜ê°™ì€ê±° ë§Œë“¤ë©´ ì•¡ì…˜ ì•ˆì— ì‘ë‹µìœ¼ë¡œ ì´ë©”ì¼, íŒ¨ìŠ¤ì›Œë“œë¥¼ ë„£ì„ ìˆ˜ ìˆì—ˆëŠ”ë° ì´ì œ ììœ ë¡­ê²Œ ë„£ì„ ìˆ˜ ìˆëŠ”ê²ƒì´ ì•„ë‹ˆë¼ `íˆ´í‚·` ì€ ë¬´ì¡°ê±´ ì•¡ì…˜ì— ëŒ€í•œ ë°ì´í„°ëŠ” `action.payload` ë¡œ í•˜ë‚˜ë¡œ ë”± í•©ì³ë†“ì•˜ë‹¤. ì¦‰, ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´ë‚´ë©´

- `action.payload.email`
- `action.payload.password`

ë¡œ ë“¤ì–´ìˆì„ ê²ƒ

#### ê·¸ëŸ¼ ë­ê°€ payloadê°€ ë˜ëŠ”ê±¸ê¹Œ?

```js
const result = await delay(500, {
  userId: 1,
  nickname: "bibi",
});
return result;
```

`action` ì—ì„œ ë„£ì–´ì£¼ì—ˆë˜ `return` ê°’.
