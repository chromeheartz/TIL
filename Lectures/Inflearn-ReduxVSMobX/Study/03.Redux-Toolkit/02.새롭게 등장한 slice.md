## Redux-Toolkit

### 02. ìƒˆë¡­ê²Œ ë“±ì¥í•œ slice
---------------------------------------------

### ğŸ“Œ Hook => Toolkit

âœ… `Toolkitìœ¼ë¡œ ë°”ê¿€ ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ì `

`reducer` ê°€ í™• ë°”ë€Œê²Œ ëœë‹¤. ë” ë§ì•„ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë” ì“°ê¸° ì‰¬ìš´ ë°©ë©´ìœ¼ë¡œ.


```js
// ê¸°ì¡´ reducer
const { combineReducers } = require("redux");
const userReducer = require("./user");
const postReducer = require("./post");

module.exports = combineReducers({
  user: userReducer,
  posts: postReducer,
});

// Toolkit reducer
const { combineReducers } = require("redux");
const userSlice = require("./user");
const postSlice = require("./post");

module.exports = combineReducers({
  user: userSlice.reducer,
  posts: postSlice.reducer,
});
```

â­ï¸ `slice` ë¡œ ë°”ê¾¸ê²Œ ë˜ë©´ `combineReducers` ì—ì„œ sliceë¥¼ ë„£ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ ê·¸ ì•ˆì— ë“¤ì–´ìˆëŠ” `reducer` ë¥¼ ë„£ì–´ì•¼í•œë‹¤. ìŠ¬ë¼ì´ìŠ¤ëŠ” `reducer` ë‘ ê°™ì€ ê²ƒì´ ì•„ë‹ˆë¼ `reducer / action` ë“¤ì„ ë¬¶ì–´ë†“ì€ ê²ƒì´ê¸° ë•Œë¬¸.

ì—¬ê¸°ì„œ ì²˜ìŒìœ¼ë¡œ `slice` ê°œë…ì´ ë‚˜ì˜¤ê²Œ ë˜ëŠ”ë° ì´ ìŠ¬ë¼ì´ìŠ¤ëŠ” ë‹¨ìˆœíˆ ë¦¬ë“€ì„œ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ê²ƒë“¤ì„ í•©ì³ë†“ì€ ê°œë…ì´ë‹¤. `reducer / action / initialState` ë“±ì´ ë“¤ì–´ìˆë‹¤.

> **ì™œ ì´ê²ƒë“¤ì„ í•©ì³¤ì„ê¹Œ?**
ì˜ ìƒê°í•´ë³´ë©´ ë³´í†µ ì–´ë– í•œ `ì•¡ì…˜` ì€ ì–´ë–¤ `ë¦¬ë“€ì„œ` ì— ì¢…ì†ë˜ì–´ìˆê¸° ë§ˆë ¨ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ` ì´ ìˆë‹¤ê³ í•˜ë©´ ê·¸ ì•¡ì…˜ë“¤ì€ ë³´í†µ ë‹¤ ìœ ì €ë§Œ ë°”ê¾¼ë‹¤. ìœ ì €ë§Œ ì¡°ì‘í•˜ê³  ëŒ€ë¶€ë¶„ì˜ ì•¡ì…˜ë“¤ì´ ì–´ë–¤ íŠ¹ì •í•œ ë¦¬ë“€ì„œ ì•ˆì— ì¢…ì†ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë‚˜ëˆ„ì§€ë§ê³  í•©ì³ë²„ë¦¬ìëŠ” ê°œë…ìœ¼ë¡œ ìƒê¸´ê²Œ `Slice`
â­ï¸ ì¦‰, `Reducer / Action` ìê¾¸ í•˜ë‚˜ë¡œ ë­‰ì³ì„œ í•˜ë‚˜ì˜ ê·¸ë£¹í™”ê³¼ ë˜ëŠ”ë° ì•„ì˜ˆ ê·¸ë£¹ìœ¼ë¡œ ë§Œë“¤ì–´ë²„ë¦¬ì. ê°€ ëœê²ƒ

### ğŸ“Œ Slice

`reducers/user.js`

```js
// ê¸°ì¡´
const initialState = {
  isLoggingIn: false,
  data: null,
};

const userReducer = (prevState = initialState, action) => {
  switch (action.type) {
    case "LOG_IN_REQUEST":
      return {
        ...prevState,
        isLoggingIn: true,
      };
    case "LOG_IN_SUCCESS":
      return {
        ...prevState,
        data: action.data,
        isLoggingIn: false,
      };
    case "LOG_IN_FAILURE":
      return {
        ...prevState,
        data: null,
        isLoggingIn: false,
      };
    case "LOG_OUT":
      return {
        ...prevState,
        data: null,
      };
    default:
      return prevState;
  }
};

module.exports = userReducer;
```

```js
// slice
const userSlice = createSlice({
  name: "user",
  initialState,
  reducers: {
    logOut(state, action) {
      state.data = null;
    },
  },
  extraReducers: {},
});

module.exports = userSlice;
```

`createSlice` ì•ˆì— ë“¤ì–´ê°ˆ ê²ƒë“¤
- `name` : ë§ ê·¸ëŒ€ë¡œ ì´ë¦„ì´ë‹¤. ë¦¬ë“€ì„œì˜ ì´ë¦„ì„ ë„£ì–´ì£¼ëŠ” ê³³
- `initialState` : ì´ˆê¸°ê°’
- `reducers / extraReducers` : ê° ì•¡ì…˜ë“¤ì˜ íŠ¹ì„±ì— ë§ê²Œ ë„£ì–´ì¤€ë‹¤.
  - `reducers` : ë™ê¸°ì , ë‚´ë¶€ì ì¸ ê²ƒ
  - `extraReducers` : ë¹„ë™ê¸°ì , ì™¸ë¶€ì ì¸ ê²ƒ
  
  ì¦‰ ì •ë¦¬í•˜ìë©´ `post reducer` ì—ì„œ ì“°ì¼ ê²ƒë“¤ë§Œ `reducers` ì— ë„£ì–´ì£¼ê³  ë¹„ë™ê¸°ì ì¸ ì•¡ì…˜ì´ë‚˜ post reducer ë°”ê¹¥ì— ìˆëŠ” ì•¡ì…˜ë“¤ì€ `extraReducers` ì— ë„£ì–´ì¤€ë‹¤.

```jsx
reducers: {
  logOut(state, action) {
    state.data = null;
  },
},
```

`logOut` ì´ ë™ê¸°ì ì´ë¼ê³  ê°€ì •ì„ í•˜ë©´, `reducers` ì•ˆì— ë„£ì–´ì¤„ í…ë° ë³´í†µ ë¡œê·¸ì•„ì›ƒì´ë¼ëŠ” ì•¡ì…˜ì„ `action` ì—ì„œ ë§Œë“¤ì–´ì„œ ì¼ì—ˆëŠ”ë° ì´ì œ `toolkit` ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì•¡ì…˜ì„ ë”°ë¡œ ë§Œë“¤ì–´ì¤„ í•„ìš”ê°€ ì—†ë‹¤. `ì•¡ì…˜ í¬ë¦¬ì—ì´í„° í•¨ìˆ˜` ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì„ ì•Œì•„ì„œ í•´ì£¼ëŠ”ê²ƒì´ë‹¤.

ì¦‰, `app` ì—ì„œ ì‚¬ìš©í•˜ë ¤ê³  í• ë•Œ `user slice` ë¥¼ ê°€ì ¸ì˜¤ë©´ ëœë‹¤.

```jsx
const userSlice = require("./reducers/user");

const onLogout = useCallback(() => {
  dispatch(userSlice.logOut());
}, []);
```

ì´ë ‡ê²Œ í•´ì£¼ë©´ íˆ´í‚·ì´ ì•Œì•„ì„œ `logOut` ì•¡ì…˜ì„ ë§Œë“¤ì–´ì¤€ë‹¤.
sliceì—ì„œ ê·¸ëƒ¥ reducerì•ˆì— `logOut` ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆì„ ë¿ì¸ë° `sliceê°€ action` ì„ ë§Œë“¤ì–´ì¤€ë‹¤.

âœ… `ë¹„ë™ê¸°` ì ì¸ ê²ƒë“¤ì€ `extraReducers` ì— ë“¤ì–´ê°€ëŠ”ë° ë¹„ë™ê¸°ì ì¸ ê²ƒì€ ëŒ€ë¶€ë¶„ `ë„¤íŠ¸ì›Œí¬ ìš”ì²­` ì„ ë§ì´ í•œë‹¤. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ `thunk` ë¥¼ ì‚¬ìš©.

> â­ï¸ ê¸°ì¡´ì— `action` í´ë” ì•ˆì— `ë™ê¸° / ë¹„ë™ê¸°` ì•¡ì…˜ì„ ë‹¤ ëª°ì•„ë†“ì•˜ë‹¤ë©´ ì´ì œ ì´ ê³µê°„ì€ `ë¹„ë™ê¸° ì•¡ì…˜ë§Œì˜ ê³µê°„` ì´ ë ê²ƒì´ë‹¤. ë™ê¸° ì•¡ì…˜ë“¤ì€ `slice` ì— `reducers` ì•ˆì— ë“¤ì–´ê°€ìˆì„í…Œë‹ˆ í•„ìš”ê°€ ì—†ê³ , action í´ë”ì—ì„œ `Thunk` ë¥¼ ì‚¬ìš©í• ê²ƒì´ë‹¤.

```js
// actions/user.js
const logIn = createAsyncThunk('user/logIn', async (data, thunkAPI) => {
  // const state = thunkAPI.getState();
  
  // data return
})
```

ê¸°ì¡´ì— ì‘ì—…í–ˆë˜ `logIn` ì„ ë°”ê¾¸ê²Œ ë˜ë©´ `createAsyncThunk` ë¥¼ ê°€ì ¸ì™€ì„œ `ì•¡ì…˜ì˜ ì´ë¦„` ì„ ì ê³  ê·¸ ì´í›„ì— ì•¡ì…˜í˜¸ì¶œí•  ë•Œ ë°›ëŠ” ë°ì´í„°, thunkAPIë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
`thunkAPI` ì—ì„œëŠ” `getState` ë“±ìœ¼ë¡œ í˜„ì¬ ë¦¬ë“€ì„œì˜ `state` ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê³  ì´ê²ƒì„ í†µí•´ì„œ `state.user.data`  ì´ëŸ°ì‹ì˜ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

`async` í•¨ìˆ˜ë¼ì„œ `return` ì„ í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë° ê·¸ ë°ì´í„°ëŠ” `success` ì˜ ë°ì´í„°ë¡œ ë“¤ì–´ê°€ê³  ë§Œì•½ `error` ê°€ ë‚˜ë©´ `failure` ì˜ ì—ëŸ¬ê°€ ë˜ëŠ”ê²ƒì´ë‹¤.

> â­ï¸ `Thunk` ì—ì„œëŠ” `loading, success, failure` ë¼ëŠ” ìš©ì–´ë¥¼ `pending, fullfilled, rejected` ìš©ì–´ë¡œ ì‚¬ìš©í•œë‹¤.