## ë³€ì´(Mutation): React Queryë¡œ ì„œë²„ ë°ì´í„° ì—…ë°ì´íŠ¸í•˜ê¸°
### 45. ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬
<hr>

### ğŸ“Œ ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬(Query Key Prefixes)

ëª©í‘œëŠ” `Appointments` ì—ì„œ ë³€ì´ë¥¼ ì‹¤í–‰í•  ë•Œ `ëª¨ë“  ì˜ˆì•½ ê´€ë ¨ ì¿¼ë¦¬` ë¥¼ ë¬´íš¨í™”í•˜ëŠ” ê²ƒì´ë‹¤.
ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬ë¡œ ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- â­ï¸ `invalidateQueries` ëŠ” `ì •í™•í•œ í‚¤` ê°€ ì•„ë‹Œ `ì ‘ë‘ì‚¬` ë¥¼ ì‚¬ìš©í•œë‹¤.
- `ë™ì¼í•œ ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬` ë¡œ `ì„œë¡œ ê´€ë ¨ëœ ì¿¼ë¦¬ë¥¼` ì„¤ì •í•˜ë©´ `ëª¨ë“  ì¿¼ë¦¬ë¥¼ í•œë²ˆì— ë¬´íš¨í™”` í•  ìˆ˜ ìˆë‹¤.
- `ì •í™•í•œ í‚¤` ë¡œ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´ `{ exact: true }` ë¡œ ì˜µì…˜ì„ ì„¤ì •í•˜ë©´ ëœë‹¤.
- ë‹¤ë¥¸ `queryClient ë©”ì†Œë“œ` ë„ `removeQueries` ì™€ ê°™ì€ ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•œë‹¤.

#### Query Key Prefix for Appointments

- **ğŸ”‘ `user ppointments` ì—ì„œì˜ ì¿¼ë¦¬ í‚¤**
`[ queryKeys.appointments, queryKeys.user, user?.id ]` 
- **ğŸ”‘ `appointments` ì—ì„œì˜ ì¿¼ë¦¬ í‚¤**
`[ queryKeys.appointments, queryMonthYear.year, queryMonthYear.month ]`

`appointments` ë™ì¼í•œ ì¿¼ë¦¬ í‚¤ë¥¼ `ì ‘ë‘ì‚¬` ë¡œ ê°€ì§€ê³ ìˆê³ , ê°ê° í•„ìš”ë¡œ í•˜ëŠ” ê°’ë“¤ì„ `ì˜ì¡´ì„±` ìœ¼ë¡œ í¬í•¨ì‹œí‚¨ í˜•íƒœì¼ê²ƒì´ë‹¤.

ë”°ë¼ì„œ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•˜ê¸° ìœ„í•œ ì ‘ë‘ì‚¬ë¡œ `[ queryKeys.appointments ]` ë¥¼ ì „ë‹¬í•˜ë©´ ë‘ ê°€ì§€ ëª¨ë‘ ë¬´íš¨í™”ëœë‹¤.

â­ï¸ ë³µì¡í•œ ì•±ì˜ ê²½ìš° `ì „ì²´ì ì¸ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´` ì¿¼ë¦¬ í‚¤ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤. 
í˜„ì¬ ì—¡ì—ì„œëŠ” ì˜ˆì•½ì—ëŒ€í•œ ë¬¸ìì—´ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  `ì¿¼ë¦¬ í‚¤ ê°ì²´` ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

> **query-keys docs ğŸ‘‰ [`query-keys docs`]**
**query-matching-invalidateQueries docs ğŸ‘‰ [`query-matching-invalidateQueries docs`]**

### ğŸ“Œ CODE

`useReserveAppointment` ì˜ `onSuccess`, `useAppointments.ts` ì˜ `useQuery, perfetchQuery` ë“¤ì€ ê°ê° `queryKeys.appointments` ë¼ëŠ” ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë‹ˆ ì—…ë°ì´íŠ¸í•  í•„ìš”ê°€ ì—†ë‹¤.

â—ï¸ `useUserAppointments.ts`

`'user-appointments'` ë¬¸ìì—´ì˜ ì¿¼ë¦¬ í‚¤ë¥¼ ë„£ì–´ë†“ì•˜ì§€ë§Œ ì¼ê´„ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬ë¥¼ ìˆ˜ì •. ê·¸ëŸ° ë‹¤ìŒ ì‚¬ìš©ì ì˜ˆì•½ì„ì„ ì•Œê¸° ìœ„í•´ `queryKeys.user, user?.id` ë¥¼ ì¶”ê°€.
ì¿¼ë¦¬ í‚¤ë¥¼ ì—…ë…ì´íŠ¸ í–ˆìœ¼ë‹ˆ `useUser` ì—ì„œ `ì œê±°í•  ë•Œ` ë„ ì—…ë°ì´íŠ¸í•´ì£¼ì–´ì•¼í•œë‹¤.

â—ï¸ `useUser.ts`

`removeQueries` ì— ê°™ì€ ì¿¼ë¦¬í‚¤ ì ‘ë‘ì‚¬ë¥¼ ë„£ì–´ì£¼ê³  `querykeys.user` ë¥¼ ë„£ëŠ”ë° ì´ êµ¬ë¬¸ ì „ì— `queryClient.setQueryData(queryKeys.user, null)` ë¡œ ì‚¬ìš©ìë¥¼ ì´ë¯¸ ë¬´íš¨í™” í–ˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ì IDì— ì•¡ì„¸ìŠ¤í•  í•„ìš”ëŠ” ì—†ë‹¤. â­ï¸ `removeQueries` ë„ `ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬` ë¥¼ ì‚¬ìš©í•œë‹¤.
ë”°ë¼ì„œ ì¿¼ë¦¬ í‚¤ì— ì§€ì •í•´ì¤€ ê²ƒì´ ìˆì–´ì„œ ë”°ë¡œ ì‚¬ìš©ì IDë¥¼ ì§€ì •í•  í•„ìš”ê°€ ì—†ë‹¤.

```ts
// useUserAppointments.ts
export function useUserAppointments(): Appointment[] {
  const { data: userAppointments = fallback } = useQuery(
    [queryKeys.appointments, queryKeys.user, user?.id],
    () => getUserAppointments(user),
    { enabled: !!user },
  );

  return userAppointments;
}

    
// useUser.ts
function clearUser() {
    queryClient.setQueryData(queryKeys.user, null);
    queryClient.removeQueries([queryKeys.appointments, queryKeys.user]);
}
```

[`query-keys docs`]: https://tanstack.com/query/latest/docs/react/guides/query-keys?from=reactQueryV3&original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Fguides%2Fquery-keys

[`query-matching-invalidateQueries docs`]: https://tanstack.com/query/latest/docs/react/guides/query-invalidation?from=reactQueryV3&original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Fguides%2Fquery-invalidation#query-matching-with-invalidatequeries

