## ë³€ì´(Mutation): React Queryë¡œ ì„œë²„ ë°ì´í„° ì—…ë°ì´íŠ¸í•˜ê¸°
### 41. ë³€ì´(Mutation)ì™€ ë³€ì´ ì „ì—­ ì„¤ì •
<hr>

### ğŸ“Œ React Query Mutations

ê¸°ì¡´ì— `ë³€ì´ ì‘ì—…` ì„ ì—°ìŠµí•´ë³´ì•˜ì„ ë•ŒëŠ” `JsonPlaceholderServer` ì—¬ì„œ ì„œë²„ ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ë‹¤. ì´ë²ˆ ì•±ì—ì„œëŠ” ì„œë²„ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ ë˜ê¸° ë•Œë¬¸ì— `ì¿¼ë¦¬ ë¬´íš¨í™”` ì— ëŒ€í•´ì„œë„ ë³¼ê²ƒì¸ë° ì´ë¥¼ í†µí•´ì„œ ë°ì´í„°ê°€ `ìºì‹œì—ì„œ ì œê±° ë˜ê³  ë¦¬íŒ¨ì¹˜(Refetch)` ë¥¼ íŠ¸ë¦¬ê±° í•  ìˆ˜ ìˆë‹¤.

ì¶”ê°€ë¡œ ë³€ì´ë¥¼ ë³´ë‚´ê³  ì„œë²„ì—ì„œ ìƒˆ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë°›ì„ ë•Œ `ìºì‹œ ì—…ë°ì´íŠ¸` ë¥¼ ìˆ˜í–‰.
ì˜ˆë¥¼ ë“¤ì–´ ì „í™”ë²ˆí˜¸ì™€ ê°™ì€ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´ ì„œë²„ëŠ” `ìºì‹œë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸` í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `ìƒˆ ì‚¬ìš©ì ê°ì²´` ë¥¼ ë°˜í™˜í•œë‹¤.

#### ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (Optimistic Update)

> ë³€ì´ê°€ ì„±ê³µí•˜ê¸°ë¥¼ í¬ë§í•˜ì§€ë§Œ ì‹¤íŒ¨í•˜ë”ë¼ë„ `ë¡¤ë°±` í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸

### ğŸ“Œ Global Fetching / Error

ì¿¼ë¦¬ì— í–ˆë˜ ê²ƒê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ `ë³€ì´ì— ëŒ€í•œ` ì „ì—­ íŒ¨ì¹­ ì¸ë””ì¼€ì´í„° ë° ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ì„¤ì •í• ê²ƒì´ë‹¤.
ì¿¼ë¦¬ì™€ ë§¤ìš° ìœ ì‚¬í•œ í˜•íƒœì¼í…ë° ì˜¤ë¥˜ì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ

- ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ `defaultOptions` ì˜ `mutation` ì†ì„±ì—ì„œ `onError` ì½œë°± ì„¤ì •
  - ì´ ì˜µì…˜ì€ ì§€ê¸ˆê¹Œì§€ ì—…ë°ì´íŠ¸í•œ `ì¿¼ë¦¬ ì†ì„± / ë³€ì´ ì†ì„±` ëª¨ë‘ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
- ë¡œë”© ì¸ë””ì¼€ì´í„°ì˜ ê²½ìš°
  - `useIsMutating` ì´ ìˆìœ¼ë©° `useIsFetching` ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ ë³€ì´ í˜¸ì¶œ ì¤‘ `í˜„ì¬ í•´ê²°ë˜ì§€ ì•Šì€ ê²ƒ` ì´ ìˆëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤. 
  - ë”°ë¼ì„œ `isMutating / isFetching` ì— í‘œì‹œë˜ë„ë¡ Loading ì»´í¬ë„ŒíŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼í•œë‹¤.


### ğŸ“Œ CODE

ì²«ë²ˆì§¸ë¡œ `queryClient` ì— ëŒ€í•œ ê¸°ë³¸ ì˜µì…˜ê°’ì„ ì„¤ì •í•´ì¤€ë‹¤. `mutations` ë„ `ì˜¤ë¥˜ ì²˜ë¦¬ ê¸°ë³¸ê°’` ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡. ì¶”ê°€ë¡œ Loadingì— ìˆëŠ” `ë¡œë”© ì¸ë””ì¼€ì´í„°` ì—ì„œ `isMutating` ì„ ê°€ì ¸ì™€ì„œ ì‚¬ìš©.
`useIsMutating` ì€ í˜„ì¬ í•´ê²°ë˜ì§€ ì•Šì€ `mutation` ë“¤ì„ ê°œìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. 

```tsx
// queryClient.ts
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      ...
    },
    mutations: {
      onError: queryErrorHandler,
    },
  },
});
  
// Loading.tsx
const isMutating = useIsMutating();
const display = isFetching || isMutating ? 'inherit' : 'none';

<Text display="none">Loading...</Text>
```

> **`useIsMutating` ê´€ë ¨ ë¬¸ì„œ ğŸ‘‰ [`docs`]**

### ğŸ“Œ ì „ì—­ ë®¤í…Œì´ì…˜ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ë¥¼ ì§€ì •í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•

`21. useIsFetching / onError Callback` ê¸€ì—ì„œ ì „ì—­ ì¿¼ë¦¬ ì˜¤ë¥˜í•¸ë“¤ëŸ¬ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” ëŒ€ì²´ ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ëŠ”ë°, `mutation` ë˜í•œ ë§ˆì°¬ê°€ì§€ë¡œ ì ‘ê·¼ ë°©ì‹ì´ ì ìš©ëœë‹¤.
`QueryClient` ê°ì²´ ì¸ìˆ˜ì— `mutationCache` ë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.

```tsx
export const queryClient = new QueryClient({
  queryCache: new QueryCache({
    onError: queryErrorHandler,
  }),
  mutationCache: new MutationCache({
    onError: queryErrorHandler,
  }),
  defaultOptions: {
    ...
  }
})
```

[`docs`]: https://tanstack.com/query/v4/docs/react/reference/useIsMutating