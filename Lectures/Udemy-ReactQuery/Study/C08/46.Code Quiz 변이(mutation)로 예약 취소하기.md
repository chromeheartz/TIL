## ë³€ì´(Mutation): React Queryë¡œ ì„œë²„ ë°ì´í„° ì—…ë°ì´íŠ¸í•˜ê¸°
### 46. Code Quiz. ë³€ì´(Mutation)ë¡œ ì˜ˆì•½ ì·¨ì†Œí•˜ê¸°
<hr>

### ğŸ“Œ Goal

- `useCancelAppointment hook` ì‘ì„±.
- `onSuccess í•¸ë“¤ëŸ¬` ë¥¼ í†µí•´ `ì˜ˆì•½ ì¿¼ë¦¬ ë¬´íš¨í™”` 
- `ì¿¼ë¦¬ í‚¤ ì ‘ë‘ì‚¬` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì•½ ì¿¼ë¦¬ ì§€ì •í•œ í›„ ì‚¬ìš©ìì—ê²Œ ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” `toast UI` 

> `HINT`â—ï¸ `useUser` ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ì˜ˆì•½ì„ ì„¤ì •í•  ë•ŒëŠ” `user.id` ê°€ í•„ìš”í•˜ì§€ë§Œ í•´ì œí•˜ëŠ” ê²½ìš°ì—ëŠ” ì—†ì–´ë„ ë¨. ì‹¤ì œ `production app` ì—ì„œëŠ” ì‚¬ìš©ìê°€ `ë¡œê·¸ì¸ ìƒíƒœ` ì´ë©° ì˜ˆì•½ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŒì„ ì¦ëª…í•˜ëŠ” `í† í°` ì„ ë³´ë‚´ì•¼í•˜ì§€ë§Œ í˜„ì¬ëŠ” ìš”ì²­ì„ ë³´ë‚´ê³  ì‹¶ì€ ì‚¬ëŒì´ë¼ë©´ ëˆ„êµ¬ë‚˜ ì·¨ì†Œ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„.

### ğŸ“Œ CODE

`scaffolding code`

```ts
// useCancelAppointment.ts
import { Appointment } from '../../../../../shared/types';
import { axiosInstance } from '../../../axiosInstance';
import { queryKeys } from '../../../react-query/constants';
import { useCustomToast } from '../../app/hooks/useCustomToast';

// for when server call is needed
// async function removeAppointmentUser(appointment: Appointment): Promise<void> {
//   const patchData = [{ op: 'remove', path: '/userId' }];
//   await axiosInstance.patch(`/appointment/${appointment.id}`, {
//     data: patchData,
//   });
// }

// TODO: update return type
export function useCancelAppointment(): (appointment: Appointment) => void {
  const toast = useCustomToast();

  // TODO: replace with mutate function
  return (appointment: Appointment) => {
    // nothing to see here
  };
}
```

#### ğŸ“ êµ¬í˜„

**Import**
- íƒ€ì´í•‘ì„ í•˜ê¸°ìœ„í•´ `UseMutateFunction`
- í›…ì„ ì‚¬ìš©í•˜ë ¤ëŠ” ê³³ì— mutate í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ `useMutate` 
- ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™” ì‹œí‚¤ê¸° ìœ„í•´ `queryClient`

1ï¸âƒ£ `useMutation` ì„ ì‹¤í–‰í•˜ê³  ë°˜í™˜ê°’ì—ì„œ mutateí•¨ìˆ˜ë¥¼ êµ¬ì¡° ë¶„í•´. `{ mutate }` ì´ ê²ƒì´ `useCancelAppointment` ì—ì„œ í›… ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•  ë‚´ìš©ì´ ëœë‹¤. ê·¸ë˜ì•¼ ì˜ˆì•½ì„ `ì·¨ì†Œ` í•˜ê³  ì‹¶ì„ ë•Œ ì‹¤í–‰í•  ìˆ˜ ìˆì„í…Œë‹ˆ

```tsx
const { mutate } = useMutation();
```

2ï¸âƒ£ `useMutation` ì˜ ë³€ì´ í•¨ìˆ˜ì—ëŠ” ì¸ìˆ˜ë¥¼ ì „ë‹¬ì‹œì¼œì¤€ë‹¤ `appointment`. ê·¸ëŸ° ë‹¤ìŒ useMutationì€ í•´ë‹¹ ì¸ìˆ˜ë¥¼ ë³€ì´ í•¨ìˆ˜ì— ì „ë‹¬í•˜ê³  ê·¸ê²ƒì„ ê°€ì ¸ì™€ `removeAppointmentUser` ì— ì „ë‹¬. `ìµëª… í•¨ìˆ˜` ë¡œ êµ¬í˜„í•˜ê³  ìˆëŠ” ì´ìœ ëŠ” `appointment` ë¥¼ ê°€ì ¸ì™€ì„œ í•¨ìˆ˜ ì‹¤í–‰ë§Œ í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤. ì¸ìˆ˜ ë¶€ë¶„ì„ ì‚­ì œí•´ë„ ë¬´ë°©.

```tsx
(appointment: Appointment) => removeAppointmentUser(appointment),
// ì¸ìˆ˜ ë¶€ë¶„ ì‚­ì œ
removeAppointmentUser,
```

3ï¸âƒ£ `onSuccess í•¸ë“¤ëŸ¬` ì—ì„œ `queryKeys.appointments` ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•˜ê³  `toast UI` ë¡œ ì˜ˆì•½ì´ ì·¨ì†Œë˜ì—ˆìŒì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤€ë‹¤.

```tsx
{
  onSuccess: () => {
    queryClient.invalidateQueries([queryKeys.appointments]);
    toast({
      title: 'You have canceled the appointment!',
      status: 'warning',
    });
  },
},
```

> **â­ï¸ ì˜ë¬¸ì **
ì—¬ê¸°ì„œ í•œê°€ì§€ ì´í•´ê°€ ì•ˆë˜ëŠ” ë¶€ë¶„ì´ ìˆì„ ìˆ˜ ìˆë‹¤. 2ï¸âƒ£ ë¥¼ ë³´ë©´ ì¸ìˆ˜ë¶€ë¶„ì´ ì‚­ì œë˜ì–´ ìµëª…í•¨ìˆ˜ê°€ ì•„ë‹Œê²½ìš° `removeAppointmentUser` ì— ì „ë‹¬ë˜ëŠ” ì¸ìˆ˜ê°€ ì—†ì–´ë³´ì´ëŠ”ë° ì™œ ì œëŒ€ë¡œ ì‘ë™ì„ í• ê¹Œ?
ë¨¼ì € `(appointment: Appointment) => removeAppointmentUser(appointment)` ì´ë¼ëŠ” í•¨ìˆ˜ê°€ `useMutation`ì— ì „ë‹¬ë˜ëŠ”ë° ì´ í•¨ìˆ˜ëŠ” useMutationì—ì„œ `ë‚´ë¶€ì ìœ¼ë¡œ í˜¸ì¶œ` ëœë‹¤.
ì´ë•Œ `í´ë¡œì € ê°œë…` ì´ ì ìš©ë©ë‹ˆë‹¤. removeAppointmentUser í•¨ìˆ˜ëŠ” `ì™¸ë¶€ ë³€ìˆ˜ì¸ appointment` ì— ì ‘ê·¼í•œë‹¤. useMutation ë‚´ë¶€ì—ì„œëŠ” `í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì½œë°±` ìœ¼ë¡œ ì €ì¥í•˜ê³ , ë‚˜ì¤‘ì— ì´ ì½œë°±ì„ í˜¸ì¶œí•  ë•Œ `appointment ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬` í•˜ê²Œ ëœë‹¤. ì´ë ‡ê²Œí•˜ë©´ `í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ìœ„ì¹˜` ì—ì„œ ì™¸ë¶€ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì„œ ì‘ë™í•œë‹¤.
ë”°ë¼ì„œ í•¨ìˆ˜ë¥¼ `removeAppointmentUserë¡œ ì „ë‹¬í•˜ê³  ë§¤ê°œë³€ìˆ˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì „ë‹¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤` . í´ë¡œì €ë¡œ ì¸í•´ `í•¨ìˆ˜ê°€ í•„ìš”í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ìë™` ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤. `JS / TS` ìì£¼ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ì´ë‹¤.


```tsx
// useCancelAppointment.ts
import { UseMutateFunction, useMutation, useQueryClient } from 'react-query';

import { Appointment } from '../../../../../shared/types';
import { axiosInstance } from '../../../axiosInstance';
import { queryKeys } from '../../../react-query/constants';
import { useCustomToast } from '../../app/hooks/useCustomToast';

// for when server call is needed
async function removeAppointmentUser(appointment: Appointment): Promise<void> {
  const patchData = [{ op: 'remove', path: '/userId' }];
  await axiosInstance.patch(`/appointment/${appointment.id}`, {
    data: patchData,
  });
}

// TODO: update return type
export function useCancelAppointment(): UseMutateFunction<
  void,
  unknown,
  Appointment,
  unknown
> {
  const queryClient = useQueryClient();
  const toast = useCustomToast();

  const { mutate } = useMutation(
    (appointment: Appointment) => removeAppointmentUser(appointment),
    {
      onSuccess: () => {
        queryClient.invalidateQueries([queryKeys.appointments]);
        toast({
          title: 'You have canceled the appointment!',
          status: 'warning',
        });
      },
    },
  );

  return mutate;
}
```