## ë³€ì´(Mutation): React Queryë¡œ ì„œë²„ ë°ì´í„° ì—…ë°ì´íŠ¸í•˜ê¸°
### 42. ì»¤ìŠ¤í…€ ë³€ì´ í›…: useReserveAppointments
<hr>

### ğŸ“Œ useMutation

`useMutation` ì„ ì‚¬ìš©í•´ ì˜ˆì•½ì„ ì§„í–‰í•˜ë ¤ëŠ” ì´ìœ ëŠ” `ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•  ê²ƒ` ì´ê¸° ë•Œë¬¸ì´ë‹¤. 
#### `useQuery` ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ì°¨ì´ì ì´ ìˆë‹¤
- `ì¼íšŒì„±` ì´ê¸° ë•Œë¬¸ì— `ìºì‹œ ë°ì´í„°` ê°€ ì—†ë‹¤.
  - `fetching / refetching` ê·¸ë¦¬ê³  ì—…ë°ì´íŠ¸í•  ë°ì´í„°ê°€ ìˆëŠ” useQueryì™€ ë‹¤ë¥´ë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ `ì¬ì‹œë„ê°€ ì—†ë‹¤`. í•˜ì§€ë§Œ ì„ì˜ë¡œ êµ¬ì„±ì´ ê°€ëŠ¥í•˜ë‹¤
- ê´€ë ¨ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ `ë¦¬í˜ì¹˜` ë„ ì—†ë‹¤.
- ìºì‹œëœ ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ `isLoading / isFetching` ì˜ êµ¬ë¶„ì´ ì—†ë‹¤. 
  - `isLoading` ì€ ë°ì´í„°ê°€ ì—†ì„ ë•Œ `ì´ë£¨ì–´ì§€ëŠ” í˜ì¹­` ì´ê¸° ë•Œë¬¸
- ë°˜í™˜ ê°ì²´ì—ì„œ `mutate í•¨ìˆ˜` ë¥¼ ë°˜í™˜í•˜ê³ , ì´ í•¨ìˆ˜ë¡œ ë³€ì´ë¥¼ ì‹¤í–‰í•˜ëŠ”ë° ì‚¬ìš©
- `onMutate callback` ë˜í•œ ìˆëŠ”ë°, `ë‚™ê´€ì  ì¿¼ë¦¬` ì— ì‚¬ìš©. ë³€ì´ê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ `ë³µì›` í•  ìˆ˜ ìˆë„ë¡ `ì´ì „ ìƒíƒœ` ë¥¼ ì €ì¥í•˜ëŠ”ë° ì‚¬ìš©

> **mutation docs ğŸ‘‰ [`mutation docs`]**
**useMutation docs ğŸ‘‰ [`useMutation docs`]**


### ğŸ“Œ CODE

`useReserveAppointment` ëŠ” `AppointmentMutationFunction` ì„ ë°˜í™˜í•˜ëŠ”ë° ì´ë¥¼ í†µí•´ì„œ ìº˜ë¦°ë”ê°€ ì˜ˆì•½ì„ `mutationFunction` ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ì‚¬ìš©ìê°€ ì˜ˆì•½ì„ í•  ìˆ˜ ìˆë„ë¡ `Appointment` ë¥¼ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆë‹¤.

ì¼ë‹¨ ìµœì´ˆë¡œ useMutationêµ¬ë¬¸ì„ ì‘ì„±.
`ë°˜í™˜ ê°ì²´` ì—ì„œ `mutate` í•¨ìˆ˜ë¥¼ ë°˜í™˜í•´ì£¼ê³ , `setAppointmentUser` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í• ê²ƒì¸ë° ì´ëŠ” ë§¤ê°œë³€ìˆ˜ 2ê°œë¥¼ ë°›ëŠ”ë‹¤. `mutate` í•¨ìˆ˜ì— `ì¸ìˆ˜` ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. 
ê·¸ëŸ¬ë©´ `useMutation` ì€ ì´ ì¸ìˆ˜ë¥¼ `ë³€ì´ í•¨ìˆ˜` ì— ì „ë‹¬í•œë‹¤. 
**â—ï¸ useMutationì—ì„œëŠ” `ì¿¼ë¦¬ í‚¤` í•„ìš”í•˜ì§€ ì•ŠìŒ**

`apoointment, user?.id(useUser)` ì´ ë‘ê°€ì§€ë¥¼ ë§¤ê°œë³€ìˆ˜ ìë¦¬ì— ë§ì¶° ë³´ë‚´ì£¼ë©´ ëœë‹¤. 

```tsx
// useReserveAppointment.ts
import { useMutation } from 'react-query';

import { Appointment } from '../../../../../shared/types';
import { axiosInstance } from '../../../axiosInstance';
import { queryKeys } from '../../../react-query/constants';
import { useCustomToast } from '../../app/hooks/useCustomToast';
import { useUser } from '../../user/hooks/useUser';

async function setAppointmentUser(
  appointment: Appointment,
  userId: number | undefined,
): Promise<void> {
  if (!userId) return;
  const patchOp = appointment.userId ? 'replace' : 'add';
  const patchData = [{ op: patchOp, path: '/userId', value: userId }];
  await axiosInstance.patch(`/appointment/${appointment.id}`, {
    data: patchData,
  });
}

// TODO: update type for React Query mutate function
type AppointmentMutationFunction = (appointment: Appointment) => void;

export function useReserveAppointment(): AppointmentMutationFunction {
  const { user } = useUser();
  const toast = useCustomToast();

  const { mutate } = useMutation((appointment) =>
    setAppointmentUser(appointment, user?.id),
  );

  return mutate;
}
```

â­ï¸ í•˜ì§€ë§Œ `Type` ì§€ì •ì„ `void` ë¥¼ ë°˜í™˜í•œë‹¤ê³  í•´ì„œ ì—ëŸ¬ê°€ ë‚˜ëŠ”ë°, ì´ëŠ” `mutate` ë¥¼ `AppointmentMutationFunction` ì— í• ë‹¹í•  ìˆ˜ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤. `@ts-nocheck` ë¥¼ ì¨ì„œ ë¬´íš¨í™”í•´ì£¼ì–´ë„ í˜„ì¬ê¸°ì ì—ì„œëŠ” ê´œì°®ì§€ë§Œ ì‚¬ì‹¤ ì´ë ‡ê²Œí•˜ë©´ `TypeScript` ë¥¼ ì“°ëŠ” ì˜ë¯¸ê°€ ì—†ë‹¤.

[`mutation docs`]: https://tanstack.com/query/latest/docs/react/guides/mutations?from=reactQueryV3&original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Fguides%2Fmutations
[`useMutation docs`]: https://tanstack.com/query/latest/docs/react/reference/useMutation?from=reactQueryV3&original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Freference%2FuseMutation
