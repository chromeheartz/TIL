## React Queryì™€ ì¸ì¦
### 36. React Queryì™€ Auth í†µí•©í•˜ê¸°

### ğŸ“Œ setQueryData

#### ì—¬ê¸°ì„œ ë¬¸ì œëŠ” ë¬´ì—‡ì¼ê¹Œ?

> `const { data: user }` ì—ì„œ userê°€ ì²˜ìŒë¶€í„° ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´ `falsy` ê°’ì´ ë‚˜ì™€ì„œ nullì´ ë°˜í™˜ë˜ê³  ì–´ë–¤ ì‚¬ìš©ì ë°ì´í„°ë„ ê°€ì ¸ì˜¤ì§€ ëª»í•œë‹¤.

#### ê·¸ëŸ¼ userëŠ” ì–´ë–»ê²Œ ì •ì˜í• ê¹Œ?

`updateUser / clearUser` í•¨ìˆ˜ê°€ í•„ìš”í•˜ë‹¤. 
`useAuth` í›…ìœ¼ë¡œ `ì¿¼ë¦¬ ìºì‹œ` ì— ê°’ì„ ì„¤ì •í•´ì•¼ useQuery í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•  ê°’ì´ ìƒê¸¸ê²ƒì´ë‹¤.

âœ… `ì¿¼ë¦¬ ìºì‹œ ê°’ì„ ì„¤ì •` í•˜ì!

`ì¸ì¦ì²˜ë¦¬` ë¥¼ í•  ë•Œ `ì¿¼ë¦¬ ìºì‹œ ê°’ì„ ì„¤ì •` í•´ë†“ëŠ”ë‹¤ë©´ useQueryí•¨ìˆ˜ ì‹¤í–‰ ì‹œ ì¦‰, ì‚¬ìš©ì ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ë ¤í•  ë•Œ ì‚¬ìš©í•  userê°’ì´ ìƒê¸¸ ê²ƒì´ë‹¤.
ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ **queryClient.setQueryData** ì´ë‹¤.
`setQueryData` ì„ ì‚¬ìš©í•˜ë©´ `ì¿¼ë¦¬í‚¤ì™€ ê°’` ì„ ê°€ì ¸ì™€ `ì¿¼ë¦¬ ìºì‹œì— í•´ë‹¹ í‚¤ì— ëŒ€í•œ ê°’ì„ ì„¤ì •` í•  ìˆ˜ ìˆë‹¤. ì¿¼ë¦¬ í•¨ìˆ˜ì˜ ì‘ë™ë°©ì‹ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ `ì¿¼ë¦¬ í•¨ìˆ˜ ì—†ì´` ì§ì ‘ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤.

### useAuth.tsx

`useAuth.tsx` íŒŒì¼ì„ ë³´ë©´ `signout` í•¨ìˆ˜ëŠ” useUserê°€ ë°˜í™˜í•œ `clearUser` ë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤.
ë¡œê·¸ì¸í•˜ê±°ë‚˜ ê°€ì…í•  ë•Œ ì‹¤í–‰ë˜ëŠ” `authServerCall` ì—ì„œ `updateUser` ê°€ í˜¸ì¶œëœë‹¤.
`signin` ë˜ëŠ” `signUp` í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê³  `ì¸ì¦ì— ëŒ€í•œ ìš”ì²­ì´ ì •ìƒì ìœ¼ë¡œ ë°˜í™˜`ë˜ì—ˆì„ ë•Œ setQueryDataë¥¼ í†µí•´ `ì¿¼ë¦¬ìºì‹œì— ì¿¼ë¦¬í‚¤` ì™€ ê°’ì„ ì €ì¥.

`clearUser` ëŠ” ì‚¬ìš©ì ë°ì´í„°ì— ëŒ€í•œ ì¿¼ë¦¬ ìºì‹œë¥¼ nullë¡œ ì„¤ì •í•˜ê¸° ë•Œë¬¸ì— ì¸ìˆ˜ë¥¼ ì·¨í•˜ì§€ ì•ŠëŠ” ë°˜ë©´, `updateUser` ëŠ” ì¿¼ë¦¬ ìºì‹œê°’ì´ ì„¤ì •ëœ userë¥¼ ì¸ìˆ˜ë¡œ ê°–ëŠ”ë‹¤.

> ğŸ’¡ useAuthëŠ” `signin, signup, signout` í•¨ìˆ˜ë“¤ì´ `ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ì—­í• `ì„ í•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì´ë‹¤.

```tsx
// useAuth.tsx
async const authServerCall = (urlEndpoint, email, password) => {
  try {
     ...
    if ('user' in data && 'token' in data.user) { // ë¡œê·¸ì¸ ì •ìƒ ë™ì‘
      ...
      updateUser(data.user); // ìœ ì € ì •ë³´ ì¿¼ë¦¬ìºì‹œì— ì €ì¥.
    }
  } catch (errorResponse) {...}
}

...

async const signin = (email: string, password: string): Promise<void> => {
  authServerCall('/signin', email, password);
}
async const signup = (email: string, password: string): Promise<void> => {
  authServerCall('/user', email, password);
}
```

#### ğŸ” LogIn

queryClientë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `useQueryClient` í›…ì„ ê°€ì ¸ì˜¤ê³  `setQueryData` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œë‹¤. `ì¿¼ë¦¬ í‚¤` ë¥¼ ì„¤ì •í•´ì£¼ê³ , `newUser` ë¡œ ì „ë‹¬ëœ ë°ì´í„°ë¥¼ ì§€ì •í•´ì£¼ë©´ ë.

ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ë˜ì—ˆì„ ê²½ìš° `ìºì‹œ` ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤. `(useAuth)`

```tsx
// useUser.ts
const queryClient = useQueryClient();
function updateUser(newUser: User): void {
  queryClient.setQueryData(queryKeys.user, newUser)
}
```

#### ğŸ”’ LogOut

`signOutí•¨ìˆ˜`ê°€ ì‹¤í–‰ì‹œ ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë  ë•Œ setQueryDataë¥¼ í†µí•´ `ì¿¼ë¦¬ìºì‹œì— ì‚¬ìš©ìì •ë³´ë¥¼ ì—†ì• ê¸°`

```tsx
// useAuth.tsx
const signout = (): void => {
  // clear user from stored user data
  clearUser();
  toast({
    title: 'Logged out!',
    status: 'info',
  });
}
```
âœ… **clearUserì˜ ì‹¤í–‰ìœ¼ë¡œ ìºì‹œì— ì¡´ì¬í–ˆë˜ ìœ ì €ì •ë³´ë¥¼ nullë¡œ ì„¤ì •**

```ts
// useUser.ts
const clearUser = () => {
  queryClient.setQueryData(queryKeys.user, null);
}
```

#### ë¡œê·¸ì¸ ë¡œì§ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ë° ë¬¸ì œì ì´ ë¬´ì—‡ì¼ê¹Œ?

> ì´ ì„¸ì…˜ì—ì„œ ë°ì´í„° ë³´ì¡´ì„ ì•ˆí–ˆìœ¼ë¯€ë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì‹œ ë¡œê·¸ì•„ì›ƒí–ˆë‹¤ê³  ê°€ì •í•œë‹¤.
ì¿¼ë¦¬ ìºì‹œì—ë§Œ ë³´ì¡´í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ë¥¼ ë³´ì¡´í•´ì•¼í•œë‹¤.