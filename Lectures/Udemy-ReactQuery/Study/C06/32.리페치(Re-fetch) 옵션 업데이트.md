## ì¿¼ë¦¬íŠ¹ì„± 2: ë°ì´í„° ë³€í™˜ê³¼ ë°ì´í„° ë¦¬í˜ì¹­(Re-fetching)
### 32. ë¦¬í˜ì¹˜(Re-fetch) ì˜µì…˜ ì—…ë°ì´íŠ¸

### ğŸ“Œ Re-fetching ì œí•œ / ì„¤ì •

ì•ì„œ ë§í–ˆë“¯ì´ `refetcing` ì„ ì œí•œí•œë‹¤ëŠ” ê²ƒì€ ì‹ ì¤‘í•´ì•¼í•œë‹¤.

í•˜ì§€ë§Œ `ì •ì ì¸ ë°ì´í„°` ì¦‰, ì‚¬ìš©ìì— ì˜í•´ì„œë„ ê·¸ë¦¬ê³  ì•ìœ¼ë¡œë„ ê°’ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì—¬ ì¶œë ¥ì‹œì¼œì¤„ ë°ì´í„°ë¼ë©´ ì—¬ëŸ¬ íŠ¸ë¦¬ê±°ë§ˆë‹¤ refetcingë  í•„ìš”ëŠ” ì—†ì„ ê²ƒì´ë‹¤.

> ğŸ’¡ **íŠ¸ë¦¬ê±°(Trigger)** : ì–´ëŠ íŠ¹ì •í•œ ë™ì‘ì— ë°˜ì‘í•´ ìë™ìœ¼ë¡œ í•„ìš”í•œ ë™ì‘ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ëœ»

`staleTime` ì„ 60ë§Œ ë°€ë¦¬ì´ˆë¡œ ì„¤ì •í•˜ì—¬ ì›¹ì‚¬ì´íŠ¸ì˜ ë°ì´í„°ê°€ `10ë¶„` ë™ì•ˆ ìœ ì§€ ë  ìˆ˜ ìˆê²Œí•˜ê³ .
`cacheTime` ì€ 5ë¶„ì´ ê¸°ë³¸ê°’ì¸ë° staleTimeì´ cacheTimeë³´ë‹¤ `ì´ˆê³¼í•˜ëŠ” ê²ƒì€ ë§ì´ ì•ˆëœë‹¤`.

`ë§Œë£Œëœ ë°ì´í„°` ë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ë™ì•ˆ `ìºì‹±ì— ë°±ì—…ëœ ë‚´ìš©ì´ ë³´ì—¬ì§ˆ ê²ƒ` ì¸ë°, ë§Œë£Œëœ ë°ì´í„°ë³´ë‹¤ ìºì‹±ì´ ë¨¼ì € ë§Œë£Œëœë‹¤ëŠ” ê²ƒì€ `refetcingì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ë™ì•ˆ ë³´ì—¬ì¤„ í™”ë©´ì´ ì—†ë‹¤ëŠ” ëœ»` ì´ê¸° ë•Œë¬¸ì´ë‹¤. ë”°ë¼ì„œ, cacheTimeì€ 90ë§Œ ë°€ë¦¬ì´ˆë¡œ ì„¤ì •

```ts
// useTreatments.ts
export function useTreatments(): Treatment[] {
  const fallback = [];
  const { data = fallback } = useQuery(queryKeys.treatments, getTreatments, {
    staleTime: 600000, // 10 min
    cacheTime: 900000, // 15 min
    refetchOnMount: false,
    refetchOnWindowFocus: false,
    refetchOnReconnect: false,
  });
  return data;
}
```

#### ğŸ“ usePrefetchTreatments

ê¸°ì¡´ì— `usePrefetchTreatments`  ë¥¼ ì‚¬ìš©í•´ì„œ Home ìœ¼ë¡œ ì ‘ì†í•  ë•Œ `treatments` í˜ì´ì§€ë¥¼ pre-fetch í–ˆì—ˆë‹¤. (ë§ì€ ì‚¬ìš©ìê°€ treatments í˜ì´ì§€ë¥¼ ì´ìš©í•œë‹¤ê³  ê°€ì •)
`Home` í˜ì´ì§€ë¡œ ê°€ë©´ pre-fetchí•´ì„œ `last Updated` ê°€ `7:11:59` ë¼ê³  ë‚˜ì˜¤ëŠ”ë° 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-09-03 á„‹á…©á„’á…® 7 12 02](https://github.com/chromeheartz/TIL/assets/95161113/8c46e51d-cd64-4f6c-ac66-10129bca34ae)

`treatments` íƒ­ì— ê°€ë³´ë©´ `fresh`ë¼ëŠ” ë¼ë²¨ì´ ë¶™ê³  ë¦¬íŒ¨ì¹­ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-09-03 á„‹á…©á„’á…® 7 12 52](https://github.com/chromeheartz/TIL/assets/95161113/c3ca22a0-a713-451b-ae6a-a81ebeb104f0)

â­ï¸ í•˜ì§€ë§Œ `Home` ìœ¼ë¡œ ëŒì•„ê°€ë³´ë©´ `ë¦¬í˜ì¹­` ì´ ëœë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-09-03 á„‹á…©á„’á…® 7 13 32](https://github.com/chromeheartz/TIL/assets/95161113/d1613e30-7dae-4bb8-87ab-25555b145c42)

> #### âœ… 
`treatments` í˜ì´ì§€ì—ì„œ `stale, cache Time` ì´ ì ìš©ì¤‘ì´ì§€ë§Œ `Home` í˜ì´ì§€ëŠ” `pre-fetching` ìœ¼ë¡œ `stale, cache Time` ì´ ì—†ê¸° ë•Œë¬¸ì— ê¸°ë³¸ê°’ì´ ì ìš©ë˜ëŠ”ê²ƒì´ë‹¤.

ë”°ë¼ì„œ `usePrefetchTreatments` ì—ë„ `stale, cache Time` ì„ ì°¸ì¡°ì‹œì¼œ ë°ì´í„°ì˜ ìƒˆë¡œê³ ì¹¨ ì—¬ë¶€ë¥¼ ê²°ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ë©´ ëœë‹¤. ì´ë ‡ê²Œ í•˜ë©´ treatmentsì—ì„œ homeì´ ìœ¼ë¡œ ëŒì•„ê°€ë”ë¼ë„ `re-fetching` ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.

```ts
// useTreatments.ts
export function usePrefetchTreatments(): void {
  const queryClient = useQueryClient();
  queryClient.prefetchQuery(queryKeys.treatments, getTreatments, {
    staleTime: 600000, // 10 min
    cacheTime: 900000, // 15 min
  });
}
```