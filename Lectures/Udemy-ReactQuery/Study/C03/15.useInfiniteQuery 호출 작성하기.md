## ë™ì (JIT) ë°ì´í„° ë¡œë“œë¥¼ ìœ„í•œ ë¬´í•œ ì¿¼ë¦¬
### 15. useInfinityQuery í˜¸ì¶œ ì‘ì„±í•˜ê¸°
---------------------------------------------

### ğŸ“Œ ê¸°ë³¸ í˜•íƒœ ì‘ì„±

`scaffolding code` 

ê¸°ë³¸ì ì¸ êµ¬ì¡° ë¨¼ì € íŒŒì•…í•´ë³´ì. ê°„ë‹¨í•œ fetchí•¨ìˆ˜ì™€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì“¸ urlì´ ì„ ì–¸ë˜ì–´ìˆê³ , InfiniteScroll ì´ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ return í•˜ê³ ìˆë‹¤.

```jsx
// InfinitePeople.jsx

import InfiniteScroll from "react-infinite-scroller";
import { Person } from "./Person";

const initialUrl = "https://swapi.dev/api/people/";
const fetchUrl = async (url) => {
  const response = await fetch(url);
  return response.json();
};

export function InfinitePeople() {
  // TODO: get data for InfiniteScroll via React Query
  return <InfiniteScroll />;
}
```

1ï¸âƒ£ ë¨¼ì € importêµ¬ë¬¸ì„ ì‚¬ìš©í•´ì„œ `useInfiniteQuery` ë¥¼ ê°€ì ¸ì™€ì„œ `í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸` ì—ì„œ í˜¸ì¶œí•œë‹¤.
ë°˜í™˜ëœ ê°ì²´ì—ì„œ í•„ìš”í•œê²ƒì€ data. `í˜ì´ì§€ë¥¼ ê³„ì† ë¡œë“œ` í•  ë•Œì— ì´ `data` ì— `ë°ì´í„°ì˜ í˜ì´ì§€` ê°€ í¬í•¨ëœë‹¤.
â­ï¸ ë¹„êµ¬ì¡° í• ë‹¹ìœ¼ë¡œ ë„˜ì–´ì˜¨ ê¸°ì¡´ ë³€ìˆ˜ë¥¼ ìƒˆë¡œìš´ ë³€ìˆ˜ì´ë¦„ìœ¼ë¡œ í• ë‹¹í•˜ë ¤ë©´ `: xxxx` í˜•ì‹ìœ¼ë¡œ ìƒˆë¡œìš´ ì´ë¦„ì„ í• ë‹¹í•´ì£¼ë©´ ëœë‹¤.

```jsx
import { useInfiniteQuery } from "react-query";

export function InfinitePeople() {
  // dataì˜ ì´ë¦„ì„ ë°”ê¾¸ê³ ì‹¶ì€ ê²½ìš° const { data: InfiniteData } ê°™ì€ í˜•ì‹ìœ¼ë¡œ í• ë‹¹ ê°€ëŠ¥
  const { data } = useInfiniteQuery();  
  return <InfiniteScroll />;
}
```

2ï¸âƒ£ ì¶”ê°€ë¡œ ë” í•„ìš”í•œ `fetchNextPage / hasNextPage` 2ê°€ì§€ë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.

- `fetchNextPage` : ë” ë§ì€ ë°ì´í„°ê°€ í•„ìš”í•  ë•Œ `ì–´ëŠ í•¨ìˆ˜ë¥¼ ì‹¤í–‰` í• ì§€ë¥¼ `InfiniteScroll` ì— ì§€ì‹œí•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì¦‰, `ë‹¤ìŒ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í˜¸ì¶œ` í•  ë•Œ ì‚¬ìš©
- `hasNextPage` : `ìˆ˜ì§‘í•  ë°ì´í„°ê°€ ë” ìˆëŠ”ì§€` ë¥¼ ê²°ì •í•˜ëŠ” `boolean`

```jsx
const { data, fetchNextPage, hasNextPage } = useInfiniteQuery();  
```

3ï¸âƒ£ useInfiniteQueryì— ëª‡ ê°€ì§€ ì¸ìˆ˜ë¥¼ ì „ë‹¬í•´ ì¤€ë‹¤. `ì¿¼ë¦¬ í‚¤ / í•¨ìˆ˜` ë¥¼ ë¨¼ì € ì „ë‹¬í•œë‹¤.
ì¿¼ë¦¬ í‚¤ë¥¼ `people` ë¡œ ì„¤ì •í•˜ê³  `ì¿¼ë¦¬ í•¨ìˆ˜` ë„ í•„ìš”í•œë°, â­ï¸ ì´ ì¿¼ë¦¬ í•¨ìˆ˜ëŠ” `ê°ì²´ ë§¤ê°œë³€ìˆ˜` ë¥¼ ë°›ê³  í”„ë¡œí¼í‹°ì¤‘ í•˜ë‚˜ë¡œ `pageParam` ì„ ê°€ì§€ê³  ìˆë‹¤. ì´ pageParamì€ `fetchNextPage` ì´ ì–´ë–»ê²Œ ë³´ì¼ì§€ ê²°ì •í•˜ê³  ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ ê²°ì •í•œë‹¤. í˜„ì¬ ê¸°ì ì—ì„œëŠ” pageParamì´ `ê¸°ë³¸ê°’` ì´ ë˜ë©´ ë ê²ƒì´ë‹¤.
ì²˜ìŒ ì‹¤í–‰í•  ë•Œì—ëŠ” `pageParam` ì´ ì„¤ì •ë˜ì–´ìˆì§€ ì•Šê³  ê¸°ë³¸ê°’ì´ í˜„ì¬ ê¸°ì¤€ `initialUrl` ì´ê¸° ë•Œë¬¸.

âœ… `pageParam` ì€ ë‹¨ìˆœí•˜ê²Œ useInfiniteQuery ê°€ `í˜„ì¬ ì–´ë–¤ í˜ì´ì§€ì— ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” íŒŒë¼ë¯¸í„° ê°’` ì´ë¼ê³  ê°œë…ì„ ì¡ìœ¼ë©´ ë ê²ƒê°™ë‹¤.

```jsx
const { data, fetchNextPage, hasNextPage } = useInfiniteQuery(
  "people",
  ({ pageParam = initialUrl }) => fetchUrl(pageParam)
);  
```

4ï¸âƒ£ `getNextPageParam` ì— ì˜µì…˜ì„ ì£¼ëŠ”ë° ì´ ì˜µì…˜ì€ `lastPage, allPage` ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. í˜„ì¬ `allPage` ëŠ” í•„ìš”í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì œì™¸í•˜ì˜€ë‹¤. `lastPage` ë§Œ ìˆê²Œ ë˜ì–´ë„ ì¿¼ë¦¬ í•¨ìˆ˜ë¥¼ `ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í–‰í•œ ì‹œì ` ì˜ ë°ì´í„°ë¡œ ì¶©ë¶„í•˜ê¸° ë•Œë¬¸.

í˜„ì¬ ì‚¬ìš©í•˜ëŠ” apiì˜ ê²½ìš° nextí”„ë¡œí¼í‹°ë¡œ ë‹¤ìŒí˜ì´ì§€ë¡œ ê°€ëŠ”ë° í•„ìš”í•œ urlì´ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì¤€ë‹¤. ë”°ë¼ì„œ lastPageì˜ nextí”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•´ì¤„ê²ƒì´ê³  (ì´ê²ƒì´ pageParamì´ ë˜ëŠ”ê²ƒ), `falseê°’` ì´ë¼ë©´ undefinedë¥¼ ë°˜í™˜í•œë‹¤.
ğŸ“ fetchNextPageë¥¼ ì‹¤í–‰í•˜ë©´ `next` í”„ë¡œí¼í‹°ê°€ ë¬´ì—‡ì¸ì§€ì— ë”°ë¼ ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë„ì°©í•œ ë‹¤ìŒ `pageParam` ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
ğŸ“ hasNextPageëŠ” `(lastPage) => lastPage.next` ì´ í•¨ìˆ˜ê°€ undefinedë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ ì•„ë‹Œì§€ì— ë”°ë¼ ê²°ì •ëœë‹¤. ì¦‰ ë‹¤ìŒ api í˜¸ì¶œì— ì‚¬ìš©ë  `pageParamê°’` ì´ ì •ìƒì ìœ¼ë¡œ ë‹´ê²¨ìˆì„ ê²½ìš° `true` ì•„ë‹ ê²½ìš° `false` ë¥¼ ë°˜í™˜í•œë‹¤.

- `getNextPageParam` : getNextPageParamê³¼ fetchNextPageëŠ” ê³µí†µì ìœ¼ë¡œ `ë‹¤ìŒ í˜ì´ì§€ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒ` í•  ë•Œì— ì‚¬ìš©ëœë‹¤. âœ… `getNextPageParam` ì€ ë‹¤ìŒ apië¥¼ ìš”ì²­í•  ë•Œ ì‚¬ìš©ë  `pageParam` ì˜ ê°’ì„ ì •í•  ìˆ˜ ìˆë‹¤ 
- `lastPage` : useInfiniteQueryë¥¼ ì´ìš©í•´ í˜¸ì¶œëœ `ê°€ì¥ ë§ˆì§€ë§‰ì— ìˆëŠ” í˜ì´ì§€ ë°ì´í„°`
- `allPage` : useInfiniteQueryë¥¼ ì´ìš©í•´ í˜¸ì¶œëœ `ëª¨ë“  í˜ì´ì§€ì˜ ë°ì´í„°`

```jsx
const { data, fetchNextPage, hasNextPage } = useInfiniteQuery(
  "people",
  ({ pageParam = initialUrl }) => fetchUrl(pageParam),
  {
    getNextPageParam: (lastPage) => lastPage.next || undefined
  }
);  
```