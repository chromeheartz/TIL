## ì¿¼ë¦¬ ìƒì„± ë° ë¡œë”©/ì—ëŸ¬ ìƒíƒœ
### 12. useMutationìœ¼ë¡œ í¬ìŠ¤íŒ… ì‚­ì œí•˜ê¸° / Code Quiz
---------------------------------------------

### ğŸ“Œ Mutations

í˜„ì¬ APIë¡œëŠ” ì‹¤ì œë¡œ ì‚­ì œí•˜ì§€ëŠ” ì•Šì§€ë§Œ `ë³€ì´` ê°€ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ì–´ë–¤ì¼ì´ ì¼ì–´ë‚ ì§€ì— ëŒ€í•´ / ì‚¬ìš©ìì—ê²Œ ì´ë¥¼ ì•Œë ¤ì£¼ëŠ” ë°©ë²•ì€ ì•Œ ìˆ˜ ìˆëŠ”ê²ƒì´ë‹¤.

`deletePost` í•¨ìˆ˜ê°€ ë¯¸ë¦¬ ì‘ì„±ë˜ì–´ ìˆëŠ”ë° ì´ í•¨ìˆ˜ëŠ” íŠ¹ì • postIdì— ëŒ€í•´ `delete HTTP` í˜¸ì¶œì„ ì „ì†¡í•œë‹¤. 

```jsx
// PostDetil.jsx
async function fetchComments(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/comments?postId=${postId}`
  );
  return response.json();
}
```

### ğŸ“ `useMutation` êµ¬í˜„

í˜„ì¬ `useMutation` ì—ì„œëŠ” êµ¬ì¡° ë¶„í•´ í• ë‹¹ì„ í•˜ì§€ ì•Šì„ ê²ƒì¸ë° ê·¸ ì´ìœ ì¤‘ í•˜ë‚˜ëŠ” `ë‹¤ë¥¸ ë³€ì´` ë„ í™•ë³´í•  ì˜ˆì •ì´ë¯€ë¡œ `ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ í˜¼ë™` ì„ í”¼í•˜ê¸° ìœ„í•œ ê²ƒì´ ìˆë‹¤.

```jsx
const deleteMutation = useMutation()
```

ì—¬ê¸°ì„œ `ì¿¼ë¦¬ í‚¤` ëŠ” í• ë‹¹ í•˜ì§€ ì•ŠëŠ”ë‹¤. 
â­ï¸ `ì¿¼ë¦¬ í‚¤` ì™€ ê´€ë ¨ìˆëŠ” `ìºì‹œ ë‚´ë¶€ì˜ ë°ì´í„°` ì™€ëŠ” ìƒê´€ì´ ì—†ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ë§Œ ë¶€ì—¬í•œë‹¤.

### ğŸ“Œ useQuery VS useMutation

ê¸°ì¡´ì— `useQuery` ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” `ì¸ìˆ˜ë¡œì„œ ì „ë‹¬` í•˜ëŠ” `ì¿¼ë¦¬ í•¨ìˆ˜` ì™€ëŠ” ë‹¤ë¥´ê²Œ ìš°ë¦¬ê°€ ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” `ë³€ì´ í•¨ìˆ˜` ì˜ ê²½ìš° ê·¸ ìì²´ë¡œë„ ì¸ìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. `postId` ë¥¼ ë„£ì–´ì¤„ ìˆ˜ ìˆê³ , ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ `deletePost` ë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. 

```jsx
// useQuery
const { data, isLoading, isError, error } = useQuery(["comments", post.id], () => fetchComments(post.id));

// useMutation
const deleteMutation = useMutation((postId) => deletePost(postId));
```

ì´ useMutation ê°ì²´ëŠ” `ë³€ì´ í•¨ìˆ˜` ë¥¼ ë°˜í™˜í•˜ê²Œ ë˜ëŠ”ë° ì¦‰, ëˆ„êµ°ê°€ 
ì–´ë– í•œ íŠ¸ë¦¬ê±°(ë²„íŠ¼ ë“±) ì´ ì¼ì–´ë‚ ë•Œ `ì´ ë³€ì´ í•¨ìˆ˜` ë¥¼ ì‹¤í–‰í•˜ê²Œ ë ê²ƒì´ë‹¤. ë”°ë¼ì„œ ê°ì²´ë¥¼ ë°˜í™˜í•œ í›„ ì†ì„± í•¨ìˆ˜ì¸ `mutate` ë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.

ì—¬ê¸°ì„œ `post.id` ëŠ” ë¶€ëª¨ë¡œë¶€í„° ë°›ì•„ì˜¨ `props.post` ì— ë“¤ì–´ìˆëŠ” ê°’ì´ë‹¤. 
â­ï¸ ì´ ì»´í¬ë„ŒíŠ¸(PostDetail)ì— ëŒ€í•œ í˜¸ì¶œì´ ì´ë£¨ì–´ì§ˆë•Œë§ˆë‹¤ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.
ê·¸ëŸ¬ë‚˜ `ì¸ìˆ˜` ë¥¼ ì œê³µí•  ìˆ˜ë„ ìˆë‹¤ëŠ” ì ì€ ê¸°ì–µí•´ë‘ë©´ ì¢‹ì„ê²ƒì´ë‹¤.

```jsx  
// â­ï¸
const deleteMutation = useMutation(() => deletePost(post.id));
<button onClick={() => deleteMutation.mutate()} />

const deleteMutation = useMutation((postId) => deletePost(postId));
<button onClick={() => deleteMutation.mutate(post.id)} />
```

`deleteMutation` ì˜ ë°˜í™˜ ê°ì²´ì—ì„œ ë‹¤ë¥¸ ì†ì„±ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
`useQuery` ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë˜ `isSuccess` ë„ ìˆë‹¤.
ì´ê²ƒì´ ìˆë‹¤ë©´ API ë°©ì‹ìœ¼ë¡œ ì¸í•´ í˜ì´ì§€ì—ì„œ `ë°ì´í„°ê°€ ë³€ê²½ë¨(ë³€ì´)` ë¥¼ í†µí•´ `ë³€ì´ê°€ ì„±ê³µ` í–ˆë‹¤ëŠ” ê²ƒìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê²ƒì´ë‹¤. 

```jsx
// ì—ëŸ¬ê°€ ë°œìƒí•  ê²½ìš°
{
  deleteMutation.isError && <p style={{color: 'red'}}>Error deleting the post</p>
}

// ë¡œë”©ì¤‘ì¸ ê²½ìš°
{
  deleteMutation.isLoading && <p style={{color: 'purple'}}>Deleting the post</p>
}

// ì„±ê³µí•œ ê²½ìš°
{
  deleteMutation.isSuccess && <p style={{color: 'blue'}}>Post has (not) been deleted</p>
}
```

âœ… ì´ëŸ°ì‹ìœ¼ë¡œ ë³€ì´ì˜ ì£¼ê¸°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.
ë°˜í™˜ ê°ì²´ì— `ë³€ì´ ì†ì„±` ì„ ì‹¤í–‰í•˜ì—¬ `ë³€ì´ì˜ í˜¸ì¶œ` ì„ ì¡°ì ˆí•  ìˆ˜ ìˆê³  ì¿¼ë¦¬ì—ì„œ ì§„í–‰í•œ ê²ƒê³¼ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ `ì£¼ê¸°ë¥¼ ì²˜ë¦¬` í•  ìˆ˜ ìˆë‹¤.

### ğŸ“Œ Code Quiz

ì½”ë“œí€´ì¦ˆëŠ” `update title` ë²„íŠ¼ì„ `delete button` ê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ”ê²ƒ.
ì´ë²ˆ ì½”ë“œí€´ì¦ˆëŠ” `deleteMutation` ì„ êµ¬í˜„í–ˆì„ë•Œì˜ ë¡œì§ê³¼ëŠ” í¬ê²Œ ë‹¤ë¥¸ ë¶€ë¶„ì´ ì•„ë‹ˆì—¬ì„œ ì‰¬ì› ë‹¤.
ê²°êµ­ í¬ì¸íŠ¸ëŠ” `useMutation` ì´ `ë°˜í™˜í•˜ëŠ” ê°ì²´ / ìƒíƒœë³€í™”ë¥¼ ì²˜ë¦¬` í•˜ëŠ” ë°©ë²•ì— ìµìˆ™í•´ì§€ëŠ” ê²ƒì— ìˆë‹¤.


```jsx
// PostDetail.jsx

import { useMutation, useQuery } from "react-query";

async function fetchComments(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/comments?postId=${postId}`
  );
  return response.json();
}

async function deletePost(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/postId/${postId}`,
    { method: "DELETE" }
  );
  return response.json();
}

async function updatePost(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/postId/${postId}`,
    { method: "PATCH", data: { title: "REACT QUERY FOREVER!!!!" } }
  );
  return response.json();
}

export function PostDetail({ post }) {
  const { data, isLoading, isError, error } = useQuery(["comments", post.id], () => fetchComments(post.id));

  const deleteMutation = useMutation(() => deletePost(post.id));
  const updateMutation = useMutation(() => updatePost(post.id));

  if (isLoading) return <h3>Loading...</h3>;
  if (isError) 
    return (
      <>
        <h3>Comments Loading Fail</h3>
      </>
    );

  return (
    <>
      <h3 style={{ color: "blue" }}>{post.title}</h3>
      <button onClick={() => deleteMutation.mutate()}>Delete</button>
      <button onClick={() => updateMutation.mutate()}>Update title</button>
      <p>{post.body}</p>

      <>
        {
          deleteMutation.isError && <p style={{color: 'red'}}>Error deleting the post</p>
        }
        {
          deleteMutation.isLoading && <p style={{color: 'purple'}}>Deleting the post</p>
        }
        {
          deleteMutation.isSuccess && <p style={{color: 'blue'}}>Post has (not) been deleted</p>
        }  

        {
          updateMutation.isError && <p style={{color: 'red'}}>Error updating the post</p>
        }
        {
          updateMutation.isLoading && <p style={{color: 'purple'}}>Updating the post</p>
        }
        {
          updateMutation.isSuccess && <p style={{color: 'blue'}}>Post has (not) been updated</p>
        }  
      </>
      <h4>Comments</h4>
      {data.map(comment => (
        <li key={comment.id}>
          {comment.email}: {comment.body}
        </li>
      ))}
    </>
  );
}


```