## í˜ì´ì§€ ë§¤ê¹€, í”„ë¦¬í˜ì¹­ê³¼ ë³€ì´
### 13. React Query ê¸°ì´ˆ ì •ë¦¬
---------------------------------------------

### ğŸ“Œ React Query ê¸°ì´ˆ ì •ë¦¬

âœ… íŒ¨í‚¤ì§€ ì„¤ì¹˜ í›„ `QueryClient` ë¥¼ ìƒì„±í•´ì„œ `QueryProvider` ë¥¼ ì¶”ê°€í–ˆì—ˆë‹¤. ëª¨ë“  ìì‹ ì»´í¬ë„ŒíŠ¸ê°€ `ìºì‹œ / í›…` ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡.

```jsx
import { QueryClient, QueryClientProvider } from "react-query";

// Create a Client
const queryClient = new QueryClient(); // Instance of QueryClient

<QueryClientProvider client={queryClient}>
  <div className="App">
    <h1>Blog Posts</h1>
    <Posts />
  </div>
  <ReactQueryDevtools />
</QueryClientProvider>
```

âœ… `useQuery` í›…ì„ ì‹¤í–‰í•´ì„œ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê³  ìµœì‹ ìƒíƒœì¸ì§€ í™•ì¸ í•  ìˆ˜ ìˆì—ˆëŠ”ë° ë°˜í™˜ ê°ì²´ì—ëŠ” `isLoading / isFetching / Error ...` ì´ ìˆëŠ”ë° íŠ¹ì • ì¿¼ë¦¬ì˜ ìƒíƒœë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œë ¤ì¤„ ë•Œ ì‚¬ìš©í•˜ì˜€ë‹¤.

âœ… `staleTime` ì—ëŠ” ìœˆë„ìš°ê°€ ë‹¤ì‹œ í¬ì»¤ìŠ¤ ë  ë•Œ ê°™ì€ `íŠ¹ì • íŠ¸ë¦¬ê±°` ì—ì„œ ì¿¼ë¦¬ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¬ì§€ ê²°ì •í•œë‹¤. ë‹¤ì‹œ ë§í•´ `ë°ì´í„°ê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„` ì´ë‹¤. ì„œë²„ë¡œ ëŒì•„ê°€ ë°ì´í„°ê°€ ì—¬ì „íˆ ì •í™•í•œì§€ í™•ì¸í•´ì•¼ í•˜ëŠ” `ì‹œì ` ê¹Œì§€.

âœ… `cacheTime` ì€ `ë°ì´í„°ê°€ ë¹„í™œì„±í™”ëœ ì´í›„ ë‚¨ì•„ìˆëŠ” ì‹œê°„` ì„ ë§í•œë‹¤. ìºì‹œëœ ë°ì´í„°ëŠ” ì¿¼ë¦¬ë¥¼ `ë‹¤ì‹œ ì‹¤í–‰` í–ˆì„ ë•Œ ì‚¬ìš©í•˜ê³ , ë°ì´í„°ê°€ ìµœì‹  ìƒíƒœì¸ì§€ ì„œë²„ì—ì„œ í™•ì¸í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ê²Œ ëœë‹¤.

âœ… `ë””íœë˜ì‹œ ë°°ì—´` ë¡œ `ì¿¼ë¦¬ í‚¤` ë¥¼ ë´¤ì—ˆëŠ”ë° ì´ ì¿¼ë¦¬ í‚¤ê°€ ë³€ê²½ë˜ë©´ `useQuery hook` ì€ ì¿¼ë¦¬ë¥¼ ë°˜ë³µí•œë‹¤. ê·¸ë˜ì„œ `ë°ì´í„° í•¨ìˆ˜` ê°€ ë°”ë€Œë©´ `ì¿¼ë¦¬ í‚¤` ë˜í•œ ë°”ë€Œê²Œ ëœë‹¤. ë°ì´í„°ë¥¼ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš° ë‹¤ì‹œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡

```jsx
const { data, isError, error, isLoading, isFetching } = useQuery(
  ["posts", currentPage],
  () => fetchPosts(currentPage),
  { staleTime: 2000, keepPreviousData: true }
);

if (isFetching) return <h3>Fetching...</h3>;
if (isError)
  return (
    <>
      <h3>Oops, Something went wrong</h3>
      <p>{error.toString()}</p>
      </>
  );
```

`ì„œë²„ ì‚¬ì´ë“œ ì´í™íŠ¸` ìˆ˜í–‰ì— ì‚¬ìš©ë˜ëŠ” `useMutation` ë˜í•œ ë‹¤ë£¨ì—ˆë‹¤. ì„œë²„ ë°ì´í„°ëŠ” í˜„ì¬ ë°”ë€Œì§€ ì•Šê¸° ë•Œë¬¸ì— ì‚¬ìš©ë°©ë²•ë§Œ ì•Œì•„ë³´ì•˜ë‹¤.

```jsx
const deleteMutation = useMutation(() => deletePost(post.id));
const updateMutation = useMutation(() => updatePost(post.id));

<button onClick={() => deleteMutation.mutate()}>Delete</button>
<button onClick={() => updateMutation.mutate()}>Update title</button>
```

`pagination / pre-fetching` 
í˜ì´ì§€ë¥¼ ë„˜ê¸°ë©´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ì–´ë–»ê²Œ ìœ ì§€í•˜ëŠ”ì§€ ì¶”ê°€ í˜ì´ì§€ë¥¼ í”„ë¦¬íŒ¨ì¹­í•˜ëŠ”ê²ƒë„ ì•Œì•„ ë³´ì•˜ë‹¤. ì„œë²„ì—ì„œ ìµœì‹ ì¸ì§€ í™•ì¸í•˜ëŠ” ë™ì•ˆ `ìºì‹œëœ ë°ì´í„°` ê°€ ë³´ì¼ ìˆ˜ ìˆë„ë¡

```jsx
useEffect(() => {
  if (currentPage < maxPostPage) {
    const nextPage = currentPage + 1;
    queryClient.prefetchQuery(["posts", nextPage], () =>
                              fetchPosts(nextPage)
                             );
  }
}, [currentPage, queryClient]);

<div className="pages">
  <button
    disabled={currentPage <= 1}
    onClick={() => {
      setCurrentPage(prev => prev - 1);
    }}
    >
    Previous page
  </button>
  <span>Page {currentPage}</span>
  <button
    disabled={currentPage >= maxPostPage}
    onClick={() => {
      setCurrentPage(prev => prev + 1);
    }}
    >
    Next page
  </button>
</div>
```