## 페이지 매김, 프리페칭과 변이
### 11. 변이(Mutation) 입문
---------------------------------------------

### 📌 Mutations

`변이` 는 서버에 데이터를 업데이트하도록 서버에 `네트워크 호출` 을 실시한다. 
따라서 이 경우 블로그 포스트를 `추가 / 삭제` 하거나 제목을 변경할것이다.

❌ 현재 사용하고 있는 `JSONPlaceholder API` 의 한가지 제한 사항은 서버를 `실제로 업데이트` 하지 않고 변이를 생성하는 서버 호출을 전송하게 된다. 그러나 모두가 `동일한 데이터를 공유` 하기 때문에 이러한 변이 호출이 일어났을 때 실제 데이터는 변경되지 않는다.
따라서 `변경을 적용할 때 이루어지는 원리` 를 알아볼것.

✅ 추후 진행할 `Day Spa` 앱을 작업할 때 보게 될 내용

변경 내용을 사용자에게 보여주거나 진행된 변경 내용을 등록하여 `사용자가 볼 수 있게 하는 방법` 등이 있다.
- `낙관적 업데이트(Optimistic updates)` 로 즉 서버 호출에서 모든 내용이 잘 진행될 것으로 간주하는 것이다. 그리고 사실이 아닌 경우로 판명될 경우 `롤백을 진행` 한다.
- 또 다른 방법은 `변이 호출을 실행` 할 때 서버에서 `받는 데이터` 를 취하고 업데이트된 해당 데이터로 `Reat Query` 캐시를 업데이트 하는것이다
- 관련 쿼리를 `무효화` 할 수 있다. 무효화하는 경우 서버에서 리패치를 개시하여 클라이언트에 있는 데이터를 서버의 데이터와 `최신 상태` 로 유지한다.

### ⭐️ 낙관적 업데이트 vs 비관적 업데이트

낙관적/비관적 업데이트는 서버에 요청을 보낼 때, `UI를 언제 업데이트해줄지를 결정` 하는 방법을 말한다.
두 단어 모두 이름에서 나타나듯 `낙관적 / 비관적` 이 포인트이다.

- `낙관적(Optimistic)` 
**사용자 수정 요청 => 화면 갱신 => 서버에 수정 요청** (실패 시 이전상태로 `롤백` )
말 그대로, 서버에 요청이 `성공할 것` 이라고 `낙관적으로 판단` . 하고 `미리 UI를 업데이트한다.`
- `비관적(Pessimistic)` 
**사용자 수정 요청 => 서버에 수정 요청 => 성공하면 화면 갱신**
서버에 요청시, `실패할 가능성` 이 있기 때문에, 요청이 성곤한 것이 `확실 시 되면 갱신` 해주는 것.

> 
중요한 기능의 경우 `비관적 업데이트` 방식을 주로 사용한다. 실패할 수도 있기 때문에 `미리 성공한 데이터` 를 보여준 후에 `롤백` 이 된다면 사용자 경험적으로 좋지 않을것이다.
요청이 실패해도, 그 위험도가 낮은 경우는 `낙관적 업데이트` 를 사용한다.

#### 💡 그럼, 이 두 방법을 언제 사용할지는 어떻게 판단할까?

`낙관적 업데이트` 의 경우는 서버와의 통신 시 발생하는 시간차 동안 `유저가 대기하는 것` 을 없애, `좋은 UX` 를 제공하는 것을 목표로한다. 그렇지만, 정보의 정확도 측면에서는 `비관적 업데이트` 가 더 유리하다.
그렇기에, 낙관적 업데이트는 요청이 실패해도, 큰 문제가 생기지 않는 기능을 구현할 때만 채택해야한다.
그 예시로 가장 많이 언급 되는 것은 `좋아요` 버튼이다.

### 📌 useMutation

`React Query` 훅인 `useMutation` 을 사용할 것이다.
일부 예외를 제외하고 `useQuery` 와 상당히 유사하다.
- `mutate 함수` 를 반환하는데 이 `mutate 함수` 는 우리가 변경 사항을 토대로 `서버를 호출` 할 때 사용할것이다.
- 데이터를 저장하지 않으므로 `쿼리 키` 는 필요가 없다. `쿼리가 아닌 변이` 이기 때문
- `isLoading` 은 존재하지만 `isFetching` 은 없다. 캐시된 항목이 없으므로 성립하지 않기 때문.
- `변이에 관련된 캐시` 는 존재하지 않고 재시도 또한 `기본값으로 존재하지 않는다`.
- `useQuery` 는 기본값으로 `3회 재시도` 하지만 `useMutation` 의 경우 자동 재시도를 적용하고 싶다면 설정하지 않는 이상 기본값은 `재시도를 하지 않는다` .

[`useMutation docs`]


[`useMutation docs`]: (https://tanstack.com/query/latest/docs/react/guides/mutations?from=reactQueryV3&original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Fguides%2Fmutations)