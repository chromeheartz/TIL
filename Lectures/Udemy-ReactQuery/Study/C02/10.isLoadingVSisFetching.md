## 페이지 매김, 프리페칭과 변이
### 10. isFetching vs isLoading
---------------------------------------------

#### isFetching

- `async 쿼리 함수` 가 해결되지 않았을 때 `true`. 
- 아직 데이터를 가져오는 중이다.

#### isLoading

- `isFetching` 이 true이면서 쿼리에 대해 `캐시된 데이터가 없는 상태` 를 뜻한다.

📍 즉 `isLoading` 상태이거나 값이 true인 경우 `isFetching` 또한 `항상 true` 이다.
isLoading은 `캐시된 데이터가 없고 데이터를 가져오는 상황` 에 해당하는 isFetching의 부분 집합이다.

현재 로딩 인디케이터를 표시하고 `조기 반환` 하기 위해 isLoading을 조건으로 사용하고 있다.
데이터를 가져오는 중 즉, `() => fetchPosts(currentPage)` 가 실행중이면서, `캐시 된 데이터가 없으면` isLoading은 참이 된다.

```jsx
// Posts.jsx
if (isLoading) return <h3>Loading...</h3>;
```

이 조건을 `isFetching` 으로 바꾸게 되면 `캐시된 데이터의 존재 여부` 와 관계없이 항상 로딩 인디케이터가 나올것이다. ⭐️ 프리패치 전에 행동하는것이다. 즉 nextPage 데이터를 `포함한 캐시` 를 미리 가져오기 전.

```jsx
// Posts.jsx
if (isFetching) return <h3>Fetching...</h3>;
```

![스크린샷 2023-08-08 오전 5 07 54](https://github.com/chromeheartz/TIL/assets/95161113/167aae81-430f-4db3-b39b-37b385192863)

✅ 화면에 표시할 것이 아무것도 없을 때, 인디케이터를 제공하려면 `isLoading`. 즉, 캐시에 아무것도 없고 서버에서 데이터를 가져오는중이라면.
하지만 `프리패칭의 목적` 은 캐시된 데이터를 표시하면서 배경에서는 데이터의 `업데이트 여부` 를 확인하는것이다. 그리고 업데이트된 경우 해당 데이터를 페이지에 보내줄것이다.

### 📌 ⭐️ 프리패치가 작동하는 방식

현재 코드를 기준으로, `currentPage` 가 업데이트될 때.
`["posts", currentPage]` 현재 쿼리 키가 2페이지라고 했을 때 캐시에 2페이지가 있는지 묻는다. 2페이지를 프리패치 했기 때문에 존재하지만 자동으로 `만료(stale) 상태` 가 적용된다. 따라서 `fetchPosts` 를 실행하고, 만약 다른 데이터를 반환한다면 데이터가 업데이트된다. 그러나 그 전에는 `캐시된 데이터` 가 표시되고 있는데, 다시 가져온 데이터가 캐시된 데이터와 동일하다고 해도 사용자는 모를것이다.