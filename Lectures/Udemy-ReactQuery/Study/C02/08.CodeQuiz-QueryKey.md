## ì¿¼ë¦¬ ìƒì„± ë° ë¡œë”©/ì—ëŸ¬ ìƒíƒœ
### 08. Code Quiz / ì¿¼ë¦¬ í‚¤
---------------------------------------------

### ğŸ“Œ Code Quiz

#### ğŸ“ë¸”ë¡œê·¸ ëŒ“ê¸€ì„ ìœ„í•œ ì¿¼ë¦¬ ìƒì„±í•˜ê¸°

ê²Œì‹œë¬¼ì„ í´ë¦­í•˜ë©´ ì„ íƒëœ ê²Œì‹œë¬¼ì„ íŠ¹ì •í•œ í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ë°ì´í„°ë¡œ ì„¤ì •í•˜ê³  ì„ íƒëœ `ê²Œì‹œë¬¼ ë°ì´í„°` ë¥¼ `postDetailì˜ ì»´í¬ë„ŒíŠ¸ propsë¡œ ë³´ë‚¸ë‹¤` .

#### QUIZ

- ì´ ë¶€ë¶„ì„ `useQuery` ë¥¼ ì‚¬ìš©í•´ ë°”ê¾¸ì–´ `data` ë¥¼ `ë§¤í•‘` í•´ì£¼ëŠ” êµ¬ë¬¸ì´ ì œëŒ€ë¡œ ë°˜í™˜í•  ìˆ˜ ìˆë„ë¡.

```jsx
// replace with useQuery
const data = [];
```

âœ… `scaffolding Code`

```jsx
// Posts.jsx
{selectedPost && <PostDetail post={selectedPost} />}

// PostDetail.jsx
async function fetchComments(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/comments?postId=${postId}`
  );
  return response.json();
}

async function deletePost(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/postId/${postId}`,
    { method: "DELETE" }
  );
  return response.json();
}

async function updatePost(postId) {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/postId/${postId}`,
    { method: "PATCH", data: { title: "REACT QUERY FOREVER!!!!" } }
  );
  return response.json();
}

export function PostDetail({ post }) {
  // replace with useQuery
  const data = [];

  return (
    <>
      <h3 style={{ color: "blue" }}>{post.title}</h3>
      <button>Delete</button> <button>Update title</button>
      <p>{post.body}</p>
      <h4>Comments</h4>
      {data.map((comment) => (
        <li key={comment.id}>
          {comment.email}: {comment.body}
        </li>
      ))}
    </>
  );
}

```


### ğŸ“Œ ë‚´ í’€ì´ ì½”ë“œ

```jsx
export function PostDetail({ post }) {
  const { data, isLoading, isError, error } = useQuery("comments", () =>
    fetchComments(post.id)
  );
  if (isLoading) return <h3>Loading...</h3>;
  if (isError) 
    return (
      <>
        <h3>Comments Loading Fail</h3>
      </>
    );

  return (
    <>
      <h3 style={{ color: "blue" }}>{post.title}</h3>
      <button>Delete</button> <button>Update title</button>
      <p>{post.body}</p>
      <h4>Comments</h4>
      {data.map(comment => (
        <li key={comment.id}>
          {comment.email}: {comment.body}
        </li>
      ))}
    </>
  );
}
```


### ğŸ“Œ Keypoint

- `Query Key` : React QueryëŠ” `ì¿¼ë¦¬ í‚¤` ë¥¼ í†µí•´ íŠ¹ì • ì¿¼ë¦¬ì˜ ìºì‹œì™€ staleTimeì„ ì‹ë³„í•˜ê¸° ë•Œë¬¸ì— `"comments"` ë¼ëŠ” ê³ ìœ í•œ `í‚¤` ê°’ì„ ì£¼ì—ˆë‹¤.
- `parameter` : `fetchComments` ë¥¼ ë³´ë©´ `postid` ë¼ëŠ” `parameter` ê°€ í•„ìš”í•˜ë‹¤. ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ì—ì„œì²˜ëŸ¼ `fetch í•¨ìˆ˜` ë¡œ ê°€ì ¸ì˜¤ì§€ ì•Šê³  `postid` ê°€ ë¬´ì—‡ì´ë“  ìƒê´€ì—†ì´ ëŒ“ê¸€ì„ ê°€ì ¸ì˜¤ëŠ” ìµëª…í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì£¼ì—ˆë‹¤. `() => fetchComments(post.id)` . `id ê°’` ì€ `propsë¡œ ë°›ì•„ì˜¨ post` ì—ì„œ ì¶”ì¶œ.
- `isLoading, isEror` : ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•´ì„œ ê°ê° ê°’ë“¤ì´ `true` ê°€ ë˜ì—ˆì„ ë•Œ ë°˜í™˜ë  ìˆ˜ ìˆëŠ” ì•ˆë‚´ë©”ì‹œì§€ë¥¼ êµ¬í˜„. â­ï¸ ì´ ë‘ ê°’ì´ `true` ì¼ê²½ìš°ì—ëŠ” `ì¡°ê¸° ë°˜í™˜` í•œë‹¤.

#### âœ… í˜„ì¬ì˜ ë¬¸ì œì 

ì–´ë–¤ ê²Œì‹œë¬¼ì„ í™•ì¸í•´ë„ `ê°™ì€ ëŒ“ê¸€` ì´ í‘œì‹œëœë‹¤. ê°ê°ì˜ ê²Œì‹œë¬¼ì— ëŒ€í•œ ëŒ“ê¸€ì´ ì•„ë‹Œ `ì²« ë²ˆì§¸ë¡œ í´ë¦­í•œ ê²Œì‹œë¬¼` ì— ëŒ€í•œ ê²ƒì´ë‹¤. `ì¿¼ë¦¬ í‚¤` ë¥¼ ë‹¤ë£¨ë©´ì„œ ë” ì•Œì•„ë³´ì•„ì•¼ í•œë‹¤.

### ğŸ“Œ â­ï¸ ì¿¼ë¦¬ í‚¤ â­ï¸

í˜„ì¬ì˜ ë¬¸ì œì ì€ `ì²« ë²ˆì§¸ ê²Œì‹œë¬¼ì— ëŒ€í•œ ëŒ“ê¸€` ì´ ì–´ë–¤ ê²Œì‹œë¬¼ì„ ë¡œë”©í•˜ë“ ê°„ì— ë‚˜ì™”ë‹¤.
ì´ ë¬¸ì œì˜ ì›ì¸ì€ `ì¿¼ë¦¬ í‚¤` ì— ìˆë‹¤.  `comments` ì¿¼ë¦¬ í‚¤ëŠ” `10:46` ë¶„ì— ì—…ë°ì´íŠ¸ ë˜ì—ˆë‹¤. ë‹¤ë¥¸ ê²Œì‹œë¬¼ì„ í´ë¦­í•´ë„ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ”ë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-07 á„‹á…©á„’á…® 10 46 31](https://github.com/chromeheartz/TIL/assets/95161113/babdaa71-ce43-4bae-a406-3b3bd94a0a99)

ë°ì´í„°ëŠ” `ë§Œë£Œ(stale)` ë˜ì—ˆê³  `ë¦¬íŒ¨ì¹­(refetching)` í•˜ì§€ë„ ì•ŠëŠ”ë‹¤.

### ğŸ“Œ ì™œ refresh ë˜ì§€ ì•Šì„ê¹Œ?

ëª¨ë“  ì¿¼ë¦¬ê°€ `comments` ì¿¼ë¦¬ í‚¤ë¥¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.
ì´ë ‡ê²Œ ì•Œë ¤ì§„ ì¿¼ë¦¬ í‚¤ê°€ ìˆì„ ë•ŒëŠ” `ì–´ë– í•œ íŠ¸ë¦¬ê±°` ê°€ ìˆì–´ì•¼ë§Œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.

#### Triggers

- ì»´í¬ë„ŒíŠ¸ë¥¼ `ë‹¤ì‹œ ë§ˆìš´íŠ¸` í•  ë•Œ
- ìœˆë„ìš°ë¥¼ `ë‹¤ì‹œ í¬ì»¤ìŠ¤` í•  ë•Œ
- useQueryì—ì„œ ë°˜í™˜ë˜ì–´ `ìˆ˜ë™ìœ¼ë¡œ ë¦¬íŒ¨ì¹­` í•  ë•Œ
- `ì§€ì •ëœ ê°„ê²©` ìœ¼ë¡œ ë¦¬íŒ¨ì¹­ì„ ìë™ ì‹¤í–‰í•  ë•Œ
- `ë³€ì´(Mutations)` ì„ ìƒì„±í•œ ë’¤ ì¿¼ë¦¬ë¥¼ `ë¬´íš¨í™”` í•˜ë©´ `í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° / ì„œë²„ì˜ ë°ì´í„°` ì™€ ë¶ˆì¼ì¹˜ í•  ë•Œ ë¦¬íŒ¨ì¹­ì´ íŠ¸ë¦¬ê±° ëœë‹¤.

â—ï¸ ìƒˆ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ ì œëª©ì„ í´ë¦­í•  ë•ŒëŠ” ì´ëŸ° íŠ¸ë¦¬ê±°ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ë°ì´í„°ê°€ ë§Œë£Œë˜ì–´ë„ ìƒˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ì•ŠëŠ”ê²ƒì´ë‹¤.

### ğŸ“Œ Solution

ìƒˆ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ ì œëª©ì„ í´ë¦­í•  ë•Œë§ˆë‹¤ ë°ì´í„°ë¥¼ ë¬´íš¨í™”ì‹œì¼œì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë° í˜„ì¬ì™€ëŠ” ë§ì§€ ì•ŠëŠ”ë‹¤. `ë°ì´í„°ë¥¼ ì œê±°` í•´ì„œëŠ” ì•ˆëœë‹¤.
`ë¸”ë¡œê·¸ ê²Œì‹œë¬¼2` ì˜ ëŒ“ê¸€ì— ëŒ€í•œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ ë•Œ ìºì‹œì—ì„œ `ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ 1` ì˜ ëŒ“ê¸€ì„ ì œê±°í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤. ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ `ê°™ì€ ìºì‹œ ê³µê°„ì„ ì°¨ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤` .
â—ï¸`ìºì‹œ ë°ì´í„°` ë¥¼ ë®ì–´ì“°ëŠ”ê²ƒì´ ì•„ë‹Œ ê¸°ì¡´ì— ìˆëŠ” `ìºì‹œ ë°ì´í„°` ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

`ê²Œì‹œë¬¼ ID(post.id)` ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— `ì¿¼ë¦¬ë³„ë¡œ` ìºì‹œë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆìœ¼ë©° `comments ì¿¼ë¦¬ì— ëŒ€í•œ ìºì‹œ` ë¥¼ ê³µìœ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ê° ì¿¼ë¦¬ì— í•´ë‹¹í•˜ëŠ” ìºì‹œë¥¼ ê°€ì§€ê²Œ ë ê²ƒì´ë‹¤.
â­ï¸ ê° ê²Œì‹œë¬¼ì— ëŒ€í•œ `ì¿¼ë¦¬ì— ë¼ë²¨` ì„ ì„¤ì •í•˜ë©´ ëœë‹¤.

### ğŸ“Œ Array as Query Key

`ì¿¼ë¦¬ í‚¤` ì— `ë¬¸ìì—´(String)` ëŒ€ì‹  `ë°°ì—´(Array)` ì„ ì „ë‹¬í•˜ë©´ ê°€ëŠ¥í•˜ë‹¤.
`['comments', post.id]`

ì´ë ‡ê²Œ ë˜ë©´ `ì¿¼ë¦¬ í‚¤` ë¥¼ ì¿¼ë¦¬ì— ëŒ€í•œ `ì˜ì¡´ì„± ë°°ì—´(dependency array)` ë¡œ ì·¨ê¸‰í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ì¿¼ë¦¬ í‚¤ê°€ ë³€ê²½ë˜ë©´(post.idê°€ ì—…ë°ì´íŠ¸ë˜ë©´) React Queryê°€ `ìƒˆ ì¿¼ë¦¬ë¥¼ ìƒì„±` í•´ì„œ `staleTime / cacheTime` ì„ ê°€ì§€ê²Œ ëœë‹¤. `ì˜ì¡´ì„± ë°°ì—´` ì´ ë‹¤ë¥´ë‹¤ë©´ ì™„ì „íˆ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ê°„ì£¼ëœë‹¤.

â­ï¸ ë”°ë¼ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì‚¬ìš©í•˜ëŠ” `ì¿¼ë¦¬ í•¨ìˆ˜ì— ìˆëŠ” ê°’` ì´ `ì¿¼ë¦¬ í‚¤` ì— í¬í•¨ë˜ì–´ì•¼ í•œë‹¤. ê·¸ë ‡ê²Œ í•˜ë©´ ëª¨ë“  ì¿¼ë¦¬ê°€ ê°™ì€ ì¿¼ë¦¬ë¡œ ê°„ì£¼ë˜ëŠ” ìƒí™©ì„ ë§‰ê³  ê°ê¸° ë‹¤ë¥¸ ì¿¼ë¦¬ë¡œ ë‹¤ë¤„ì§ˆê²ƒì´ë‹¤.

```jsx
// Posts.jsx
const { data, isLoading, isError, error } = useQuery(["comments", post.id], () => fetchComments(post.id));
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-07 á„‹á…©á„’á…® 11 08 43](https://github.com/chromeheartz/TIL/assets/95161113/a056ca50-e747-4891-a68f-d7d2f162a679)

ì´ë ‡ê²Œ ëœë‹¤ë©´ ì˜ì¡´ì„± ë°°ì—´ë¡œ ì‘ìš©í•˜ë©° ë¬¸ìì—´ "comments"ì— `ì‹ë³„ì` ê°€ ì¶”ê°€ëœ ê²ƒì´ë‹¤.
ì´ë•Œ `íšŒìƒ‰ 0` ìœ¼ë¡œ ë˜ì–´ ìˆëŠ” ë¶€ë¶„ì€ `inactive(ë¹„í™œì„±)` ìƒíƒœì¸ë° ë‹¤ë¥¸ ê²Œì‹œë¬¼ì„ í´ë¦­í•˜ìë§ˆì ë‹¤ë¥¸ ê²Œì‹œë¬¼ì˜ ì¿¼ë¦¬ë“¤ì´ ë¹„í™œì„±ëœë‹¤. `ê°€ë¹„ì§€ë¡œ ìˆ˜ì§‘` ë˜ê¸° ì „ê¹Œì§€ ìºì‹œì— ë‚¨ì•„ìˆì„ ê²ƒì´ë‹¤. â—ï¸ `cacheTime` ë™ì•ˆ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´.