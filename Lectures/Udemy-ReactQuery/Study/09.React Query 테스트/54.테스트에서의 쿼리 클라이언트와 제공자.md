## React Query í…ŒìŠ¤íŠ¸
### 54. í…ŒìŠ¤íŠ¸ì—ì„œì˜ ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ì™€ ì œê³µì
<hr>

### ğŸ“Œ Treatment Test

ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ì‘ì„±ì„ í• ê²ƒì¸ë° `treatments` ë¥¼ ëŒ€ìƒìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±.
- 1ï¸âƒ£: í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì€ `ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§` í•˜ëŠ” ê²ƒì¸ë°, ì´ ê²½ìš°ì—ëŠ” `treatments` ê°€ ë ê²ƒì´ë‹¤. 

```tsx
// treatments/tests/Treatments.test.tsx
import { render, screen } from '@testing-library/react';
import { Treatments } from '../Treatments';
test('renders response from query', () => {
  render(<Treatments />) // 1ï¸âƒ£
});
```

`npm test` ë¥¼ ì‚¬ìš©í•´ì„œ í„°ë¯¸ë„ì—ì„œ ì‹œì‘í•˜ë©´ ë˜ëŠ”ë°, `CRA(Create React App)` ì— ì²¨ë¶€ëœ `Jest` ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê³ , `Watch` ëª¨ë“œì—ì„œ `Jest` ë¥¼ ì„¤ì •í•œë‹¤.

ì²˜ìŒ í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤íŒ¨í•˜ëŠ”ë° `QueryClient` ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ê·¸ë ‡ë‹¤. 

#### í…ŒìŠ¤íŠ¸ ì§„í–‰ì„ ìœ„í•´ ì–´ë–»ê²Œ ì‘ì—…ì„ ì‹¤ì‹œí• ê¹Œ?

### ğŸ“Œ Wrap in Query Provider

`ë Œë”ë§` ì— ì•ì„œ `Query Provider` ë‚´ë¶€ì— ë Œë”ë§í•˜ë ¤ëŠ” ìš”ì†Œë¥¼ í¬í•¨ì‹œí‚¬ í•¨ìˆ˜ë¥¼ ìƒì„±í•´ì•¼í•œë‹¤.
ë¬¼ë¡  `ìºì‹œ / ê¸°ë³¸ê°’` ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ê¸° ìœ„í•´ `QueryClient` ê°€ í•„ìš”í•˜ë‹¤.
ê° í…ŒìŠ¤íŠ¸ì— ìƒˆë¡œìš´ ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì œê³µí•˜ë©´, ë°ì´í„°ë¥¼ ê³µìœ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `í…ŒìŠ¤íŠ¸ë¥¼ ê²©ë¦¬` í•˜ê¸°ì— ìµœì ì˜ ë°©ë²•ì´ë‹¤.
`ë³‘ë ¬ë¡œ ì‹¤ì‹œ` í•˜ëŠ” ê²½ìš°ëŠ” `í…ŒìŠ¤íŠ¸ì˜ ì‹ ë¢°ë„` ê°€ ë‚®ì•„ì§ˆ ìˆ˜ ìˆë‹¤.

ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ì— í•¨ìˆ˜ë¥¼ í¬í•¨ì‹œì¼œ ìƒì„±í•¨ìœ¼ë¡œì¨ `í…ŒìŠ¤íŒ…ì— ëŒ€í•œ ê¸°ë³¸ê°’` ì„ ì„¤ì •í•  ë•Œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. 
âœ… í…ŒìŠ¤íŒ…ì˜ ê²½ìš° `ìƒì‚°ê³¼ëŠ” ë‹¤ë¥¸ ê¸°ë³¸ê°’` ì„ ì‚¬ìš©í• ê²ƒì´ë‹¤.
ê·¸ë¦¬ê³  íŠ¹ì • í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ `Provider ë‚´ë¶€` ì— í¬í•¨ë˜ë„ë¡ `ì´ í•¨ìˆ˜ì— ì„¤ì •í•´ ì£¼ëŠ” ê²ƒ` ì™¸ì˜ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ëŠ” ê²½ìš° ì´ í•¨ìˆ˜ ë‚´ë¶€ì— í´ë¼ì´ì–¸íŠ¸ë¥¼ `ëª…ì‹œí•  ìˆ˜ ìˆë„ë¡ í—ˆìš©` í•œë‹¤.

> **DOCS ğŸ‘‰ [`testing-react-query`]**

#### â­ï¸ ì´ë²ˆ ì„¹ì…˜ì˜ ëª©í‘œ
`test-utils/index.tsx` íŒŒì¼ì— í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì—¬ ìš°ë¦¬ê°€ ì „ë‹¬í•˜ëŠ” `ëª¨ë“  UI` ë¥¼ ë˜í•‘í•˜ë„ë¡ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì´ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ `QueryProvider` ì— ë¶€ì—¬í•˜ëŠ” `ëª¨ë“  jsx` ë¥¼ ë˜í•‘í•˜ì—¬ í…ŒìŠ¤íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì‹¤í–‰ ë  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

### ğŸ“Œ test-utils/index.tsx

`ìƒˆ ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸` ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©. 
ì½”ë“œì˜ `FOR TESTING CUSTOM HOOKS` ì£¼ì„ í•˜ë‹¨ ë¶€ë¶„ì€ ì¶”í›„ `ì»¤ìŠ¤í…€ í›…` ì„ ë‹¤ë£¨ê¸° ìœ„í•œ ìš©ë„ì´ê³ , í˜„ì¬ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì„ê²ƒì´ë‹¤.

`generateQueryClient` ëŠ” ë‹¨ìˆœíˆ ìƒˆë¡œìš´ ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•  ë¿ì´ê³ , ì¶”í›„ì— `ë” ë³µì¡í•œ í˜•íƒœ(ì»¤ìŠ¤í…€ í›…ì„ í¬í•¨)` í•˜ëŠ” í˜•íƒœê°€ ë ë•Œ `ì»¤ìŠ¤í…€ í›… / ì»´í¬ë„ŒíŠ¸` ì–‘ìª½ ëª¨ë‘ì— ë„ì›€ì´ ë  í•¨ìˆ˜ë‹¤.

`ë˜í•‘í•´ ì¤„ í•¨ìˆ˜` ë¥¼ êµ¬í˜„í•˜ëŠ”ë° `renderWithQueryClient` ë¥¼ ë³´ë©´,
`React ìš”ì†Œì— í•´ë‹¹í•˜ëŠ” UI` ë¥¼ ë°›ê³ , ë¶€ê°€ì ìœ¼ë¡œ `client` ë˜í•œ ë°›ëŠ”ë‹¤.
ì—¬ê¸°ì—ì„œ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ í´ë¼ì´ì–¸íŠ¸(generateQueryClient) ë¥¼ íŠ¹ì • í…ŒìŠ¤íŠ¸ì—ì„œ `ì˜¤ë²„ë¼ì´ë“œ` í•˜ë ¤ë©´ ì˜ˆë¥¼ë“¤ì–´ `íŠ¹ì • ì˜µì…˜` ì´ í•„ìš”í•œ ê²½ìš° `RenderResult` ì¦‰, í…ŒìŠ¤íŒ… ë¼ì´ë¸ŒëŸ¬ë¦¬ ë Œë”ë§ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
`í…ŒìŠ¤íŒ… ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë Œë”ë§í•˜ë©´ ë°›ëŠ” ê²°ê³¼`

ê·¸ëŸ¼ `renderWithQueryClient` ì˜ ì—­í• ì€ `client` ê°€ ì—†ì„ ê²½ìš° ìƒì„±í•˜ëŠ” ê²ƒì´ë‹¤.
ë”°ë¼ì„œ queryClientë¥¼ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° `clientì™€ ë™ì¼í•˜ê²Œ ì„¤ì •` í•˜ê±°ë‚˜ / ì•Œ ìˆ˜ ìˆëŠ” ê²½ìš° `generateQueryClient` ë¥¼ ì‹¤í–‰í•´ `ìƒˆë¡œ ìƒì„±` í•œë‹¤.
#### â­ï¸ ì¦‰, ì´ ë°©ì‹ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µë˜ì§€ ì•Šìœ¼ë©´ ìƒˆë¡œ ìƒì„±

ì¶”ê°€ë¡œ `render` ë¥¼ `return` í•´ì£¼ëŠ”ë°, ì´ ë•Œ `render` ëŠ” `provider(ì œê³µì)` ê°€ ëœë‹¤.  ì´ ì œê³µìì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•˜ê³ , ì´ renderì— ì „ë‹¬í•œ `UI` ë¥¼ `queryClient` ì™€ `ë˜í•‘` í•˜ê²Œ ëœë‹¤.
```tsx
import { render, RenderResult } from '@testing-library/react';
import { ReactElement } from 'react';
import { QueryClient, QueryClientProvider } from 'react-query';

// make a function to generate a unique query client for each test
const generateQueryClient = () => {
  return new QueryClient();
};

export function renderWithQueryCient(
  ui: ReactElement,
  client?: QueryClient,
): RenderResult {
  const queryClient = client ?? generateQueryClient();

  return render(
    <QueryClientProvider client={queryClient}>{ui}</QueryClientProvider>,
  );
}

// **FOR TESTING CUSTOM HOOKS **
// import { defaultQueryClientOptions } from '../react-query/queryClient';
// from https://tkdodo.eu/blog/testing-react-query#for-custom-hooks
// export const createQueryClientWrapper = (): React.FC => {
//   const queryClient = generateQueryClient();
//   return ({ children }) => (
//     <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
//   );
// };

// Treatments.test.tsx
import { screen } from '@testing-library/react';
import { renderWithQueryCient } from 'test-utils';

import { Treatments } from '../Treatments';

test('renders response from query', () => {
  renderWithQueryCient(<Treatments />);
});

```



[`testing-react-query`]: https://tkdodo.eu/blog/testing-react-query#for-components