## Laravel & PHP

### 08. 더 많은 유틸리티 컨테이너 추가하기

---

### 📌 더 많은 유틸리티 컨테이너 추가하기

#### artisan

`artisan` 컨테이너를 추가해보자.
특정한 Laravel 명령을 실행하려면 `artisan` 도구가 필요하다.
예를 들어, 몇몇 초기 데이터로 데이터베이스를 채우기 위해서 이다.

artisan 명령에도 커스텀 dockerfile이 필요한데, `php.dockerfile` 을 사용해서 할것이다. `build` 구성을 추가하거나 php 서비스에서 build 구성을 복사하여 추가하면 된다.

artisan 은 PHP로 빌드된 Laravel 명령이다. 그래서 PHP가 필요한것.
추가로 볼륨이 필요한데 특히 소스 코드가 필요하다. 내 소스 코드에서 실행되기 떄문.

`- ./src:/var/www/html`
로컬 호스트 머신의 `src` 디렉토리를 컨테이너 내부 폴더인 `/var/www/html` 폴더에 노출한다. 이곳이 앱이 있을 곳이기 때문.

기존에 보지 않았던 새로운 것인데 `docker-compose` 파일 내부에서 일반적으로 설정한 `Dockerfile` 의 설정을 지정할 수도 있다.
`Dockerfile` 내부의 설정을 본질적으로 `오버라이드` 하기 때문.
`php.dockerfile` 을 보게되면 작업디렉토리를 설정해놓았는데 `entrypoint` 도 사용하고 싶다고 해보자.

이 `php` 컨테이너는 결국 `nginx` 에 의해 개별 파일을 처리하는데 사용되기 때문.
따라서 `nginx` 를 위한 유틸리티 컨테이너 처럼 사용된다고도 할 수 있다.

따라서 `docker-compose.yaml` 에서 `artisan` 에 `entrypoint` 로 오버라이드 할 수 있다.

> dockerfile에 entrypoint가 없는 경우.

`entrypoint: ["php", "/var/www/html/artisan"]`

`php` 베이스 이미지로 설정되고 특정 파일을 실행하는데 그 파일은 `/var/www/html/artisan` 폴더에서 찾을 수 있다.
php / php 이미지의 도움으로 컨테이너 내부에서 파일을 실행하는데 이 entrypoint를 이미지에 추가한다.

`php.dockerfile` 을 php컨테이너를 위해 사용하기 때문에 entrypoint를 dockerfile에서 설정하지 않는것이다.

#### npm

`node:14` 버전을 사용하고 작업디렉토리 / entrypoint 를 설정해줄것이다.
직접 dockerfile을 작성할 수도 있지만 `docker-compose` 내에서 진행해보자.
`WORKDIR` 도 `work_dir: /var/www/html` 로 설정해줄 수 있고
`entrypoint: ["npm"]` 으로 설정해주면 된다.

`volumes` 는 소스 코드 폴더에서 이 모든 작업을 수행하고 싶기 때문에 컨테이너 내부의 `/var/www/html` 폴더에 방니딩 한다.

이후 `docker-compose run --rn artisan migrate` 컨테이너를 실행해보게 되면 `php` 로 `artisan` 파일이 내부적으로 실행된다. `migrate` 명령도 넣을것인데 `Laravel` 이 지원하는 artisan 명령중에 하나이다. 이는 데이터베이스에 데이터를 기록한다. 따라서 데이터베이스 설정이 작동하는지 그 여부도 확인할 수 있다.
