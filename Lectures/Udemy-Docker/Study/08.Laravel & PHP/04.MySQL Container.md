## Laravel & PHP

### 04. MySQL Container

---

### 📌 MySQL Container

`mysql` 컨테이너를 만들어보자.
사용할 수 있는 공식 `mysql` 이미지를 사용할것인데, 이를 사용하여 데이터베이스를 시작하거나 데이터베이스가 포함된 컨테이너를 구동할것이다.
`MySQL` 은 MongoDB이미지와 매우 유사하다.

`image` 를 추가하고 버전을 넣어주면 이미지를 다운로드 할것이고 컨테이너가 시작될 때 이미지 내부에서 MySQL 데이터베이스가 시작될것이다.

이제 이 데이터베이스는 나중에 php 컨테이너에 있는 PHP코드에 의해 액세스 된다.
모든 서비스가 동일한 네트워크에 있으므로 컨테이너 이름을 사용하는 것만으로도 데이터베이스와 통신할 수 있다. 따라서 네트워크와 관련하여 아무 것도 구성할 필요가 없다.

하지만 구성해야 할 한가지가 있는데 `environment` 이다.
이미지에 의해 사용될 몇몇 환경 변수를 제공해야 하는데, 데이터베이스를 설정하고 사용자와 비밀번호 등을 설정하게 된다.

도커 허브에서 `mysql` 이미지에 대한 설명을 찾아보자.
![](https://velog.velcdn.com/images/chromeheartz/post/b7f084b8-b752-4e9c-a67c-0fc8acacb6bd/image.png)

환경 변수를 설정할 수 있고, 몇가지가 있는데 `.env` 파일에서 설정해보자.
`/env/mysql.env` 파일을 만들어서 편집
`MYSQL_DATABASE` 를 먼저 작성해줄것인데 문서를 보면 설명이 있다.
이것은 컨테이너가 시작될 때 생성되는 `디폴트 초기 데이터베이스` 의 이름으로 적용된다. 일단 지금은 `homestead` 라고 설정하자. 이에 대한 건 또 `Laravel` 문서에서 찾을 수 있다.

또한 사용할 또 다른 환경 변수인 디폴트 사용자를 설정한다.
여기도 `Laravel` 디폴트 값을 사용하여 `homestead` 로 설정해준다.
이 초기 루트 사용자용 비밀번호를 지정하기 위해 `MYSQL_PASSWORD / MYSQL_ROOT_PASSWORD` 를 둘다 설정해준다.

```env
MYSQL_DATABASE=homestead
MYSQL_USER=homestead
MYSQL_PASSWORD=secret
MYSQL_ROOT_PASSWORD=secret
```

이렇게 해주고 `docker-compose` 에서 `env_file` 을 써주고 경로를 지정해준다.
이제 `server / php / mysql` 세개의 컨테이너를 만들었는데 여기서 제대로 작동하는지 테스트하기 위해서는 `Laravel` 앱이 필요한데 `composer` 도구를 사용하여 만들어보자.

```yaml
version: "3.8"

services:
  server:
    image: "nginx:stable-alpine"
    ports:
      - "8000:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
  php:
    build:
      context: ./dockerfiles
      dockerfile: php.dockerfile
    volumes:
      - ./src:/var/www/html:delegated
    # ports:
    #   - "3000:9000"
  mysql:
    image: "mysql:5.7"
    env_file:
      - ./env/mysql.env
  # composer:
  # artisan:
  # npm:
```
