## Laravel & PHP

### 09. Dockerfile이 있거나 없는 Docker Compose

---

### 📌 Dockerfile이 있거나 없는 Docker Compose

몇몇 개념과 이해해야할것들이 몇개 남아있는데, 예를 들어 `Dockerfile 명령` 을 `docker-compose` 에 추가하는 것 같은. `entrypoint / working_dir` 같은 명령이다.
이것은 반드시 해야 하는 일은 아니다 대신 `Dockerfile` 을 만들어 그 파일을 가리키는 것이 대안이 될 수 있다.

거기에 `WORKDIR / ENTRYPOINT` 를 추가하여 베이스 이미지를 구축할 수 있다.
부가 `Dockerfile` 을 저장하기 위해 모두 `docker-compose` 파일 내에 넣고, 선호하는 접근방식은 내가 정하는 것이다. 하지만 강의를 하는 사람은 `Dockerfile` 로 사용하는 것을 선호한다고 한다.
그 의도가 무엇인지 매우 명확하고 `docker-compose file` 을 간결하게 유지할 수 있다고 생각하기 때문이다. 하지만 다른 한편으로는 항상 `Dockerfile` 을 살펴보고 그 안에서 무슨 일이 생기는지 확인해야 한다.

예를 들어 이미지에서 특정 명령을 실행하거나 무언가를 복사해야 하는 경우와 같은 더 복잡한 명령의 경우에는 어쨌든 `Dockerfile` 이 필요할 것이다.
docker-compose 파일에는 `COPY / RUN` 을 사용할 수 없기 때문이다.

즉, 기본 이미지에 entrypoint와 작업디렉토리를 설정하고자 한다면 `docker-compose` 파일 내에서는 그것만 할 수 있다.
이와 관련해서 `server` 서비스 예제의 바인드 마운트를 한번 봐보자.

호스트 머신상의 두 개의 볼륨 / 두개의 폴더를 컨테이너의 폴더에 바인딩한다.
소스 폴더는 `server` 에 노출되며 `nginx.conf` 파일도 그렇다.
이후에 많은 바인딩 마운트로 작업하고 있는데 php, composer, artisan, npm에 있다.

여기서 바인드 마운트에 항상 염두에 둬야할 것이 있는데 바인드 마운트는 호스트 머신의 특정 폴더를 컨테이너로 미러링할 수 있다. 하지만 컨테이너를 `배포` 할 계획이라면 이는 선택사항이 아니다.
바인드 마운트이기에 호스트 머신의 로컬 폴더는 실제 호스트 머신에서만 사용할 수 있다.
서버 컨테이너를 취해서 다른 서버에 넣으면 소스코드 / 폴더 구조가 그곳에는 존재하지 않는다. 물론 만들 수는 있지만 `주변에 폴더 시스템을 생성` 해야 하는 것은 컨테이너의 아이디어 사상이 아니다. 대신 컨테이너 이면의 아이디어는 컨테이너에 필요한 `모든 것` 이 컨테이너 내부에 있다는 것이다.

그리고 바인드 마운트의 아이디어는 개발 시간을 편하게 만드는 것이다.
예를 들어, 항상 최신 코드와 최신 nginx 구성이 컨테이너에 직접 노출되기 때문.
그 의미는 `server` 에 대한 `Dockerfile` 을 만들고 소스 코드와 nginx 구성을 그 이미지로 복사하는 것을 고려할 수도 있다는 것이다.
그것으로 개발 중에 작동하는 바인드 마운트 외에도 기존의 소스 코드의 스냅샷을 복사하고 빌드할 때, 이미지 내에 구성을 갖도록 하는것이다.

> 즉, 나중에 이미지를 배포할 때 필요한 모든 소스 코드와 구성이 이미 포함되어 있다.
