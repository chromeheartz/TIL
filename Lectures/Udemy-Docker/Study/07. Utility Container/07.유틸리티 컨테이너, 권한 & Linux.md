## Utility Container

### 07. ìœ í‹¸ë¦¬í‹° ì»¨í…Œì´ë„ˆ, ê¶Œí•œ & Linux

---

### ğŸ“Œ ê¶Œí•œ & Linux

`Linux` ì—ì„œ ìœ í‹¸ë¦¬í‹° ì»¨í…Œì´ë„ˆë¡œ ì‘ì—…í•  ë•Œ í•´ë‹¹ ìŠ¤ë ˆë“œë¥¼ ì‚´í´ë³´ëŠ” ê²ƒì´ ì¢‹ë‹¤.
`docker` ì—ì„œ ì„¤ì •í•œ ì‚¬ìš©ì ê¶Œí•œê³¼ ì´ë¥¼ ì¡°ì •í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ìˆë‹¤.

### ğŸ§± Utility Containers and Linux

#### âš ï¸ ë¬¸ì œì  (ë¦¬ëˆ…ìŠ¤ í™˜ê²½)

ë¦¬ëˆ…ìŠ¤ì—ì„œ DockerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ root ì‚¬ìš©ìë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ,
ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ìƒì„±ëœ íŒŒì¼ì´ root ì†Œìœ ê¶Œì„ ê°–ê²Œ ë¨.

```dockerfile
# Dockerfile
FROM node:14-slim
WORKDIR /app
```

```bash
$ docker build -t node-util:perm .
$ docker run -it --rm -v $(pwd):/app node-util:perm npm init
$ ls -la
```

ê²°ê³¼:

```bash
-rw-r--r-- 1 root root 202 Oct 31 16:16 package.json
```

ì¦‰, ë°”ì¸ë“œ ë§ˆìš´íŠ¸ë¥¼ í†µí•´ ìƒì„±ëœ ëª¨ë“  íŒŒì¼ì´ root ì†Œìœ ë¡œ ì €ì¥ë¨.

<hr />

#### âœ… í•´ê²°ì±… 1: ë¯¸ë¦¬ ì •ì˜ëœ "node" ì‚¬ìš©ì ì‚¬ìš©

ê³µì‹ Node.js ì´ë¯¸ì§€ì—ëŠ” ì´ë¯¸ ë¹„-root ì‚¬ìš©ìì¸ `node` ê°€ ì •ì˜ë˜ì–´ ìˆìŒ.
(UID:GID = `1000:1000` )

ì°¸ê³ :
https://github.com/nodejs/docker-node/blob/master/Dockerfile-slim.template

```dockerfile
FROM node:14-slim
USER node
WORKDIR /app
```

ë¹Œë“œ í›„ ì‹¤í–‰:

```bash
$ docker build -t node-util:user .
$ docker run -it --rm -v $(pwd):/app node-util:user npm init
$ ls -la
```

ê²°ê³¼:

```bash
-rw-r--r-- 1 scott scott 204 Oct 31 16:23 package.json
```

<hr />

#### âœ… í•´ê²°ì±… 2: ì§ì ‘ ì‚¬ìš©ì ìƒì„±

ë¦¬ëˆ…ìŠ¤ ì‚¬ìš©ì UID/GIDê°€ 1000:1000ì´ ì•„ë‹ ê²½ìš°,
ê¸°ì¡´ `node` ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ê³  **í˜„ì¬ í˜¸ìŠ¤íŠ¸ ì‚¬ìš©ì ì •ë³´ë¡œ ìƒˆ ê³„ì • ìƒì„±.**

```dockerfile
# Dockerfile
FROM node:14-slim

RUN userdel -r node

ARG USER_ID
ARG GROUP_ID

RUN addgroup --gid $GROUP_ID user
RUN adduser --disabled-password --gecos '' --uid $USER_ID --gid $GROUP_ID user

USER user
WORKDIR /app
```

ë¹Œë“œ:

```bash
$ docker build -t node-util:cliuser \
  --build-arg USER_ID=$(id -u) \
  --build-arg GROUP_ID=$(id -g) .
```

ì‹¤í–‰:

```bash
$ docker run -it --rm -v $(pwd):/app node-util:cliuser npm init
$ ls -la
```

ê²°ê³¼:

```bash
-rw-r--r-- 1 scott scott 202 Oct 31 16:54 package.json
```

ğŸ“ ì°¸ê³  ë§í¬

- **Node ê³µì‹ ì´ë¯¸ì§€ Dockerfile ì˜ˆì‹œ**
  https://github.com/nodejs/docker-node/blob/main/Dockerfile-slim.template
- **Docker íŒŒì¼ ê¶Œí•œ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ (vsupalov.com)**
  https://vsupalov.com/docker-shared-permissions/
