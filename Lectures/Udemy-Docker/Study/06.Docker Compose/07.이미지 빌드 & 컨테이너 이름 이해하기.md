## Docker Compose

### 07. 이미지 빌드 & 컨테이너 이름 이해하기

---

### 📌 이미지 빌드 & 컨테이너 이름

도커 컴포즈는 매우 유용한 도구이다.
`docker-compose up / down` 은 작업할때 도움이 많이 될것인데, 명령의 변형으로 두 가지의 다른 명령이 있다.
그리고 이러한 컨테이너 및 서비스 이름 지정에 대한 또다른 사항이 있다.

#### 명령

`docker-compose up --help` 를 사용해보자.
up명령에는 설정할 수 있는 특정한 옵션이 있는데 `--build` 옵션이다.
`--build` 옵션을 up 명령에 추가하면 `이미지 리빌드` 를 강제할 수 있다.

그렇지 않으면 자체 `dockerfile` 기반으로 빌드하는 `backend` 이미지와 같은 이미지가 한번만 빌드되는데, 도커 컴포즈가 이 이미지를 찾으면 기존 이미지를 재사용한다.
이게 문제가 되지 않을텐데, 코드에서 무언가가 변경되어 새 이미지를 빌드 해야 한다면 강제할 수 있다는 뜻이다.

`yaml` 에 정의된 이미지를 빌드하려는 경우를 보자.
`build` 키는 빌드하는 이미지를 의미하는 것이지 `image` 키에서 가리키는 이미지를 의미하는 것은 아니다. 즉, image키의 이미지는 도커 허브 또는 다른 레지스트리에서 가져오는 이미지이고, 이미 빌드되어 있다.

자체 이미지의 경우 `docker-compose` 파일에서 찾을 수 있는 커스텀 이미지를 빌드하려는 경우 `docker-compose build` 를 사용하여 이를 수행할 수 있다.
`up` 옵션으로 실행하면 빌드 단계가 포함된다.

컨테이너를 시작하지 않고 빌드만 하려는 경우에 `docker-compose build` 를 실행할 수 있다.이 명령은 누락된 이미지를 빌드한 다음 컨테이너를 시작하지는 않는다.

#### 컨테이너 이름과의 관련

`docker ps` 명령을 실행하면 3개의 컨테이너가 있고, 이름들이 비슷한것을 볼 수 있다.
![](https://velog.velcdn.com/images/chromeheartz/post/9f3ada42-56c8-4714-9d84-1acdbfaf2e96/image.png)

이것이 도커 컴포즈에 정의한 이름은 아니라는 것이다.
단지 서비스의 이름일 뿐이며 컨테이너로 번역된다. `service` 에 정의한것들이 컨테이너 이름으로 올라가지는 않는다. 전체 이름은 실제로 프로젝트 폴더 이름이 추가되는 것이다.

> 자체 컨테이너 이름을 지정하려면 `container_name` 옵션을 추가하면 된다.

```yaml
version: "3.8"
services:
  mongodb:
    image: mongo:8.2.1
    volumes:
      - data:/data/db
    container_name: mongodb
    # environment:
    #   MONGO_INITDB_ROOT_USERNAME: root
    #   MONGO_INITDB_ROOT_PASSWORD: secret
    #  - MONGO_INITDB_ROOT_USERNAME=root
    env_file:
      - ./env/mongo.env
    # network:
    #   - goals-net
  backend:
    build: ./backend
    container_name: backend
    # build:
    #   context: ./backend
    #   dockerfile: Dockerfile
    # args:
    #   some-arg: 1
    ports:
      - "80:80"
    volumes:
      - logs:/app/logs
      - ./backend:/app
      - /app/node_modules
    env_file:
      - ./env/backend.env
    depends_on:
      - mongodb
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend/src:/app/src
    stdin_open: true
    tty: true
volumes:
  data:
  logs:
```

> 결국 도커 컴포즈를 사용하면 로컬 호스트 머신에서 다중 컨테이너 애플리케이션을 구축하고 `하나의 명령 / 하나의 구성파일` 을 사용하여 모든 컨테이너를 시작하고 제어할 수 있다.
