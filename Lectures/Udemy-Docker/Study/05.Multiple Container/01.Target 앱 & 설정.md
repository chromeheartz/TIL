## Multiple Container

### 01. Target 앱 & 설정

---

### 📌 Target 앱

먼저 이제 구축하려는 프로젝트에 대한 이론을 보자.
`3가지` 의 주요 빌딩 블록을 가지게 될것이다.

- `mongodb database` : 앱에서 생성된 데이터를 저장하기 위함
- `backend` : nodejs rest api를 구현할것인데, nodejs로 만들어진 웹서버이자 웹 애플리케이션이다.
  단순히 JSON데이터를 받아들이고 반환할 뿐
- `frontend` : react로 구축된 웹 애플리케이션을 구축할것이다.

일반적으로 매우 전형적인 설정인데, 이런식으로 나누어서 웹 애플리케이션을 구현한다.
데이터베이스를 가지고 그리고 웹사이트를 방문하는 최종사용자에 의해 직접적으로 사용되지 않는 백엔드 웹 서버를 갖기 위해서이다. 그 대신 프론트엔드가 있는데, 사용자의 화면에 무언가를 표시하여 `HTML 코드` 를 렌더링하는 역할을하고, 이후 프론트엔드는 백엔드와 통신한다.

> 즉, 이러한 3개의 빌딩 블록 사이에는 통신을 해야한다.
> 백엔드는 데이터를 저장하고, 가져오기 위해 데이터베이스와 통신하고
> 프론트엔드는 백엔드와 통신한다.

일단 현재 기점에서 mongodb를 로컬에 설치하지않으면 에러가 날 수 있는데, 나중에 도커화할것이니 무시하고 진행.
일단 backend에서는 node, express로 빌드된 node앱이 있고, 이 앱은 결국 사용자가 목표를 설정하면, 그것을 확인하고 삭제할 수 있도록 몇 가지 요청을 받는다.
일단 `npm install` 을 사용하여 모든 종속성을 설치하고, `node app.js` 를 실행하여 백엔드 API 서버를 불러올 수 있다. 프론트엔드에서도 마찬가지로 종속성을 가져와서 실행.
프론트엔드 노드는 16버전으로해야 에러가 안남 현재 프로젝트에서.

지금은 프론트엔드 개발서버 / 백엔드 API서버로 두 개의 개발 서버가 있다.
노드 API는 `포트 80` 에서 실행된다. 이 포트가 앱이 실행될때 서버가 수신하는 포트이다.

프론트엔드 / 백엔드 / 데이터베이스가 서로 통신하면서 이루어진다.
따라서 이 세 가지 빌딩 블록에 대해, 특히 도커화하는 것에 대해 생각할때 염두에 두어야할 중요한 사항이 있다.

`데이터베이스 / 컨테이너` 에 대한 것인데, `MongoDB` 를 컨테이너에 넣으면 당연히 데이터가 `지속` 되어야 한다. 제거했다가 다시 생성되도 손실되지 않아야 한다.
또한 액세스를 제한해야하는데, 공식 mongo 이미지는 mongo 이미지와 컨테이너에서 생성된 데이터베이스에 사용자와 비밀번호를 추가하는 방법을 제공한다. 따라서 이 모듈에 대해서도 살펴보자.

일단 `Node 백엔드 API` 의 경우에도 데이터가 지속되어야 한다.
데이터베이스에 저장되는 목표들이 아니고, 로그 파일들에 대한 얘기를 하는 것이다.
이 백엔드가 컨테이너에 도커화된다면 `log data` 들을 유지해야 할것이다.

마지막으로 `소스 코드 변경 사항` 이 즉시 반영되어야 한다.
현재는 즉각 반영되지 않는데, 이미지를 리빌드해서 컨테이너를 재시작. 하는 절차가 없이도 컨테이너 앱에서 항상 즉시 사용할 수 있도록 노출하는 방법이 필요하다.
