## Multiple Container

### 08. NodeJS 컨테이너의 볼륨, 바인드 마운트 및 폴리싱 - 2

---

### 📌 두 가지 추가 사항

`mongodb` 를 연결하는 사용자 이름, 비밀번호를 하드 코딩했다.
하지만 이것은 `mongodb container` 를 시작할때 변경하거나, 다른 사용자 이름이나 다른 비밀번호로 실행할 수도 있을 것이다.
그렇게 되면 `backend` 코드를 바꾸어야 하는데 이를 `환경 변수` 를 활용하여 동적 값을 삽입해보자.

`Dockerfile` 에서 `ENV` 명령으로 환경 변수를 추가.

```dockerfile
ENV MONGODB_USERNAME=root
ENV MONGODB_PASSWORD=secret
```

코드를 추가해주자. 이것을 컨테이너 환경과 실행 중인 코드에서 사용할 수 있다.
`${}` 을 추가한다음 동적으로 변환될 값을 추가하면 된다.
`process.env` 다음 `MONGODB_USERNAME` 을 입력.
`mongodb://${process.env.MONGODB_USERNAME}:${process.env.MONGODB_PASSWORD}@mongodb:27017/course-goals?authSource=admin`

같은 맥락으로 `MONGODB_PASSWORD` 도 동적으로 주입시켜주도록 하자.
컨테이너를 중지시키고, 이제 환경 변수에 특정 값을 전달하여 다시 시작하고자 한다.

mongodb 에서 사용자 이름을 맞춰서 다시 올려주어야 한다.
기존엔 디폴트 값으로 사용했지만, 이 컨테이너를 다시 실행할때는 `-e` 를 사용하여 환경 변수를 추가하고 `MONGODB_USERNAME=max` 로 설정해보자.

```
docker run --name mongodb -v data:/data/db --rm --network goals-net -e MONGODB_USERNAME=root mongo:8.2.1
```

이런식으로 USERNAME만 설정하고 실행해보자.
제대로 연결되는 것을 볼 수 있다.

이렇게 자체 환경 변수를 추가할 수 있다.

`Dockerfile` 덕분에 종속성이 설치된 후 백엔드 폴더의 모든 것을 컨테이너로 복사했다.
하지만 컨테이너에 복사하는 파일 중에 그곳에 복사하고싶지 않은 파일이 있는데 이를 위해 `.dockerignore` 파일을 추가하자.

```
node_modules
Dockerfile
.git
```

#### 사용한 명령어

```
// front
docker run --name goals-frontend --network goals-net --rm -p 3000:3000 -it goal-react

// back
docker run --name goals-backend -v /Users/bibi/Documents/GitHub/TIL/Lectures/Udemy-Docker/Code/05-multi-starting-setup/backend:/app -v logs:/app/logs -v /app/node_modules -e MONGODB_USERNAME=root -d --rm -p 80:80 --network goals-net goal-node

// mongo
docker run --name mongodb -v data:/data/db --rm --network goals-net -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=secret -e MONGO_INITDB_DATABASE=course-goals mongo:8.2.1
```
