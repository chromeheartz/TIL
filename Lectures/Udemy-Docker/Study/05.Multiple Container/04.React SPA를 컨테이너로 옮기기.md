## Multiple Container

### 04. React SPA를 컨테이너로 옮기기

---

### 📌 React

일단 프론트엔드를 작업해보자. 그 이후에 데이터가 지속되는지, 소스코드가 실시간으로 업데이트 되는지 확인해볼것이다. 마찬가지로 여기서도 도커화를 하려면 `Dockerfile` 을 작성해야 한다.
일단 그 전에 `react` 프로젝트 설정에 대한 기본적인 지식이 필요한데, 그렇지 않으면 이해하기 어려울것이다.
프론트엔드 설정은 결국 node에 의존하는데, 이것은 node 앱이 아니다.
하지만 node를 사용하여 react앱을 제공하는 개발 서버를 가동한다.

node는 react 코드를 최적화하고 브라우저가 이해할 수 있는 코드로 변환되는데에 사용된다.
따라서 frontend 폴더에 있는 Dockerfile이 베이스 이미지로 node를 기반으로 해야하는 이유이기도 하다.

노드 코드를 직접 작성해서가 아니라 이 프로젝트 설정에 Nodejs가 필요하기 대문이다.

```dockerfile
FROM node:16

WORKDIR /app

COPY package.json .

RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
```

여기서 작업 디렉토리를 `/app` 이라고 해도 다른 컨테이너이기 때문에 충돌하지 않는다.
이후에 종속성을 COPY하고 기본적으로 백엔드와 동일하게 진행된다.
하지만 마지막에 이미지를 기반으로 컨테이너를 생성할 때마다 트리거되어야 하는 명령을 `npm start` 로 지정해야 한다.
애플리케이션을 로컬 호스트 머신 상에서 테스트할 때도 포트 3000이였으니 명시화해주도록 한다.

`docker build -t goal-react .`

이렇게 이미지를 빌드할 수 있다. 이후에 컨테이너를 실행할 것인데
`docker run --name goals-frontend --rm -d -p 3000:3000 goal-react`
중지되면 자동 제거 / detached모드에서 실행을 설정한 이후에 `로컬 호스트 포트 3000에 대한 컨테이너 내부 포트 3000` 을 게시한다

하지만 이렇게 실행해보면 이상하게 나오는데 `attached` 모드로 실행해서 로그를 봐보자.
개발 서버를 시작하는데 이후에 멈추는 것 같다.
![](https://velog.velcdn.com/images/chromeheartz/post/5f4698a9-b7b0-4750-9114-32aa1750117c/image.png)

#### 개발 서버가 가동된 직후에 컨테이너가 중지되는 이유는 무엇일까?

> `react` 설정과 관련이 있는데 `docker run` 명령에 `-it` 옵션을 추가해서 인터렉티브 모드로 실행해야 한다. 컨테이너를 시작하는 것만으로 끝이 아니라 명령을 입력하여 상호작용하는 것이 가능하기를 원한다고 컨테이너에 알려야 한다.

그런데 그렇게 하지는 않을것이다. `react` 는 이 입력을 수신하지 않으면 그것이 트리거가 되어 즉시 서버를 중지하는 방식으로 설정되어 있기 때문이다.
`docker run --name goals-frontend -d -p 3000:3000 -it goal-react`

따라서 이런식으로 컨테이너를 실행하게 되면 제대로 나오는 것을 볼 수 있다.

> 세 가지 블럭을 모두 자체 컨테이너에 넣었다.
> 이제 설정을 조금 다듬어보자.
