## Start

### 05. 예제

---

### 📌 간단한 예제코드

```js
// app.mjs
import express from "express";

import connectToDatabase from "./helpers.mjs";

const app = express();

app.get("/", (req, res) => {
  res.send("<h2>Hi there!</h2>");
});

await connectToDatabase();

app.listen(3000);

// helpers.mjs
const connectToDatabase = () => {
  const dummyPromise = new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve();
    }, 1000);
  });

  return dummyPromise;
};

export default connectToDatabase;
```

간단한 예제코드를 보자. `Node` 의 코드를 보면 그냥 몇 가지 기본 더미 코드가 있는 애플리케이션이다.
도커와 컨테이너 없이 로컬에서 실행하려면 `NodeJS.org` 를 방문해서 최신 버전의 노드를 다운받아야하고, 실행시켜야 한다.
실제로 그렇게 하기 전에 `npm install` 이라는 명령을 실행해서 `package.json` 에 나열된 모든 종속성을 설치해야 한다.

그런것들은 일단 각설하고 이러한 이미지를 생성하기 위해 도커파일을 생성하여 확장자 없이 단순히 `Dockerfile` 이라고 명령한다.
여기에 도커에게 최종적으로 컨테이너를 설정하는 방법을 설명할것이다.

```dockerfile
FROM node:14

WORKDIR /app

COPY package.json .

RUN npm install

COPY . .

EXPOSE 3000

CMD [ "node", "app.mjs" ]
```

나중에 더 자세히 알아볼것인데, 일단 지금은 이렇게 작성하고 하나씩 봐보자.
NodeJS를 기본이미지로 사용하려는 몇 가지 지침이 있고, 컨테이너 내부에서 사용할 수 있다.
컨테이너 파일 시스템 내에는 `특정 디렉토리` 가 있다. 모든 컨테이너에는 `자체 파일 시스템` 이 있음.
작업하고자 하는 특별한 디렉토리를 지니는 것이다.

그 이후 `package.json` 파일을 작업 디렉토리에 복사하고, `npm install` 명령을 실행해서 애플리케이션에 필요한 모든 종속성을 설치한다.

그런 다음 코드를 복사하고, 포트 3000을 외부에 노출하게 되는것.

이 포트가 애플리케이션이 수신대기하는 포트이기 때문에 컨테이너 내부뿐만아니라 컨테이너 외부에서 해당 포트에 도달할 수 있게 한다.
이후 `node` 명령으로 `app.mjs` 를 실행한다.

이제 터미널에서 `docker build .` 를 실행하게 되면 `Dockerfile` 이미지를 빌드하는데 이를 실행하는 디렉토리에서 찾게 된다.
![](https://velog.velcdn.com/images/chromeheartz/post/88a1b978-c48a-4662-8da4-2c5f7344a8cf/image.png)

`Dockerfile` 을 기반으로 이미지를 빌드하는데, 지금 이 상태가 이미 존재하는 노드 환경을 잡아내는 것이다. `Docker Hub` 에서 다운로드하게 되는것이다.
이후에 이미지 내부에서 실행되는 설정으로 시작되는 컨테이너의 이미지를 설정할것이고, 컨테이너로 시작될 준비가 되어진 이미지를 만들어 낸다.

```
 => => writing image sha256:520ab033dfa4539fa00882e89821b229c20a6bc5c0f9799d588c9980541e3531  0.0s
```

제대로 실행되면 이 이미지 결과물에 대한 `ID` 를 얻는데, `docker run ` 명령으로 해당 이미지를 기반으로 컨테이너를 시작할 수 있다.
실제로 실행하려는 컨테이너에 `publish` 를 해야하기 때문에 `-p` 플래그를 넣어주고 `3000:3000` 으로 포트를 게시한다. 즉, 로컬 시스템의 로컬 호스트를 사용하여 컨테이너 대신 포트 3000에서 실행되는 애플리케이션에 연결할 수 있는것이다.
컨테이너와 호스트 운영 체제 사이에는 디폴트 연결이 없기 때문이다.

예를 들어 컨테이너에서 실행중인 애플리케이션에 `HTTP 요청` 을 보내려면 통신하려는 컨테이너의 포트를 열어야 한다.

![](https://velog.velcdn.com/images/chromeheartz/post/e39ee6f9-b39b-4f73-952e-22103a1583d9/image.png)

현재는 3000 포트를 사용하고있어서 3001로 열었다.
`docker stop` 명령어로 실행중인 컨테이너를 중지시킬 수 있다. 결국 도커로 작동시켰는데, 시스템에 `NodeJS` 를 설치하지 않고 사용할 수 있었다. localhost:3000 도 방문할 수 있었던것은 도커때문에 가능한 일이였다.
