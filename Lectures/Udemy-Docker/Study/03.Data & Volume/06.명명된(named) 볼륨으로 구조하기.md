## Data & Volume

### 06. 명명된(named) 볼륨으로 구조하기

---

### 📌 명명된 볼륨

도커에는 실제로 여러 가지의 `외부 데이터 저장 메커니즘` 이 있다.

> ✅ `볼륨 / 바인드 마운트` 라고 한다.

#### 볼륨

일단 볼륨에 집중해보자.
실제로 볼륨은 `두 가지 타입` 의 볼륨이 있고, 둘 다 고유한 목적과 사용예가 있다.
현재 `익명 볼륨` 을 사용하고 있는데, `Dockerfile` 의 이 명령에 대해 정확하게 설명하자면, 이미지에 익명의 볼륨을 추가하고 그 이미지를 기반으로 실행되는 컨테이너에 데이터를 추가한다.
또는 `명명된(named) 볼륨` 을 할당할 수도 있다.

이는 지금까지 하던 작업은 아니다. 두 경우 모두 익명 / 명명된 것이든 상관없이 작동한다.
두 경우 모두 도커는 `일부 폴더와 경로를 호스트 머신에 설정` 한다. 내가 모르는 곳에.

현재 컨테이너 내부의 경로만 지정했지, `호스트 머신의 경로는 지정하지 않았다` .
그래서 미러링된 폴더가 어디에 있는지 모르는데 도커가 어디에선가 관리를 하고 있을것이다.
이러한 볼륨에 액세스할 수 있는 유일한 방법은 `docker volumne` 명령을 사용하는 것이다

#### docker volumne

`docker volume --help` 옵션으로 확인해보자.
`volume ls` 같은 명령으로 현재 관리중인 모든 볼륨을 리스팅 할 수 있다.

![](https://velog.velcdn.com/images/chromeheartz/post/65bf0dbe-398d-4a1c-a398-015b7f96a814/image.png)

암호같은 이름을 지닌 볼륨인데, `자동 생성` 된 이름이기 때문이다.
여기서 문제는 `feedback-app` 컨테이너를 중지하여 앱을 종료하는 경우 이 `익명 볼륨` 이 사라지게 된다. 언급했듯이 익명 볼륨을 관리하는 것은 도커인데, 익명이기 때문에 `컨테이너가 존재하는 동안에만` 실제로 존재하게 된다.
즉, 컨테이너를 종료하면 데이터가 사라진다. (컨테이너 제거를 의미)

익명 볼륨과 실제로 모든 바인드 마운트는 하나의 `핵심 개념` 을 공유한다.
컨테이너에 정의된 경로는 생성된 어떤 볼륨에 매핑되기 때문에 호스트 머신상의 생성된 경로로 연결된다.

예를 들어 현재 컨테이너의 `/app/feedback` 경로는 호스트 머신의 어떤 폴더에 매핑된다.
하지만 도커가 관리하기 때문에 정확히 어디에 있는지 찾기 어렵고, 그 폴더에 액세스한다고 하더라도 작업해서는 안된다.

컨테이너가 종료될 때 볼륨만 삭제되지 않는다면 이론적으로는 쓸만한 개념이다.
이 경우 폴더가 로컬 머신에 생존할 수 있다면 좋을텐데 말이다.

#### named volume

> 📌 명명된 볼륨을 사용하면 `컨테이너가 종료된 후에도 볼륨이 유지된다`
> 따라서 그 이후에 새 컨테이너를 시작하면 볼륨이 복구되고, 해당 폴더가 복구되어 폴더에 저장된 모든 데이터를 계속 사용할 수 있다.

따라서 명명된 볼륨은 영구적이어야 하는 데이터나, 편집하거나 직접 볼 필요가 없는 중요한 데이터에 적합하다. 실질적으로 호스트 머신의 폴더에 액세스하지 않기 때문.

도커파일 내부에 명명된 볼륨을 생성할 수는 없다.
따라서 `VOLUME` 으로 시작하는 명령을 지우고, 컨테이너를 실행할 때 명명된 볼륨을 생성한다.

#### -v

이미지를 다시 만들기 위해 제거하고 build를 한다.
리빌드하고 컨테이너를 시작할 때 `-v` 옵션으로 컨테이너에 볼륨을 추가한다.
`Dockerfile` 에서와 달리 명명된 볼륨이다.

작동방식은 저장하려는 컨테이너 파일 시스템 내부의 경로를 지정해야한다.
`/app/feddback` 으로 지정하고 이 경로 앞에 원하는 이름을 넣는다.
콜론으로 `feedback:/app/feedback` 으로 지정하면 된다.

`docker run -d -p 4000:80 --rm --name feedback-app -v feedback:/app/feedback  feedback-node:volumes`

> ✅ 익명 볼륨과의 주요 차이점은 명명된 볼륨은 컨테이너가 종료될 때 도커에 의해 삭제되지 않는다는것이다.
> 또한 익명의 볼륨은 하나의 특정 컨테이너에 밀접하게 연결되어 있는데, 명명된 볼륨은 하나의 컨테이너에만 연결되지 않는다.

폼으로 제출하고 `docker stop feedback-app` 으로 컨테이너를 중지하면 `--rm` 플래그로 인해 컨테이너가 자동으로 제거될것인데, 볼륨은 여전히 존재한다.

`docker volume ls` 를 하게되면 `feedback` 이 남아있는 것을 볼 수 있다.

`docker run -d -p 4000:80 --rm --name feedback-app -v feedback:/app/feedback  feedback-node:volumes`
또한 이렇게 새 컨테이너를 시작하면서 동일한 볼륨 이름을 지닌 `-v` 옵션으로 즉, 이전과 같은 볼륨이름으로 재실행 하게되면 여전히 데이터가 존재하는 것을 볼 수 있다.
