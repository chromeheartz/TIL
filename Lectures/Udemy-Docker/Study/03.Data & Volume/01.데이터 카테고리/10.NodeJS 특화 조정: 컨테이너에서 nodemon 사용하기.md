## Data & Volume

### 10. NodeJS 특화 조정: 컨테이너에서 nodemon 사용하기

---

### 📌 NodeJS 특화 조정

이제 추가된 바인드 마운트로 인해 HTML 파일을 변경하면 그 즉시 변경사항이 반영된다.
하지만 `server.js` 에서 무언가를 변경하면 문제가 있음을 알 수 있다.

예를 들어 `console.log` 를 하나 찍어보면 컨테이너는 여전히 실행중이지만, 로그가 출력되지 않는다.
이는 노드에 특정된 문제이지만 다른 앱도 이와 유사한 문제에 직면할 수 있다.
`server.js` 의 코드는 `노드 런타임` 에 의해 노드에 의해 실행되고, 그 런타임으로 파일이 실행된다.

페이지를 볼 수 있고, 작동하는 웹서버를 가질 수 있는것은 그 덕분이다.
웹 서버를 재시작하여, 서버에서 사용하는 `JavaScript` 코드의 변경사항이 적용되게 만들어보자. 전체 컨테이너를 재시작할 필요는 없고, 웹서버만 다시 시작하면 된다.

컨테이너가 이미 실행 중인 경우에 컨테이너의 서버만 다시 시작하는 것은 간단하지 않다.
사실 지금 할 수 있는 방법은 컨테이너를 중지한 다음, 다시 시작하는 것이다. 그래도 최소한 이미지를 리빌드할 필요는 없겠지만, `--rm` 플래그로 인해서 중지하게되면 바로 삭제가 될것이다.
따라서 해당 플래그를 빼고 컨테이너를 중지시켰다가 `docker run` 으로 다시 실행시켜야 한다.

`NodeJS` 개발에 사용할 수 있는 유용한 확장 패키지가 있다.
이 패키지는 파일 시스템을 감시하여, 파일이 변경될 때마다 노드 서버를 다시 시작하는데, 즉, 개발 중에 변경 사항이 생기면 즉시 반영되도록 사용하는 패키지이다.

```
 "scripts": {
    "start": "nodemon server.js"
  },
```

nodemon을 사용하기 위해 스크립트를 넣어주고 이 스크립트를 활용하기 위해 Dockerfile을 조정해야 한다.
`CMD [ "npm", "start" ]`

이렇게하면 내부적으로는 `nodemon` 을 사용할 수 있다.

```
% docker rmi feedback-node:volumes
```

이미지를 제거하고,
`docker build -t feedback-node:volumes .` 를 사용해서 이미지를 재빌드하고 `docker run` 을 사용해서

```
docker run -d --rm -p 3000:80 --name feedback-app -v feedback:/app/feedback -v "/Users/bibi/Documents/GitHub/TIL/Lectures/Udemy-Docker/Code/03-volume:/app" -v /app/node_modules feedback-node:volumes
```

다시 컨테이너를 올려보자. 이렇게하면 `server.js` 가 바뀔때마다 자동으로 다시 시작되는 것을 볼 수 있다.

`docker logs feedback-app` 에서 콘솔이 찍히는 것을 볼 수 있다.
컨테이너가 실행된 이후에도 변경된 사항을 적용하고 있는 것이다.
