## Data & Volume

### 12. 읽기 전용 볼륨 살펴보기

---

### 📌 읽기 전용 볼륨

`docker run` 으로 컨테이너를 다시 시작한다고 가정해보자.
`명명된 볼륨 / 바인드 마운트 / 익명 볼륨` 을 설정하고 `node_modules` 에 바인드 마운트로부터 종속성을 저장하도록 설정한다.

하지만 이 컨테이너를 시작하기 전에 `바인드 마운트` 를 자세히 살펴보자.
일단 바인드 마운트에 대해 생각해보면 소스 코드를 편집할 수 있고, 변경 사항은 컨테이너 내부에서 자동적으로 사용할 수 있다는 것이다.

그 아이디어는 컨테이너가 `app` 폴더에 쓸 수 있어야 한다는 것이 아니라, `컨테이너는 로컬에 있는 파일을 변경할 수 없어야 한다` 라는 것이다.
파일을 변경할 수 있는 곳은 `호스트 머신 파일 시스템` 이지 `컨테이너 내부` 가 아니다.

컨테이너에서 실행중인 애플리케이션은 이러한 파일을 변경해서는 안되고, 이것을 강제하는 이유이다.
의도가 무엇인지 명확하게 하기 위해 `바인드 마운트` 를 `읽기 전용 볼륨` 으로 전환할 수 있다.

디폴트로 볼륨은 `read-write` 이며, 이는 컨테이너가 볼륨에서 데이터를 `읽고, 쓸 수 있음` 을 의미한다. 하지만 컨테이너에 이를 제한할 수 있는데 `내부 경로 뒤에 콜론` 을 추가한다음 `read only` 를 의미하는 `ro` 를 추가한다.
이렇게하면 도커가 그 폴더나 하위 폴더에 쓸 수 없게 된다.

`docker run -d --rm -p 3000:80 --name feedback-app -v feedback:/app/feedback -v "/Users/bibi/Documents/GitHub/TIL/Lectures/Udemy-Docker/Code/03-volume:/app:ro" -v /app/node_modules feedback-node:volumes`

이것은 호스트 머신에 영향을 미치지 않으며, 컨테이너와 컨테이너에서 실행되는 애플리케이션에만 영향을 미친다.

이 전체 프로젝트 폴더를 바인드 마운트로 바인딩한다는 점을 명심해보자.
모든 폴더와 파일이 있는데, 현재로서는 쓰기 기능도 `feedback / temp` 폴더에 제한한다는 뜻이다.
`server.js` 에서 분명히 `temp / 최종 폴더` 에 파일을 쓰려고 시도할 것인데, 그 폴더에 쓰기가 가능한지 확인해보아야 한다.

또한 로직은 익명의 `node_modules` 폴더를 지닌 이전과 동일하다.
다른 볼륨을 특정하면, 전체 프로젝트 폴더 볼륨 안이나 컨테이너의 전체 `app` 폴더 내부에 말이다.
더 구체적인 하위 볼륨을 특정한다면, 그 하위 볼륨이 메인 볼륨보다 `우선` 하다고 할 수 있따.

익명 볼륨과 마찬가지로 `node_modules` 는 바인드 마운트에서 가져오지 않고, 대신 이미지 빌드 중에 생성된 것을 고수한다.

예를들어 `app/feddback` 의 경우.
이 부가적인 볼륨은 이미 있다. 거기에 있는 데이터를 유지하고, 그 데이터가 생존하기를 원하기 때문.
그리고 이것은 바인드 마운트보다 더 긴 컨테이너 내부 경로를 가지고 있고, 명명된 볼륨은 읽기 전용이 아니기 때문에 `feedback` 폴더는 쓰기가 가능하다.

이제 `temp` 폴더에도 비슷한 작업을 수행하기 위해, 추가 볼륨을 작성해야 한다.
`app/temp` 에 대한 익명 볼륨이 될 수 있다.

컨테이너를 제거하고 다시 시작하면 살아남지 못하더라도, 실제로 컨테이너가 호스트 파일 시스템에 임시 데이터를 쓸 수 있도록 보장하기 때문.
`docker run` 의 명령줄에서 `-v /app/temp` 를 지정하면 `Dockerfile` 내부에서 할 필요가 없다.

`docker run -d --rm -p 3000:80 --name feedback-app -v feedback:/app/feedback -v "/Users/bibi/Documents/GitHub/TIL/Lectures/Udemy-Docker/Code/03-volume:/app:ro" -v /app/temp -v /app/node_modules feedback-node:volumes`

이렇게 컨테이너를 시작하게 하면 된다.
지금 앱에서는 쓰기를 시도하지 않지만, 단순한 연습이다.
변경해서는 안 되는 컨테이너 내부의 파일을 실수로 변경하지 않도록 하는 것이 좋다.
