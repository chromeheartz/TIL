## Data & Volume

### 11. 볼륨 & 바인딩 마운트 요약

---

### 📌 볼륨 & 바인딩 마운트

docker run을 사용할 때 `-v` 옵션을 사용하는 기본적인 세 가지 방식이 있다.

- 1. `익명의 볼륨` 을 생성한다. 이름을 지정하지 않기 때문.
- 2. `명명된 볼륨` 을 사용한다. 이름을 지정하기 때문
- 3. 실제로 호스트 머신의 폴더를 가리키는 `절대 경로` 이기 때문에 `바인드 마운트` 이다.

이제 이러한 서로 다른 개념이 가진 다양한 기능에 대해 한번 알아보자.

`익명 볼륨` 은 컨테이너에 연결된 일종의 볼륨을 생성한다. 컨테이너가 제거되면 볼륨 역시 제거된다.
컨테이너를 실행할 때 `--rm` 을 사용했다면 그 컨테이너를 중지하면 익명 볼륨 역시 바로 사라진다.
`컨테이너 중지 = 컨테이너 제거` 와 마찬가지이기때문에 익명 볼륨을 사용해서는 `데이터를 공유할 수 없다`.
즉, 컨테이너의 `파괴 / 재생성` 에 걸쳐 데이터를 저장하는데 익명 볼륨은 적합하지 않다.
익명볼륨은 `컨테이너 내부 경로의 우선순위` 를 높이는데 사용할 수 있다.

하지만 `Dockerfile` 에 `VOLUME` 명령으로 생성되거나 이와 같이 `-v` 로 생성된 익명 볼륨은 컨테이너에 이미 존재하는 특정 데이터를 잠그는데 유용하다.
이러한 데이터가 다른 모듈에 의해 덮어쓰여지는 것을 방지하는데 유용하다. 익명 볼륨은 시간을 절약할 수 있따는데도 장점이 있다. 또한 익명 볼륨은 호스트 머신에 폴더를 생성하는데, 컨테이너가 실행되는 동안에는 존재한다. 이는 도커가 컨테이너 내부에 모든 데이터를 저장할 필요가 없으며 도커가 이 컨테이너 `read-write` 레이어 내부의 모든 데이터를 관리할 필요는 없다는 것을 의미한다.
하지만 그 대신 특정 데이터를 호스트 머신 파일시스템에 아웃소싱할 수 있다.
현재 앱을 기준으로 `temp` 폴더 용으로도 쓸 수 있을것이다. `temp` 폴더를 컨테이너가 제거될때 잃어도 괜찮고, 이에 대해 언급한 이유는 약간의 성능 향상을 위해 `temp` 폴더를 익명 볼륨에 매핑할 가치가 있기 때문이다.

`명명된 볼륨` 이 확실히 유용하다. `Dockerfile` 에서 생성할 수 없지만, 컨테이너를 생성할 때 `-v` 명령으로 콜론 앞에 이름을 지정할 수 있다.
이 명명된 볼륨의 가장 큰 장점은 생성된다는 것이다. `특정 컨테이너` 에 연결되어 있지 않고, 종료 / 제거 해도 살아남는다. 명명된 볼륨을 제거하려면 할 수는 있지만 도커 `CLI` 에 분리되 내장 명령으로 해야만 한다.

명명된 볼륨은 컨테이너 제거 이후에도 살아 있으므로 다양한 컨테이너에 동일하게 명명된 볼륨 하나를 마운트하고 공유할 수 있다.

`바인드 마운트` 는 다른 용도로 사용된다.
호스트 머신에 데이터가 저장되는 위치를 알고 있다. 바인드 마운트 또한 하나의 특정 컨테이너에 국한되지 않는다. 다수의 컨테이너에 연결할 수 있고, 종료 / 제거 후에도 유지된다.
바인드 마운트의 데이터를 지우려면 실제로 `호스트 머신` 에서 삭제해야한다. 즉, 로컬 콘텐츠를 삭제해야만 컨테이너의 모든 데이터를 제거할 수 있다.

> 이 세 가지 방식은 `컨테이너의 내부 데이터` 를 관리하기 위한 주요한 방식이다.
> 그 차이점은 무엇이며, 언제 어떤 것을 사용하는지 명확하게 인지하고 있어야 한다.
