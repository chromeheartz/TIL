## Data & Volume

### 19. 모듈 요약

---

### 📌 요약

도커로 작업할 때 알아야만 하는 몇몇 핵심 개념이 있었다.

컨테이너가 데이터를 읽고 쓸 수 있다는 것을 배웠고, 볼륨은 특히 컨테이너 제거 후에도 살아남아야 하는 데이터와 함께 데이터를 저장하는데 도움이 된다는걸 보았다.

또한 컨테이너의 `상호 작용` 에 도움이 되는 `바인드 마운트` 를 보았다.
소스 코드를 업데이트할 수 있어야하며, 최신 코드를 컨테이너 내부에서 항상 사용할 수 있도록 하는 경우에 사용할 수 있었다.

컨테이너는 도커의 핵심이며, 데이터를 읽고 쓸 수 있다.
이미지 위에 `read-write` 레이어를 추가하는데 컨테이너가 제거되면 컨테이너 내부에 기록한 데이터가 손실된다. 격리 개념은 유용하지만 그렇지 않을 때도있다.
모든 애플리케이션에는 생존해야하고, 지속되어야 하는 데이터가 있다.

그렇기 때문에 볼륨을 추가하는데, 볼륨은 결국 `컨테이너가 실행되는 호스트 머신상의 폴더` 이다.
도커에 의해 관리되며, 도커 컨테이너에 마운트 된다.

컨테이너 내부에 매핑된 경로와 호스트 머신에 자동적으로 생성된 폴더 사이에 이러한 연결이 존재한다.
컨테이너 내부의 매핑된 경로에 기록된 모든 내용은 호스트머신에도 저장된다.
이 데이터는 컨테이너가 제거된 경우에도 유지되고, 호스트 머신에 미러링되거나 복사되어 컨테이너 내부에만 저장되지는 않기 때문이다

#### 볼륨

볼륨에 대해서는 2종류가 있었는데,

- `명명된 볼륨` : 컨테이너가 제거되어도 살아남기 때문에 유용하다. 이러한 볼륨은 데이터를 영구적으로 저장하려는 경우에 필요하다.
- `익명 볼륨` : 컨테이너에 연결되며, 컨테이너가 제거되면 함께 제거된다.
  따라서 지속되어야 하는 영구 데이터를 저장하는데는 유용하지 않지만 컨테이너를 좀 더 효율적으로 만들도록 임시 데이터를 저장하는데는 여전히 유용하다.
  컨테이너에 더 적은 데이터를 저장하고, 더 많은 데이터를 호스트 시스템에 `아웃소싱` 하기 때문.

그리고 볼륨이 `바인드 마운트` 와 함께 유용하게 사용되는 것을 보았다.
바인드 마운트를 사용하면 호스트 머신의 로컬 폴더로 매핑할 수 있기 때문이다.
내부 폴더를 알고 있어 소스코드를 컨테이너 노출한다. 그런 다음 이를 익명 볼륨과 결합하여 `덮어 쓰고 싶지 않은 컨테이너에 이미 존재하는 폴더` 를 실수로 덮어쓰지 않도록 한다.

바인딩 마운트는 명명된 볼륨과 비슷하지만 데이터가 미러링되는 호스트 머신의 경로를 알고 있고,
실제로 그 경로를 사용하여 데이터를 컨테이너에 전달하여 호스트 머신에서 그 데이터를 변경할 수 있어 컨테이너에서 항상 최신 데이터를 사용할 수 있다는 차이점이 있다.

```
docker run -d --rm -p 3000:8000 --env PORT=8000 --name feedback-app -v feedback:/app/feedback -v "/Users/bibi/Documents/GitHub/TIL/Lectures/Udemy-Docker/Code/03-volume:/app:ro" -v /app/node_modules -v /app/temp  feedback-node:env
```

`-v` 옵션을 사용하여 볼륨을 설정할 수 있는데, 만약 볼륨이 존재하지 않는다면 도커는 자동으로 생성한다. 존재한다면 기존 것을 사용한다.

이미지와 컨테이너를 좀 더 동적이고 구성 가능하게 만들 수 있는 `빌드 인수 / 런타임 환경 변수` 또한 있었다. 이미지를 빌드하거나 컨테이너를 실행할 때 외부에서 특정 데이터를 전달할 수 있다.
`Dockerfile` 이나 소스 코드에서 모든 것을 하드 코딩할 필요가 ㅇ벗다.
그 대신 컨테이너를 실행할 때 이를 구성할 수 있다.
