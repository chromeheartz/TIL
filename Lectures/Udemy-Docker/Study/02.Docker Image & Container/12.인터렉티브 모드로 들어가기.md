## Docker Image & Container

### 12. 인터렉티브 모드로 들어가기

---

### 📌 인터렉티브모드

실제로 웹 개발 및 웹 서버 실행과 들어오는 요청 등을 처리하는 등 nodejs앱으로 많은것을 보았다. 웹 서비스를 구축하기 위해 NodeJS, PHP, Python을 사용하던 도커로는 다 가능하다.
예로 `python` 을 활용해보자.

```python
from random import randint

min_number = int(input('Please enter the min number: '))
max_number = int(input('Please enter the max number: '))

if (max_number < min_number):
  print('Invalid input - shutting down...')
else:
  rnd_number = randint(min_number, max_number)
  print(rnd_number)
```

간단한 파이썬 파일으로 값을 출력하게 만들어보자.
이제 시스템에 python을 설치하여 이것을 실행하거나 도커 이미지 / 컨테이너에 넣을 수 있다.

이 앱은 실제로 사용자가 앱과 `상호 작용` 해야 한다. 이 예제를 실행하면 실제로는 작동하지 않겠지만 `Dockerfile` 을 작성해서 실행시켜보자.
`python` 을 베이스 이미지로 사용하는 커스텀 이미지를 만들고,
작업 디렉토리를 설정한 후에 코드 파일을 복사해야 한다.

마지막으로 이 컨테이너가 시작될 때 실행되어야 할 명령을 추가한다. `CMD ["python", "rng.py"]` 로 도커파일 설정을 마무리

```dockerfile
FROM python

WORKDIR /app

COPY . /app

CMD ["python", "rng.py"]
```

`docker build .` 로 이미지를 빌드해보자. `IMAGE ID` 를 사용하여 `docker run` 을 실행하여 컨테이너를 불러올 수 있다. 여기서는 포트를 노출하지 않는다. 네트워크 기반 애플리케이션이 아니므로.

![](https://velog.velcdn.com/images/chromeheartz/post/02f57386-88b7-4496-8a8a-9358b8dc703e/image.png)

실행해보면 에러가 나고 `docker run` 이라서 `attached` 모드에서 시작되지만 에러 메시지 이외에는 아무것도 표시되지 않는다. docker run을 사용하면 디폴트로 컨테이너에 연결되어 컨테이너에 의해 출력된 결과를 받을 수 있다. 하지만 무엇이든 입력할 수 있다는 관점에서 연결을 한 것은 아니다.

컨테이너나 컨테이너로 실행되는 애플리케이션에는 어떤것도 입력할 수 없기 때문이다.
`--help` 를 열어서 확인해보면 두 가지 옵션이 있다
`-i` 옵션은 `--interactive` 를 사용할 수도 있다. 표준 입력을 열린 상태로 유지하며 `attached` 모드가 아닌 경우에도 컨테이너에 무언가를 입력할 수 있다. 일반적으로 이것을 `-t` 와 결합하면 `pseudo TTY` 가 할당되는데, 터미널을 생성한다는 것을 의미한다.

따라서 `-it` 라는 하나의 플래그로 결합해서 컨테이너는 입력을 수신하고, 컨테이너에 의해 수신을 노출되는 터미널도 얻게 되는 것이다. 컨테이너는 실제로 입력을 받는 장치가 되는것.

![](https://velog.velcdn.com/images/chromeheartz/post/72481486-4740-42c9-8674-4ea5990f7be5/image.png)

컨테이너를 멈추고 `docker start` 를 해보게 되면 디폴트로 `detached` 모드이기때문에 컨테이너와 통신할 수 없다.

`docker start -a` 로 a를 추가해서 attached모드를 입력시켜주는것으로 할 수도 있지만, 작동한 후에는 한번만 입력할 수 밖에 없다.

![](https://velog.velcdn.com/images/chromeheartz/post/aa2a7c96-3aa5-482b-8fb8-2bcb80122da2/image.png)

`-i` 를 통해 컨테이너에 무언가를 입력할 수 있게 해주자.

`docker start -a -i [CONTAINER_ID]`

이와 같은 애플리케이션 처럼 출력 결과를 수신하기 위해 연결할 뿐만 아니라 입력을 제공하기 위해 연결하는 이유는 도커가 웹 서버 / 웹 애플리케이션 같은 장기적인 실행 프로세스에만 적용되는 것이 아니기 때문이다.

간단한 유틸리티 애플리케이션을 도커화하는데도 사용할 수 있다.
