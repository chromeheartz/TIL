## Docker Image & Container

### 03. NodeJS 앱

---

### 📌 NodeJS 앱

대부분의 사용사례에서 지금의 노드 이미지와 같은 대화형 셀을 제공하는 이미지를 다운로드하여 실행하고싶지는 않을것이다.
일반적으로 이러한 이미지를 기반으로 구축한 다음 자신만의 이미지를 구축한다.
예를 들어 노드 이미지를 구축한 다음 그 이미지로 특정 노드 JS 코드를 실행할 수 있다.

일반적으로 공식 베이스 이미지를 가져온 다음 그 위에 추가하여 그 이미지로 코드를 실행하는데, 물론 컨테이너 내부에서 모든 작업을 수행하고자 할것이다. 그리고 그것은 코드를 지닌 앱으로 공유하지 않는 한 도커 허브에 존재하지 않게 된다.

일단 이미지를 기반으로 자체 이미지를 빌드해보자.

```js
// server.js
const express = require("express");
const bodyParser = require("body-parser");

const app = express();

let userGoal = "Learn Docker!";

app.use(
  bodyParser.urlencoded({
    extended: false,
  })
);

app.use(express.static("public"));

app.get("/", (req, res) => {
  res.send(`
    <html>
      <head>
        <link rel="stylesheet" href="styles.css">
      </head>
      <body>
        <section>
          <h2>My Course Goal</h2>
          <h3>${userGoal}</h3>
        </section>
        <form action="/store-goal" method="POST">
          <div class="form-control">
            <label>Course Goal</label>
            <input type="text" name="goal">
          </div>
          <button>Set Course Goal</button>
        </form>
      </body>
    </html>
  `);
});

app.post("/store-goal", (req, res) => {
  const enteredGoal = req.body.goal;
  console.log(enteredGoal);
  userGoal = enteredGoal;
  res.redirect("/");
});

app.listen(80);
```

간단한 노드 앱인데, 노드 JS로 웹서버를 시작하고 포트 80에서 수신 대기해서 도메인 슬래시 URL로 들어오는 요청을 처리한다.
`get HTTP` 요청인 경우 HTML코드가 반환된다.
![](https://velog.velcdn.com/images/chromeheartz/post/cd06ff0b-d3d6-4a52-949e-646f7f353a0a/image.png)

#### 중요한 점

스타일 지정을 위한 `CSS` 파일이 있는 `public` 폴더이다.
이 파일은 노드 서버에 파일에 대한 요청을 `public` 폴더로 리디렉션하도록 지시하여 결국 자동으로 로드된다.
또 중요한 것은 `package.json` 파일이다. 이 파일은 도커와 관련이 없다.
종속성과 이 노드 애플리케이션을 실행하는데 필요한 다른 써드파티 패키지를 노드에 알려준다. 현재는 `express framework / body-parser` 이다.

이 프로젝트를 도커 없이 로컬로 실행하려면 `NodeJS` 를 설치해야 한다.

npm install을 실행하고, `node server.js` 명령으로 서버 JS파일을 실행한다.
그러면 서버가 시작되고 `localhost:80` 로 앱을 방문할 수 있다.

여기까지는 대부분 다 알텐데, 이제 이 앱을 포함하고 노드 도커 허브 이미지를 활용하여 이 코드를 실행하는 자체 이미지를 어떻게 구축할 수 있을까?
