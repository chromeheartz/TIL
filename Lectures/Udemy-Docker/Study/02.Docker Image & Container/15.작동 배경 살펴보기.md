## Docker Image & Container

### 15. 작동 배경 살펴보기

---

### 📌 이미지 검사

이미지에는 코드와 앱 환경이 포함되어 있다.
그래서 인지 사이즈가 작지는 않은데, 실행 중인 컨테이너는 실제로 그렇게 크지 않고 명령 레이어가 이미지 위에 추가된 `얇은 부가 레이어` 이다.
따라서 이미지 코드는 실행 중인 컨테이너에서 사용 된다. 명확히 말하면 다시 복사되지 않는다.

컨테이너는 이미지를 기반으로 빌드되고, 동일한 이미지를 기반으로 실행되는 여러 컨테이너는 이미지 내부의 코드를 공유한다. 그렇기 때문에 이미지 내부의 코드또한 잠겨있다.
읽기 전용 컨테이너만 변경할 수 있다.
예를 들어, 모든 이미지 레이어 위에 추가된 새로운 얇은 부가 컨테이너 레이어 내부에 파일을 만든다.

이미지를 좀 더 자세히 알아보기 위해 `docker image inspect [IMAGE_ID]` 를 추가하면 긴 출력 결과가 나온다.

```
[
    {
        "Id": "sha256:0aa8d6c867718fb692fd3d73473ecd4bc98cdf27da09daf95feea8c87d6f8ff8",
        "RepoTags": [],
        "RepoDigests": [],
        "Parent": "",
        "Comment": "buildkit.dockerfile.v0",
        "Created": "2025-09-22T07:47:30.284619378Z",
        "Container": "",
        "ContainerConfig": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": null,
            "Cmd": null,
            "Image": "",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": null
        },
        "DockerVersion": "",
        "Author": "",
        "Config": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "80/tcp": {}
            },
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "NODE_VERSION=24.8.0",
                "YARN_VERSION=1.22.22"
            ],
            "Cmd": [
                "node",
                "server.js"
            ],
            "ArgsEscaped": true,
            "Image": "",
            "Volumes": null,
            "WorkingDir": "/app",
            "Entrypoint": [
                "docker-entrypoint.sh"
            ],
            "OnBuild": null,
            "Labels": null
        },
        "Architecture": "arm64",
        "Variant": "v8",
        "Os": "linux",
        "Size": 1141463139,
        "VirtualSize": 1141463139,
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/spve9zv9xz3ap5t4wspxgv82k/diff:/var/lib/docker/overlay2/jvbionyavepwkgy86ct8l9umw/diff:/var/lib/docker/overlay2/b15bea0de77bdbf2b51e666d546d35ff5a6f99513b31ace94ee0b35c183b8a81/diff:/var/lib/docker/overlay2/0b2aa8df8411358a919daee946032294315f8168f1c41610a04e1b0efd9845ea/diff:/var/lib/docker/overlay2/1b1e74895471d39a05b83e6be79839569729d18eaee283374a16ea408aeae294/diff:/var/lib/docker/overlay2/1432b97533b024bf34f0d19065df20073189899065d105f68f27f4a37529caa7/diff:/var/lib/docker/overlay2/894a9a52dc982988d31a897c8bbdec64d700da5e724947d4fa499f02cf984977/diff:/var/lib/docker/overlay2/69122476dfb6187d184551010a3acbeac43e8182b7c9767909c86a82327b0985/diff:/var/lib/docker/overlay2/56666e4d125a994686b8cb82a9717037ca202e355ebc3777c40af49de3b1349d/diff:/var/lib/docker/overlay2/15609361577ffd9b481af55d6e70414bb37fce1c9991a20cc8e54b61371aa3d3/diff",
                "MergedDir": "/var/lib/docker/overlay2/rgll548rqh3tu83q8btdm7onu/merged",
                "UpperDir": "/var/lib/docker/overlay2/rgll548rqh3tu83q8btdm7onu/diff",
                "WorkDir": "/var/lib/docker/overlay2/rgll548rqh3tu83q8btdm7onu/work"
            },
            "Name": "overlay2"
        },
        "RootFS": {
            "Type": "layers",
            "Layers": [
                "sha256:c8b4a87a026bfea94bde8782061d2f30cf407ae70537aae3b493c54f0bcc6054",
                "sha256:30d04051960d12146ec67e5b9a8387396aaa790f5075cf537bd61c5205614500",
                "sha256:3faf04168a89a645e2d57e7c40afc1796fae3eb4145c2da14cd030c0d03b18c7",
                "sha256:cf51fe3104596850f379e8567bcbacbc880dbfed9c083dc4fc94ef0e6544ec4f",
                "sha256:a1410baecc23a23e75ad941cab46854093d1203c3eabf5b62acce18fa1c84c03",
                "sha256:088c01b0b5d39cf664629474fdf629238defa4236f1895fa54306d5474680cb3",
                "sha256:20b1f5be412e71140d0c7da8f157fee928ab8e8ce5510a31d081e1b6e45e66a2",
                "sha256:c009b467115c7a5d6cdca44d96fd2e6a336891e9c457bc0a4a01dac135c6b874",
                "sha256:7fcff92ca13127f65fca696a756bb7bb34778d0c2b4316865b91dac41edd2a36",
                "sha256:afdff976142b84de86a6084e88e954ab4db72ea58c38e29100553b5e5b608929",
                "sha256:a3e7c27ba5506910820903626a9988a2fc2893278dbd7898de9e5cc7a35678f5"
            ]
        },
        "Metadata": {
            "LastTagTime": "0001-01-01T00:00:00Z"
        }
    }
]
```

여기에서 중요한 사항을 몇 가지 파악해보자.
예를 들어, 이미지의 전체 ID를 찾고 생성된 날짜를 찾아 정확히 이 이미지가 생성된 시간을 확인할 수 있다. 이미지를 기반으로 시작되고 실행될 컨테이너에 대한 구성 또한 있고, 노출될 포트 등도 표시된다.

사용중인 운영체제를 보게 되면 `linux` 운영체제 이미지를 기반으로 구축되는 것을 알 수 있다.또한 Layers를 보게 되면 이미지의 다른 레이어도 볼 수 있따.
`Dockerfile` 에 정의된 레이어 수보다 많은 이유는 해당 파일에 정의된 레이어에만 국한되지 않기 때문이다. 또한 사용하고 있는 노드 기본 이미지에 의해 제공되는 2개의 레이어를 자동으로 갖게 된다.

노드 이미지가 내부적으로 변경되면 그 때 의미가 있다.
빌드 명령을 다시 실행하면 이미지가 캐싱을 사용하지 않고 스스로 재구축을 해야하기 때문에.
베이스 이미지에 레이어가 있는 이유이다.

`inspect` 명령은 항상 필요하지는 않지만, 어떻게 구성되어있는지 보는것도 흥미롭다.
이 이미지를 기반으로 시작할 컨테이너가 구성되는 방식도 흥미로울것이다. 만약 이미지에서 혹은 다른 소스에서 가져왔기 때문에 잊어버렸거나 헷갈린다면 `inspect` 로 구성을 보며 찾아낼 수 있을 것이다.
