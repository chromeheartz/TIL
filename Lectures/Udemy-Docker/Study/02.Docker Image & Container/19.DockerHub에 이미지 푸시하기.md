## Docker Image & Container

### 19. DockerHub에 이미지 푸시하기

---

### 📌 Image Push

`docker images` 로 완성된 이미지를 확인할 수 있다.

#### 그럼 실제 이미지 파일은 어디에 있을까?

도커에는 이미지 공유를 위해 내장된 명령이 있다. 이것이 도커의 핵심 메커니즘이기 때문이다.
이미지를 공유할 때 `push` 할 수 있는 2가지 주요 위치가 있다.
`Docker Hub / Private Registry`
도커 허브와 개인 레지스트리인데, 도커 허브는 공식 도커 이미지 레지스트리이다. 하지만 들어오는 이미지를 처리하는 방법과 이미지를 저장하고 배포하는데 사용할 수 있는 수천 개의 다른 서비스들이 있다.
나중에는 개인 레지스트리를 더 많이 활용하는 것을 보게 되겠지만, 당분간은 도커 허브를 사용해보자.

`hub.docker.com` 로 가서 계정을 만들고, 시작하면 된다.
이미지를 `공개 / 비공개` 로 저장할 수 있다.
공식 이미지들은 검증되고 확인되어야 하니, 그렇게 할 수 없다. 하지만 커스텀이미지는 가능하다.

`github` 의 `repo` 개념으로 잡으면 이해가 쉽다.
도커 허브 또는 다른 공급자를 사용하든 상관없이 레지스트리에 이미지를 푸시하여 도커 허브 / 다른 공급자에 이미지를 공유할 수 있다.

그렇게 되면 팀원이 `docker pull` 같은 명령을 실행하여 푸시된 이미지를 사용할 수 있다.
이제 중요한 것은 일반 이미지 리포지터리 이름으로 `push / pull` 하면 자동으로 도커허브로 이동한다.

#### 이미지 공유

이미지를 공유하기 위해 `repository` 로 이동한 다음 만들어주면 된다.

기존 노드앱을 공유한다고 해보자.
`public` 으로 만들면 누구에게나 공유할 수 있다. 이렇게 되면 비어있는 저장소가 되는데 여기서 이미지를 푸시 해야한다.
`docker push amazingebobi/node-app-example:latest`

이런 명령을 사용할 수 있다고 한다.
그럼이제 로컬 환경에서 실행해보자.

![](https://velog.velcdn.com/images/chromeheartz/post/2fde11a0-ef87-4abc-b275-41ec173c3bfd/image.png)

이렇게 로컬에 존재하지 않는 저장소를 참조하고 있다는 에러가 난다.

#### 로컬 설정이 이에 대해 어떻게 알 수 있을까?

도커에게 알려주는 것은 간단하다.
도커 ID를 접두사로 지닌 이름 현재 기준 `amazingebobi` 가 될것인데, 기본적으로 이것은 `/` 를 포함한 이미지 이름이여야 한다.
따라서 `docker images` 로 확인해보면 해당 이름이 없다.

`amazingebobi/node-app-example` 으로 이미지를 다시 빌드해야 한다.

#### tag

`docker tag` 명령으로 이미지에 태그를 다시 지정할 수 있다.
`docker tag node-demo:latest amazingebobi:node-app-example` 이런식으로 바꿔 줄 수 있다.

어쨌든 도커 허브에서 만든것과 이미지 이름, 태그를 맞춰서 다시 push하려고해도 오류가 난다.
액세스 거부 메세지가 나오는 것인데, `docker login` 으로 로그인 상태를 유지해주어야 한다.

```
docker login -u amazingebobi
```

를 작성한 이후에 password를 accesstoken을 만든것을 넣어주고 `push` 를 하니 정상작동한다.
참고로 이 방식은 스마트한 방식으로 전체 이미지를 업로드하지 않는다.
예를 들어 노드 이미지에 의존하고 있고, 이미 도커 허브에 있으면, 노드 이미지에 대한 연결을 설정하여 필요한 추가 코드만 푸시한다.
