## JPA + Hibernate Full Stack Application

### 03. Todo CRUD

---

### ğŸ“Œ Todo CRUD

ë°ì´í„°ë² ì´ìŠ¤ì— í…Œì´ë¸”ì„ ìƒì„±í–ˆê³  ë°ì´í„°ë„ ì±„ì›Œë„£ì—ˆë‹¤.
ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ì— í†µì‹ í•  ìˆ˜ ìˆëŠ” ë¬´ì–¸ê°€ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. ê·¸ë˜ì„œ í•´ì•¼í•  ê²ƒì€ todoë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ë‹¤. `Restfulwebservices.todo` íŒ¨í‚¤ì§€ë¡œ ì´ë™í•´ì„œ ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±.

ìœ„ì¹˜ë¥¼ `todo.repository` íŒ¨í‚¤ì§€ë¡œ ë„£ì–´ì£¼ê³  ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤. `JpaRepository` ë¥¼ ìƒì†í•˜ë„ë¡ `exends` ë¥¼ ì‚¬ìš©í•˜ê³  ì„í¬íŠ¸.
ì´ `TodoRepository` ì— ì˜í•´ì„œ ê´€ë¦¬ë˜ëŠ” ì—”í„°í‹°ëŠ” ë¬´ì—‡ì¼ê¹Œ `Todo` ì´ë‹¤.

`JpaRepository` ëŠ” ì—”í„°í‹°ë¥¼ ê°€ì§€ê³  ë†€ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë©”ì†Œë“œë¥¼ ì œê³µí•œë‹¤.
ìƒì„±, ì‚­ì œ, ì—…ë°ì´íŠ¸ ë“± ë‹¤ì–‘í•œ ë©”ì†Œë“œë“¤ì´ ìˆë‹¤.

ê·¸ëŸ¼ `TodoRepository` ì‹¤ì œë¡œ ì‚¬ìš©í•˜ê¸° ì•ì„œ `TodoResource` ë¥¼ ë³µì‚¬í•´ì„œ ê°€ì ¸ì˜¤ì.
`TodoJpaResource.java` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë˜‘ê°™ì´ ê°€ì ¸ì˜¨ë‹¤.
TodoResource ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ íŒŒì¼ì˜ `@RestController` ëŠ” ì£¼ì„ì²˜ë¦¬ë¥¼ í•´ë†“ê³  ì§„í–‰.

`TodoJpaResource` ì—ì„œ í•˜ê³ ì‹¶ì€ê²ƒì€ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ê²ƒì´ë‹¤.
ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ ì„ í•˜ë ¤ë©´ ğŸ“ `TodoRepository` ê°€ í•„ìš”í•˜ë‹¤.

`private TodoRepository todoRepository;`
ê·¸ë¦¬ê³  ìƒì„±ìì— íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ê³ , `this.todoRepository` ì— ë„£ì–´ì¤€ë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ê¸°ë³¸ì ì¸ ì„¤ì •ì€ ì¼ë‹¨ ì™„ë£Œë˜ì—ˆëŠ”ë°, ì´ì œ í•  ì¼ì€ ê° ë©”ì†Œë“œë“¤ì„ ì—…ë°ì´íŠ¸í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.

`retrieveTodos` ë¥¼ ì˜ˆë¡œ ë¨¼ì € ì‹œì‘.
í˜„ì¬ ì˜ ë™ì‘í•˜ê³  ìˆì§€ë§Œ ì´ì œ í•˜ê³ ì‹¶ì€ê²ƒì€

```java
public interface TodoRepository extends JpaRepository<Todo, Integer>{

}
```

ì´ë ‡ê²Œ êµ¬í˜„í•´ë†“ì•˜ë˜ `JpaRepository` ë¡œ ì „í™˜ì„ í•˜ëŠ” ê²ƒì´ë‹¤.
ì´ì œ ë©”ì†Œë“œë“¤ì„ ë°”ê¿€ê²ƒì¸ë° `List<Todo> findByUsername(String username);` ë¡œ êµ¬í˜„í•´ë†“ê³  retrieveTodosì—ì„œ returní•´ì£¼ë©´ ì œëŒ€ë¡œ ì¶œë ¥ì´ ëœë‹¤.

`retrieveTodo` ì—ì„œë„ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ í• ê²ƒì¸ë° ì´ë•ŒëŠ” `findById` ë¥¼ ì‚¬ìš©í•œë‹¤ ë¬¸ì œëŠ” `optional` ì„ ë°˜í™˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `.get()` ì„ ì…ë ¥í•´ì¤€ë‹¤.
`delete` ì—ì„œëŠ” `deleteById()` ë¥¼ ì‚¬ìš©

#### update / create

`updateTodo / createTodo` ëŠ” ì•½ê°„ ê¹Œë‹¤ë¡œìš¸ ìˆ˜ ìˆëŠ”ë° `TodoRepository` ì•ˆì— ë©”ì†Œë“œë“¤ì´ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.
`TodoRepository` ì•ˆì— ìˆëŠ” ìœ ì¼í•œ ë©”ì†Œë“œëŠ” `save()` ì´ë‹¤ í•´ë‹¹ ë©”ì†Œë“œê°€ `insert, update` ì— ëª¨ë‘ ì‚¬ìš© ëœë‹¤.

`insert` ì—ëŠ” ì¼ë‹¨ ê¸°ëŠ¥ë§Œ ë§Œë“¤ì–´ë†“ê³  êµ¬í˜„ì€ ì´í›„ì— í• ê²ƒì´ë‹¤.
ì¼ë‹¨ ë‹¤ë¥¸ê²ƒë“¤ë§Œ ë¨¼ì € í…ŒìŠ¤íŠ¸.

```java
package com.in28minutes.rest.webservices.restfulwebservices.todo;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.in28minutes.rest.webservices.restfulwebservices.todo.repository.TodoRepository;

@RestController
public class TodoJpaResource {

	private TodoService todoService;

	private TodoRepository todoRepository;

	public TodoJpaResource(TodoService todoService, TodoRepository todoRepository) {
		this.todoService = todoService;
		this.todoRepository = todoRepository;
	}

	@GetMapping(path="/users/{username}/todos")
	public List<Todo> retrieveTodos(@PathVariable String username) {
//		return todoService.findByUsername(username);
		return todoRepository.findByUsername(username);
	}

	@GetMapping(path="/users/{username}/todos/{id}")
	public Todo retrieveTodo(@PathVariable String username, @PathVariable int id) {
//		return todoService.findById(id);
		return todoRepository.findById(id).get();
	}

	@DeleteMapping(path="/users/{username}/todos/{id}")
	public ResponseEntity<Void> deleteTodo(@PathVariable String username, @PathVariable int id) {
//		todoService.deleteById(id);
		todoRepository.deleteById(id);
		return ResponseEntity.noContent().build();
	}

	@PutMapping(path="/users/{username}/todos/{id}")
	public Todo updateTodo(@PathVariable String username, @PathVariable int id, @RequestBody Todo todo) {
//		todoService.updateTodo(todo);
		todoRepository.save(todo);
		return todo;
	}

	@PostMapping(path="/users/{username}/todos")
	public Todo createTodo(@PathVariable String username, @RequestBody Todo todo) {
		Todo createdTodo = todoService.addTodo(username, todo.getDescription(), todo.getTargetDate(), todo.isDone() );
		return createdTodo;
	}
}
```
