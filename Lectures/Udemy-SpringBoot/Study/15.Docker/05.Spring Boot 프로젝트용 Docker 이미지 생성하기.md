## Docker

### 05. Spring Boot í”„ë¡œì íŠ¸ìš© Docker ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°

---

### ğŸ“Œ Dockerfile

`start.spring.io` ì—ì„œ maven í”„ë¡œì íŠ¸ë¥¼ ê°„ë‹¨íˆ ë§Œë“¤ê³ , `HelloWorldController` ë¥¼ ê°„ë‹¨íˆ ë§Œë“¤ì–´ì„œ ë©”ì„¸ì§€ë¥¼ ë°˜í™˜í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤.

```java
package com.example.in28minutes.learn_docker_15;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;


@RestController
public class HelloWorldController {

    @GetMapping(path = "/")
    public String helloWorld() {
		// Implemented using String Templates
        return """
                { message: Hello World Java v1 }
               """;
    }
}
```

`application.properties` ì— í¬íŠ¸ë¥¼ `5010` ë¡œ ì„¤ì •í•´ë†“ì•„ì„œ `localhost:5010` ì„ ë“¤ì–´ê°€ê²Œ ë˜ë©´ ì‘ë‹µì„ ì œëŒ€ë¡œ ë°›ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

### Dockerfile Examples

```
# Dockerfile Examples

// Docker commands
- docker build -t in28min/hello-world-docker:v1 .


// Dockerfile - 1 - Creating Docker Images

FROM openjdk:21-jdk-slim
COPY target/*.jar app.jar
EXPOSE 5000
ENTRYPOINT ["java","-jar","/app.jar"]

// Dockerfile - 2 - Build Jar File - Multi Stage
FROM maven:3.9.6-amazoncorretto-21-al2023 AS build
WORKDIR /home/app
COPY . /home/app
RUN mvn -f /home/app/pom.xml clean package

FROM openjdk:21-jdk-slim
EXPOSE 5000
COPY --from=build /home/app/target/*.jar app.jar
ENTRYPOINT [ "sh", "-c", "java -jar /app.jar" ]


// Dockerfile - 3 - Caching

FROM maven:3.9.6-amazoncorretto-21-al2023 AS build
WORKDIR /home/app

COPY ./pom.xml /home/app/pom.xml
COPY ./src/main/java/com/in28minutes/rest/webservices/restfulwebservices/RestfulWebServicesApplication.java	/home/app/src/main/java/com/in28minutes/rest/webservices/restfulwebservices/RestfulWebServicesApplication.java

RUN mvn -f /home/app/pom.xml clean package

COPY . /home/app
RUN mvn -f /home/app/pom.xml clean package

FROM openjdk:21-jdk-slim
EXPOSE 5000
COPY --from=build /home/app/target/*.jar app.jar
ENTRYPOINT [ "sh", "-c", "java -jar /app.jar" ]

```

<hr />

![](https://velog.velcdn.com/images/bibiboy/post/63c91f76-6588-4d08-8b59-eade48922f30/image.png)

í•´ë‹¹ ì˜ˆì‹œë¥¼ ë³´ë©´ì„œ ì´ë¥¼ ì´ìš©í•´ì„œ `Docker ì´ë¯¸ì§€` ë¥¼ ìƒì„±í•´ë³´ì. `Dockerfile` ì€ `Docker ì´ë¯¸ì§€` ë¥¼ ìƒì„±í•˜ëŠ”ë° í•„ìš”í•œ ì§€ì¹¨ì„ í¬í•¨í•˜ëŠ” íŒŒì¼ì´ë‹¤.

ì˜ˆì‹œì—ì„œ ìƒì„±í•˜ê³  ìˆëŠ” Dockerfileì€ 4ê°œì˜ ê°„ë‹¨í•œ ì§€ì¹¨ì„ ê°€ì§€ê³  ìˆë‹¤.

```
FROM openjdk:21-jdk-slim
COPY target/*.jar app.jar
EXPOSE 5010
ENTRYPOINT ["java","-jar","/app.jar"]
```

`FROM` : ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ì„¤ì •í•œë‹¤. ëª¨ë“  Docker ì´ë¯¸ì§€ëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¶€í„° ì‹œì‘í•˜ë©°, ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€ëŠ” `penjdk:21-jdk-slim` ê°€ ë ê²ƒì´ë‹¤.
`openjdk` ì´ë¼ê³  í•˜ëŠ” ì €ì¥ì†Œì™€ `21-jdk-slim` ë¼ëŠ” íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ê²ƒì´ë‹¤.

ì´ì œ ì´ë¯¸ì§€ì˜ ì¼ë¶€ë¡œ `spring` ì•±ì„ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ë°, `spring boot` í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ë©´ `app.jar` ì´ íƒ€ê²Ÿ í´ë”ì— ìƒì„±ë˜ëŠ”ë° ë¡œì»¬ ë¨¸ì‹ ì˜ íƒ€ê²Ÿ í´ë”ì—ì„œ `JAR` íŒŒì¼ì„ ë³µì‚¬í•´ì„œ íŠ¹ì • ì´ë¦„ì„ ë¶™ì—¬ `Docker ì´ë¯¸ì§€` ì— ê°€ì ¸ì™€ì•¼í•œë‹¤. ê·¸ë˜ì„œ `COPY` ëª…ë ¹ì–´ê°€ í•„ìš”í•œ ê²ƒì´ë‹¤. ìƒˆ íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ë³µì‚¬í•´ì„œ ì´ë¯¸ì§€ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì¸ë° íƒ€ê²Ÿ í´ë”ì— ìˆëŠ” JARì„ ë³µì‚¬í•´ì„œ Dockerì´ë¯¸ì§€ì— `app.jar` ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.

`EXPOSE` ë¡œ ì»¨í…Œì´ë„ˆê°€ ëŸ°íƒ€ì„ì—ì„œ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •ëœ í¬íŠ¸ì— ëŒ€í•´ DOCKERì— ì•Œë¦°ë‹¤ í˜„ì¬ëŠ” `5010`

ê·¸ ë‹¤ìŒ ì»¨í…Œì´ë„ˆê°€ ëŸ°íƒ€ì„ì—ì„œ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •ëœ í¬íŠ¸ë¥¼ Dockerì—ê²Œ `EXPOSE` ë¡œ ì•Œë¦°ë‹¤.
`ENTRYPOINT` ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ë•Œ ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì •í•´ì•¼ í•˜ëŠ”ë°, ì»¨í…Œì´ë„ˆê°€ DOCKERì´ë¯¸ì§€ì—ì„œ ìƒì„±ë˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ë¥¼ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

`Dockerfile` ì´ë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ë„£ì–´ì£¼ê³  ì´í›„ì— `Run as` ë¡œ `Maven install` ì„ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.
ê·¸ë ‡ê²Œí•˜ë©´ `target` í´ë”ì— `jar` íŒŒì¼ì´ ì£¼ì–´ì§„ë‹¤.
ì´ íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ì´ë¯¸ì§€ì— `app.jar` ë¡œ ê°€ì ¸ì˜¤ê³  ì‹¤í–‰í•´ì•¼í•œë‹¤.

![](https://velog.velcdn.com/images/bibiboy/post/ca497376-9f11-42b1-9041-05dd9732d6e2/image.png)

í˜„ì¬ ë””ë ‰í† ë¦¬ì— ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤.
ì—¬ê¸°ì„œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ í•´ë³´ì. `docker build -t` ì´ë¯¸ì§€ì— íƒœê·¸ë¥¼ ì œê³µí• ê²ƒì¸ë° íƒœê·¸ëŠ” `in28min/hello-world-docker:v1 .` ë¡œ ë§Œë“¤ì–´ë³´ì. ë§ˆì¹¨í‘œë¥¼ ì°ì–´ì£¼ì–´ì•¼ í•œë‹¤.
`Docker` ë¹Œë“œë¥¼ í•  ë•Œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•´ì•¼ í•˜ëŠ”ë°, í˜„ì¬ í´ë”ëŠ” ì»¨í…ìŠ¤íŠ¸ì„ì„ ì•Œë¦¬ëŠ” ê²ƒì´ë‹¤.

ë² ì´ìŠ¤ ì´ë¯¸ì§€ê°€ ë¡œë”©ì¤‘ì´ê³ , `JAR` íŒŒì¼ì„ ë³µì‚¬í•˜ê³ ìˆëŠ”ë°, ë¹Œë“œê°€ ì™„ë£Œë˜ê³  `docker image list` ë¡œ í™•ì¸í•´ë³´ë©´ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

![](https://velog.velcdn.com/images/bibiboy/post/ea66536a-1fbb-43bb-a87f-1602d7fea7ad/image.png)

`docker run -d -p 5010:5010 in28min/hello-world-docker:v1` ë¡œ ì‹¤í–‰í•´ë³´ë©´ `localhost:5010` ì—ì„œ ì œëŒ€ë¡œ ì ‘ê·¼ì´ ë˜ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
