## Docker

### 08. Spring Maven 플러그인으로 Docker 이미지 빌드하기

---

### 📌 Plugin

![](https://velog.velcdn.com/images/bibiboy/post/f12f066e-95a4-42af-9efb-df11428d1d80/image.png)

Docker 이미지를 쉽게 생성할 수 있는 방법이 있다.
`Spring Boot Maven Plugin` 은 가장 인기 있는 플러그인 중 하나이다. `pom.xml` 에 자동으로 포함되어 있는데, 거의 모든 스프링 부트 애플리케이션에는 해당 플러그인이 포함되어 있다.

#### 🔹 스프링 부트 Maven 플러그인

- 거의 모든 스프링 부트 프로젝트에 기본 포함 (`pom.xml`)
- 기능:
  - `repackage`: JAR/WAR 생성
  - `mvn spring-boot:run`: 애플리케이션 실행
  - `mvn spring-boot:start`: 논블로킹 방식 실행 (통합 테스트 가능)
  - `mvn spring-boot:stop`: start로 시작한 애플리케이션 중단
  - **`mvn spring-boot:build-image`**: Docker 이미지 생성

---

#### 🔹 Docker 이미지 생성 과정

1. 이클립스에서 기존 Dockerfile 삭제
2. Maven Build 실행 → `spring-boot:build-image` 입력
3. Docker 백그라운드 실행
4. 전체 빌드 프로세스 실행 → 테스트 → JAR 생성
5. Buildpack 사용 → **OCI(Open Container Initiative) 호환 이미지** 생성
6. 생성된 이미지 → Docker 런타임에서 실행 가능

> 참고: 첫 번째 빌드는 모든 Buildpack 다운로드로 인해 시간이 오래 걸림  
> 이후 빌드는 훨씬 빠름

---

#### 🔹 빌드 이미지 장점

- 생성되는 Docker 이미지가 매우 효율적이고, 크기가 작다
  - 예: 기존 `hello-world-docker v1~v4` → 425MB
  - 스프링 부트 Maven 플러그인 생성 이미지 → 훨씬 작음
- 빌드 속도가 빠르고, 변경된 레이어만 재빌드
- Dockerfile 작성 필요 없음

---

#### 🔹 생성된 이미지 확인

```bash
# Docker 이미지 목록 확인
docker image list
```

생성된 이미지 예시: hello-world-java:0.0.1-SNAPSHOT

🔹 컨테이너 실행

```
# 컨테이너 실행
docker container run -d -p 5010:5010 hello-world-java:0.0.1-SNAPSHOT

# 실행 중인 컨테이너 확인
docker container ls

# 포트 충돌 시 기존 컨테이너 중단
docker container stop <컨테이너ID>
```

실행 후 브라우저에서 확인 → Hello World Java v4
코드 변경 후 다시 빌드 → 빌드 속도 훨씬 빨라짐 (사용 가능한 레이어 재활용)

#### 🔹 핵심 정리

- Maven 플러그인만으로 Docker 이미지 생성 가능
- Buildpack 사용 → OCI 호환 이미지 생성
- 이미지 효율적, 크기 작음
- Dockerfile 작성 불필요
- 첫 빌드만 느리고, 이후 빌드는 빠름
