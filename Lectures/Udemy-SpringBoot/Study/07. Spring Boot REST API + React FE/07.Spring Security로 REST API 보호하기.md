## Spring Boot REST API + React FrontEnd

### 07. Spring Securityë¡œ REST API ë³´í˜¸í•˜ê¸°

---

### ðŸ“Œ Spring Security

ê³„ì† REST APIë¥¼ ë§Œë“¤ì–´ì™”ë‹¤. `Todo` ì˜ ì„¸ë¶€ì •ë³´ë¥¼ ë°›ê±°ë‚˜ ì—…ë°ì´íŠ¸ / ì‚­ì œ ë“± ë§Žì€ REST APIê°€ ìžˆëŠ”ë°, ì´ APIë“¤ì€ ì•¡ì„¸ìŠ¤í•˜ëŠ”ë° `ì¸ì¦ / ìŠ¹ì¸` ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.

ì´ì œ `ì¸ì¦` ì„ ì ìš©í•  ê²ƒì´ë‹¤.

ì¼ë‹¨ ê¸°ë³¸ì ì¸ ì¸ì¦ì„ ì‚¬ìš©í•´ë³´ê³  ì´ì–´ì„œ `JOT / JWT` ë¥¼ ì‚¬ìš©í•´ë³¼ê²ƒ. ì¼ë‹¨ ì¸ì¦ê³¼ ìŠ¹ì¸ì„ í™œì„±í™”í•˜ê¸° ìœ„í•´ `pom.xml` ì—ì„œ `spring-boot-starter-security` ë¥¼ ë„£ê³  ì•±ì„ ìž¬ì‹œìž‘í•´ë³´ë©´

```
Using generated security password: aaeb020a-37b2-4a36-bc74-281a1257241a
```

ì´ì™€ ê°™ì´ ë³´ì•ˆ íŒ¨ìŠ¤ì›Œë“œê°€ í”„ë¦°íŠ¸ ëœê²ƒì´ ë³´ì¸ë‹¤.
ì´ì œ APIë¥¼ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´ `401` ì´ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìžˆë‹¤.
ì¸ì¦ì´ ì¶”ê°€ ë˜ì§€ ì•Šì•„ì„œ ë‚˜ì˜¤ëŠ” ìƒíƒœ.

![](https://velog.velcdn.com/images/bibiboy/post/a4223a18-34fd-48e1-bc09-1011dcf8e2c7/image.png)

`Add Authoriztion` ìœ¼ë¡œ `user / password` ë¥¼ ì¶”ê°€í•´ì£¼ë©´ APIì— ì—‘ì„¸ìŠ¤í•  ìˆ˜ ìžˆë‹¤.
ì´ë ‡ê²Œ ì»¨íŠ¸ë¡¤ëŸ¬ / ë¦¬ì†ŒìŠ¤ê°€ ë³´í˜¸ë˜ê³  ìžˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.
`spring-security` ê°€ í´ëž˜ìŠ¤ ê²½ë¡œì— ì¶”ê°€ë˜ìžë§ˆìž ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ìžë™ìœ¼ë¡œ í•„í„°ë¥¼ ì„¤ì •í•  ê²ƒì´ë‹¤.

#### ðŸ“ Customize

ë³´í˜¸ë˜ì–´ì•¼ í•  URLì„ ì„ íƒí•˜ê³ , ì‚¬ìš©ìž ID, passwordë¥¼ ìš°ë¦¬ê°€ ì§€ì •í•  ìˆ˜ ìžˆê¸°ë¥¼ ì›í•œë‹¤.
ì´ë¥¼ ìœ„í•´ `application.properties` ë¡œê°€ì„œ `spring.security.user.name=in28minutes` / `spring.security.user.password=dummy` ë¥¼ ë„£ì–´ì¤€ë‹¤.

ì´ë ‡ê²Œë§Œ ì„¤ì •í•´ì£¼ë©´ ë‚´ê°€ ì›í•˜ëŠ” ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ë¡œ ì„¸íŒ…í•  ìˆ˜ ìžˆë‹¤.
![](https://velog.velcdn.com/images/bibiboy/post/259de889-668f-48cd-8f5e-7fcd99bd4aab/image.png)

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ POSTë¡œ ìƒˆë¡œìš´ todoë¥¼ ë§Œë“¤ë ¤ê³  í•´ë³´ë©´ `403 / forbidden` ì´ ë‚˜ì˜¨ë‹¤.

> âœ… ì´ ìš”ì²­ì´ ì‹¤íŒ¨í•œ ì´ìœ ëŠ” ì†Œìœ„ `CSRF`, ì¦‰ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ ìœ„ì¡° ë•Œë¬¸ì´ë‹¤.

ì¼ë‹¨ `CSRF` ë¥¼ ë¹„í™œì„±í•˜ê¸° ìœ„í•´
![](https://velog.velcdn.com/images/bibiboy/post/4b93fd28-6c10-4cf8-8f24-080f907b100d/image.png)
íŒ¨í‚¤ì§€ëª… ë’¤ì— `.basic` ì„ ë¶™ì—¬ì„œ íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.

ì´ê²Œ ì„¤ì •íŒŒì¼ì´ ë ê²ƒì´ì—¬ì„œ `@Configuration` ì„ ë„£ì–´ì£¼ê³ , `Spring Security Filter Chain` ì„ ì„¤ì •í• ê²ƒì´ë‹¤.

`FilterChain` ì´ë¼ëŠ” ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ `public SecurityFilterChain` ì„ ì ì–´ì¤€ë‹¤.
ì—°ê²°í•  ë¹ˆì€ `HttpSecurity` ê°€ ë ê²ƒì¸ë°, ì´ê±¸ `http` ë¼ê³  ë¶€ë¥´ê²Œ í•œë‹¤.
ì´ë ‡ê²Œ `SpringFilterChain` ì€ `HttpServletRequest` ì— ë§¤ì¹­ë  ìˆ˜ ìžˆëŠ” í•„í„° ì²´ì¸ì„ ì •ì˜í•œë‹¤. ê·¸ëŸ¼ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì´ í•„í„°ì²´ì¸ì„ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ê²ƒì´ë‹¤.

`HttpSecurity`ëŠ” ì‹¤ì œë¡œ íŠ¹ì •í•œ `HTTP ìš”ì²­` ì— ëŒ€í•´ ì›¹ ê¸°ë°˜ ë³´ì•ˆì„ ì„¤ì •í•  ìˆ˜ ìžˆê²Œ ë„ì™€ì¤€ë‹¤.
í•„í„° ì²´ì¸ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ”ê²ƒ.

> ðŸ“ `SpringSecurity` ì—ëŠ” ì¤‘ìš”í•œ ì ì´ ìžˆëŠ”ë°, ì²´ì¸ì„ ì •ì˜í•˜ê¸° ì‹œìž‘í•˜ë©´ ê·¸ ì²´ì¸ ì „ì²´ë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œ `Spring Security` ëŠ” ëª¨ë“  ìš”ì²­ì„ ì¸ì¦í•˜ê²Œ ë˜ê³ , í˜„ìž¬ `CSRF` ë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ì´ìœ ëŠ” ì„¸ì…˜ì´ ì „í˜€ ì—†ë„ë¡ í•˜ë ¤ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ ì„¸ì…˜ì´ ìžˆìœ¼ë©´ ë°˜ë“œì‹œ í™œì„±í™” í•´ì•¼í•œë‹¤.

```java

@Configuration
public class BasicAuthentiationSecurityConfiguration {
	@Bean
      public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
      return http.build();
  }
}
```

ì´ ìƒíƒœì—ì„œ API ìš”ì²­ì„ í•´ë³´ë©´ ëª¨ë“  ìš”ì²­ì„ ì‹¤í–‰í•  ìˆ˜ ìžˆë‹¤. ì‹¤ì œë¡œ `Spring Security` ë¥¼ ë¹„í™œì„±í™” í–ˆê¸° ë•Œë¬¸ì— ë³´ì•ˆ í•„í„°ê°€ í•˜ë‚˜ë„ ì—†ì–´ì„œ, ì¸ì¦ë„ ì—†ë‹¤.

#### ðŸ“ ëª¨ë“  ìš”ì²­ì— ëŒ€í•œ ì¸ì¦ ì„¤ì •

`http.authorizeHttpRequests()` ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ëžŒë‹¤ì‹ìœ¼ë¡œ `auth -> auth.anyRequest().authenticated()` ë¼ê³  í•´ì£¼ê³ , ìƒˆë¡œìš´ ì°½ì„ ì—´ì–´ ìš”ì²­ì„ í•´ë³´ë©´ ë¡œì»¬í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ê°€ ê±°ë¶€ ë˜ì—ˆë‹¤ê³  ë‚˜ì˜¨ë‹¤. íŽ˜ì´ì§€ë¥¼ ë³´ê¸° ìœ„í•œ ê¶Œí•œì´ ì—†ëŠ”ê²ƒ.

ì—¬ê¸°ì„œë¶€í„° ê¸°ë³¸ ì¸ì¦ì„ í™œì„±í™”í•  ìˆ˜ ìžˆë‹¤.

`http.httpBasic(Customizer.withDefaults());`
ë¥¼ ì¶”ê°€í•´ì£¼ë©´ APIë¥¼ í˜¸ì¶œí• ë•Œ íŒì—…ê°™ì€ê²ƒì´ ë‚˜ì˜¤ë©´ì„œ ë¡œê·¸ì¸ ì¸ì¦ì„ í•˜ë¼ê³  í•˜ëŠ”ë° ì´ì™€ ê°™ì€ ê²ƒì´ `ê¸°ë³¸ ì¸ì¦` ì´ë‹¤.
ì´ë ‡ê²Œ ì¸ì¦ì„ ë‹¤ì‹œ í™œì„±í™” í–ˆê³ , ì´ì œëŠ” ìƒíƒœê°€ ì—†ëŠ” APIë¥¼ ë§Œë“¤ê³  `CSRFë¥¼ ë¹„í™œì„±í™”` í•  ì°¨ë¡€ì´ë‹¤.

ìƒíƒœê°€ ì—†ëŠ” `http.sessionManagement()` ë¶€í„° ì‹œìž‘í•´ë³´ìž.

```java
http.sessionManagement(
					session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
				);
```

ì´ë ‡ê²Œ ìƒíƒœê°€ ì—†ëŠ” ì„¸ì…˜ì„ ì„¤ì •í•˜ê³  ìžˆê³ , `CSRF` ë¥¼ ë¹„í™œì„±í™”í•œë‹¤ë©´ ì„¸ì…˜ì— ìƒíƒœê°€ ì—†ì–´ì•¼ í•œë‹¤ëŠ” ì ì„ ê¸°ì–µí•´ì•¼ í•œë‹¤.

> ìš”ì•½í•˜ìžë©´, ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì¸ì¦ì„ í™œì„±í™”í•´ì„œ ëª¨ë“  ìƒíƒœë¡œ ë˜ëŒë¦¬ê³ , ê¸°ë³¸ ì¸ì¦ì„ í™œì„±í™”í•˜ê³  ê·¸ ë‹¤ìŒì— ìš°ë¦¬ê°€ ìƒíƒœê°€ ì—†ëŠ” ì„¸ì…˜ì„ ì„¤ì •í•œë‹¤.

`http.csrf().disable();`

```java
	http.authorizeHttpRequests(
			auth -> auth.anyRequest().authenticated()
			);

	http.httpBasic(Customizer.withDefaults());
	http.sessionManagement(
				session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
			);
	http.csrf().disable();
```

ì´ëŸ°ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì§°ëŠ”ë° `HTTP` ëŠ” ì²´ì¸í™”ë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì—, ë³„ë„ì˜ í˜¸ì¶œì„ ìƒì„±í•  í•„ìš”ê°€ ì—†ë‹¤. ëª¨ë“  í˜¸ì¶œë“¤ì„ ì—°ì‡„ë˜ì–´ ìžˆê²Œ í•  ìˆ˜ ìžˆë‹¤.

```java
// BasicAuthentiationSecurityConfiguration.java ìµœì¢…
@Configuration
public class BasicAuthentiationSecurityConfiguration {
	// Filter Chain

	@Bean
	public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
		http
			.authorizeHttpRequests(auth -> auth.anyRequest().authenticated())
			.httpBasic(Customizer.withDefaults())
			.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
			.csrf().disable();

		return http.build();
	}
}
```
