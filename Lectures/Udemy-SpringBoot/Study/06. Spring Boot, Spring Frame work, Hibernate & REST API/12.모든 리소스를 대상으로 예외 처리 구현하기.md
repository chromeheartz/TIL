## Spring Boot, Spring Frame work, Hibernate / REST API

### 12. ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„í•˜ê¸°

---

### ğŸ“Œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ì˜ˆì™¸ ì²˜ë¦¬

ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ìš”ì²­ì„ ë³´ë‚´ë©´ `404` ê°€ ë‚˜ì™”ë‹¤.
ë˜ `Spring Boot` ê°€ ì •ì˜í•´ ë‘” êµ¬ì¡°ë¡œ ë°˜í™˜ëœ ê°’ë„ í™•ì¸í–ˆë‹¤.
ì—ëŸ¬ ì‘ë‹µ êµ¬ì¡°ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì€ ê¸°ì—…ì—ì„œ ë§¤ìš° ì¤‘ìš”í•œë°, ì´ëŸ° êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ ì§ì ‘ ì •ì˜í•œ êµ¬ì¡°ê°€ ìˆì„ ìˆ˜ ìˆë‹¤.

#### ì˜ˆì™¸ ë°œìƒ ì‹œ ë°˜í™˜í•˜ëŠ” ì‘ë‹µì˜ êµ¬ì¡° ë°”ê¾¸ê¸°

ì»¤ìŠ¤í…€ ì˜ˆì™¸ì˜ êµ¬ì¡°ë¥¼ ìœ„í•œ ë¹ˆì„ ì •ì˜í•˜ì.
`ErrorDetails` ë¼ëŠ” í´ë˜ìŠ¤ ì•ˆì— ì •ë³´ë¡œ `ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ì‹œê°„ ì •ë³´ / ì—ëŸ¬ ë©”ì„¸ì§€ / ì—ëŸ¬ ìƒì„¸ ì •ë³´` ë¥¼ ì €ì¥í•˜ê³ ì‹¶ë‹¤.
ì´ êµ¬ì¡°ë¥¼ ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ê¸°ë³¸ êµ¬ì¡°ë¡œ ì •ì˜í•œë‹¤ê³  ê°€ì •í•´ë³´ì.

ê¸°ì¡´ì— `package` ë’¤ì—ë‹¤ê°€ `.exception` ì´ë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì–´ì£¼ê³  `cmd + 1` ì„ í•˜ë©´ ì´ë™í•  ìˆ˜ ìˆë‹¤. ì´ì œ êµ¬ì¡°ë¥¼ ì •ì˜.
`ìƒì„±ì / getter` ë“¤ì„ ë§Œë“¤ì–´ì£¼ê³  ì§„í–‰.

```java
// ErrorDetails.java
public class ErrorDetails {
	private LocalDate timestamp;
	private String message;
	private String details;

    public ErrorDetails(LocalDate timestamp, String message, String details) {
		super();
		this.timestamp = timestamp;
		this.message = message;
		this.details = details;
	}


	public LocalDate getTimestamp() {
		return timestamp;
	}

	public String getMessage() {
		return message;
	}

	public String getDetails() {
		return details;
	}

}
```

ì´ì œ `ErrorDetails` ê°ì²´ê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ë°, ë‹¤ìŒìœ¼ë¡œ ë¬´ì—‡ì„ í•´ì•¼í• ê¹Œ
ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ êµ¬ì¡°ë¥¼ ë°˜í™˜í•˜ê²Œ í•˜ê³ ì‹¶ì€ë°, ê·¸ ì „ì— ì–´ë–»ê²Œ `spring` ì—ì„œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ êµ¬í˜„í–ˆë‚˜ë´ë³´ì.
`springì´ ì •ì˜í•˜ëŠ” êµ¬ì¡°` ë¥¼ ë³´ê³  ì‹¶ìœ¼ë©´ `cmd + shift + t` ë¥¼ í•´ì„œ `ResponseEntityExceptionHandler` ê²€ìƒ‰í•´ë³´ë©´ ëœë‹¤.
í•´ë‹¹ íŒŒì¼ì„ ë³´ê²Œ ë˜ë©´ `Spring MVC` ê°€ ë°œìƒì‹œí‚¤ëŠ” ëª¨ë“  ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•œë‹¤ê³  ë‚˜ì™€ìˆë‹¤.
ì •ì˜ëœ ì—ëŸ¬ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤. ë§ì€ ë©”ì†Œë“œë“¤ì´ ìˆì§€ë§Œ ì œì¼ ê¸°ë³¸ì´ ë˜ëŠ” ë©”ì†Œë“œëŠ” `handleException()` ì´ë‹¤.

ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ exception íŒ¨í‚¤ì§€ì— `CustomizedResponseEntityExceptionHandler` ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ì. ê·¸ ë‹¤ìŒ í™•ì¥ì„ ìœ„í•´ extendsë¡œ `ResponseEntityExceptionHandler` ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.

ê·¸ ë‹¤ìŒ ìš°ë¦¬ ìƒí™©ì— ë§ê²Œ ë°”ê¾¸ì–´ ì£¼ê³  ì‹¶ê¸° ë•Œë¬¸ì— handleException ë©”ì†Œë“œë¡œ ê°€ì„œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ë³µì‚¬í•´ì™€ì•¼ í•œë‹¤.

```java
public final ResponseEntity<Object> handleException(Exception ex, WebRequest request) throws Exception {
	//
}
```

ì—¬ê¸°ì—ì„  ì–´ë–¤ ì¢…ë¥˜ì˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ê²ƒì¸ì§€ ì •ì˜í•œë‹¤.
`@ExceptionHandler(Exception.class)` ì–´ë…¸í…Œì´ì…˜ì„ ë‹¬ì•„ì£¼ì–´ì„œ ë°œìƒí•œ ëª¨ë“  ì˜ˆì™¸ë¥¼ ëŒ€ìƒìœ¼ë¡œ í• ê²ƒì´ë‹¤.

#### ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê°ì²´

ì»¤ìŠ¤í…€ ì˜ˆì™¸ ê°ì²´ë¥¼ ë§Œë“¤ ì°¨ë¡€ì¸ë°, `ErrorDetails` ë¥¼ ë§Œë“¤ì–´ì„œ í• ë‹¹í•´ì£¼ì.
ì—ëŸ¬ì˜ ì²« ë²ˆì§¸ ì •ë³´ë¡œëŠ” `íƒ€ì„ ìŠ¤íƒ¬í”„` ë‹ˆê¹Œ `LocalDate.now()` ë¥¼ ë„£ì–´ì£¼ê³ , ë‘ ë²ˆì§¸ ì¸ìëŠ” `ì—ëŸ¬ ì •ë³´` ì´ê¸° ë•Œë¬¸ì— `ex.getMessage()` ì´í›„ ì„¸ ë²ˆì§¸ ì¸ìëŠ” ìƒì„¸ ì •ë³´ì´ê¸° ë•Œë¬¸ì— `request.getDescription()` ì„ í˜¸ì¶œí•´ ë„£ì–´ì£¼ê³  ì¸ìëŠ” `false` ë¡œ í•œë‹¤.

ì´ì œ `ResponseEntity` ê°ì²´ë¥¼ ë°˜í™˜í•´ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, `errorDetails` ë„ ê°™ì´ ì „ë‹¬ë˜ë„ë¡ ë„£ì–´ì£¼ê³ , `Internal Server Error` ë„ ë°˜í™˜í•´ì¤€ë‹¤.

```java
@ControllerAdvice
public class CustomizedResponseEntityExceptionHandler extends ResponseEntityExceptionHandler {
	@ExceptionHandler(Exception.class)
	public final ResponseEntity<Object> handleAllException(Exception ex, WebRequest request) throws Exception {
		ErrorDetails errorDetails = new ErrorDetails(LocalDate.now(), ex.getMessage(), request.getDescription(false));

		return new ResponseEntity(errorDetails, HttpStatus.INTERNAL_SERVER_ERROR);
	}
}

```

í˜„ì¬ ê¸°ì ì—ì„œ `API Test` ë¥¼ í•´ë³´ê²Œ ë˜ë©´ ë°˜í™˜ëœ ì •ë³´ì˜ êµ¬ì¡°ëŠ” ê·¸ëŒ€ë¡œì´ë‹¤.
ì´ëŠ” `Spring Framework` ê°€ ì•„ì§ ì¸ì§€í•˜ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì— âœ… `@ControllerAdvice` ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

> `@ControllerAdvice` ì–´ë…¸í…Œì´ì…˜ì€ íŠ¹ë³„í•œ ì»´í¬ë„ŒíŠ¸ì´ë‹¤. `ExceptionHandler` ë¥¼ ì„ ì–¸í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ìœ„í•œ ê²ƒì´ê³  `@InitBinder` ë¥¼ ì“¸ ìˆ˜ ìˆê³  `@ModelAttribute` ë¥¼ ì´ìš©í•´ì„œ ì—¬ëŸ¬ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì—ì„œ ê³µìœ ë˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

<img width="976" alt="Image" src="https://github.com/user-attachments/assets/9c90a2b9-3d2d-42a2-9342-2bbaa2e4822a" />

ì´ë ‡ê²Œ í•˜ê³  í™•ì¸í•´ë³´ë©´ ì˜ë„í•œëŒ€ë¡œ `500` ìœ¼ë¡œ ë‚´ë ¤ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
ë§Œì•½ timestampì— ì‹œê°„ê¹Œì§€ í¬í•¨ì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ `LocalDateTime` ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ë©´ ëœë‹¤.

#### Bad Request

í˜„ì¬ ë§Œë“  êµ¬ì¡°ê°€ ì ìš©ë˜ì–´ì„œ ì—†ëŠ” ì‚¬ìš©ìë¥¼ ì¡°íšŒí–ˆì„ ë•Œ `500` ì´ ë°˜í™˜ëëŠ”ë°, ì‚¬ìš©ìê°€ ì—†ëŠ” ìƒí™©ì—ì„œ `Bad Request` ë¥¼ ë°˜í™˜ì‹œí‚¤ë ¤ê³ í•˜ë©´ ì–´ë–»ê²Œ í•˜ë©´ ë ê¹Œ?
ì‚¬ìš©ìê°€ ì—†ì„ ë•Œ ë§Œí¼ì€ `UserNotFoundException` ì„ ë°œìƒì‹œí‚¤ê³  ì‹¶ë‹¤.

`INTERNAL_SERVER_ERRO` ëŒ€ì‹ ì— `NOT_FOUND` ë¥¼ ë°˜í™˜í•˜ë©´ ë˜ê³  ì–´ë…¸í…Œì´ì…˜ ë˜í•œ `@ExceptionHandler(UserNotFoundException.class)` ì´ë ‡ê²Œ ë°”ê¿”ì£¼ë©´ ëœë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ `ResponseEntity` ê°€ `raw íƒ€ì…` ì´ë¼ëŠ” ê²½ê³ ê°€ ìˆëŠ”ë°, ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ í•˜ë©´ ëœë‹¤.

```java
// CustomizedResponseEntityExceptionHandler.java
@ControllerAdvice
public class CustomizedResponseEntityExceptionHandler extends ResponseEntityExceptionHandler {

	@ExceptionHandler(Exception.class)
	public final ResponseEntity<ErrorDetails> handleAllException(Exception ex, WebRequest request) throws Exception {
		ErrorDetails errorDetails = new ErrorDetails(LocalDateTime.now(), ex.getMessage(), request.getDescription(false));

		return new ResponseEntity<ErrorDetails>(errorDetails, HttpStatus.INTERNAL_SERVER_ERROR);

	}

	@ExceptionHandler(UserNotFoundException.class)
	public final ResponseEntity<ErrorDetails> handleUserNotFoundException(Exception ex, WebRequest request) throws Exception {
		ErrorDetails errorDetails = new ErrorDetails(LocalDateTime.now(), ex.getMessage(), request.getDescription(false));

		return new ResponseEntity<ErrorDetails>(errorDetails, HttpStatus.NOT_FOUND);

	}

}

```

> ì†Œë¹„ìì—ê²Œ ì˜¬ë°”ë¥¸ ë©”ì„¸ì§€ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì€ ë¬´ì²™ ì¤‘ìš”í•˜ë‹¤.
> `REST API` ì—ì„œ ì†Œë¹„ìì—ê²Œ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ `Response / ResponseStatus` ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
