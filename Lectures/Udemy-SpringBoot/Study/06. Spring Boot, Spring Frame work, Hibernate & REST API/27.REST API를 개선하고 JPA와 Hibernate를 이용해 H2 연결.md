## Spring Boot, Spring Frame work, Hibernate / REST API

### 27. REST APIë¥¼ ê°œì„ í•˜ê³  JPAì™€ Hibernateë¥¼ ì´ìš©í•´ H2 ì—°ê²°

---

### ğŸ“Œ REST API ê°œì„ 

ì´ë²ˆì—ëŠ” `UserRepository` ìƒì„±ì„ ì¤‘ì ì ìœ¼ë¡œ ë³´ì.
`UserResource` ê°€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì†Œí†µí•˜ê²Œ í•˜ë ¤ë©´ `UserRepository` ë¥¼ ê±°ì¹˜ê²Œë” í•´ì•¼ í•œë‹¤.
ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ `UserRepository` ë¡œ ì…ë ¥í•˜ê³  `extends JpaRepository` ë¥¼ ìƒì†ë°›ì•„ì˜¨ë‹¤.

#### JpaRepository?

ì´ ì¸í„°í˜ì´ìŠ¤ëŠ” ì–´ë–¤ ì—”í„°í‹°ë¥¼ ê´€ë¦¬í• ê¹Œ? `User` ì—”í„°í‹°ì´ë‹¤.
`Id` í•„ë“œ íƒ€ì…ì€ `Integer` ì´ë‹ˆ, ì„¸íŒ…í•œ í›„ ì €ì¥.

```
package com.in28minutes.rest.webservices_06.restful_web_services.jpa;
import org.springframework.data.jpa.repository.JpaRepository;
import com.in28minutes.rest.webservices_06.restful_web_services.user.User;

public interface UserRepository extends JpaRepository<User, Integer>{

}
```

`jpa` ë¼ëŠ” íŒ¨í‚¤ì§€ë¡œ ì´ë™ì‹œì¼°ë‹¤. `package` ë’¤ì— `.jpa` ì´ëŸ°ì‹ìœ¼ë¡œ ë¶™ì´ê³  `cmd + 1` ì„ í•˜ë©´ ì‰½ê²Œ ì´ë™ì´ ê°€ëŠ¥í•˜ë‹¤.
ì´ì œ ì´ `UserRepository` ë¥¼ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì†Œí†µ.
`UserResource` ê¸°ì¡´ì— ìˆë˜ê²ƒì„ ì§ì ‘ ìˆ˜ì •í•˜ëŠ”ëŒ€ì‹  ë³µì‚¬ë³¸ìœ¼ë¡œ ì‘ì—….
`UserJpaResource` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë§Œë“¤ì.

ë§¤í•‘ë˜ì—ˆë˜ ì£¼ì†ŒëŠ” `users => jpa` ë¡œ ë°”ê¾¸ì–´ì¤€ë‹¤.
ì´ì œ `UserJpaResource` ì—ì„œ `UserRepository` ë¥¼ ì‚¬ìš©í•  ì¤€ë¹„ë¥¼ í•œê²ƒì´ë‹¤. `UserDaoService` ëŒ€ì‹ ì— `UserRepository` ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ.

UserDaoServiceë¥¼ `UserRepository` ë¡œ ë°”ê¾¸ê³  importë¥¼ í•˜ê³  ë³´ë©´

`import com.in28minutes.rest.webservices_06.restful_web_services.jpa.UserRepository;`

ì´ ë¶€ë¶„ì´ importë˜ì–´ì„œ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.

```java
	public UserJpaResource(UserDaoService service, UserRepository repository) {
		this.service = service;
		this.repository = repository;
	}
```

ê¸°ì¡´ì— ìˆë˜ serviceëŠ” ì¼ë‹¨ ë‘ê³  `repository` ë¥¼ ê°€ì ¸ì™€ì„œ ìƒì„±ìë¡œ ì—°ê²°í•´ì¤€ë‹¤.

ì´ì œ ì²« ë²ˆì§¸ ì„œë¹„ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë” í•´ì•¼í•œë‹¤.
![](https://velog.velcdn.com/images/bibiboy/post/c214f432-770f-4239-9f87-41b16c6026db/image.png)

`localhost:8080/jpa/users` ë¡œ ë“¤ì–´ê°€ë³´ë©´ `ì—”í„°í‹° ì‚¬ìš©ìì— ëŒ€í•œ ê¸°ë³¸ ìƒì„±ìê°€ ì—†ë‹¤` ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.

`User` í´ë˜ìŠ¤ì—ì„œ `jpa` ë¥¼ ì‚¬ìš©í•˜ê¸° ëŒ€ë¬¸ì— ê¸°ë³¸ ìƒì„±ìê°€ í•„ìš”í•˜ë‹¤.

```java
// User.java
protected User() {}
```

ì´ë ‡ê²Œ ê¸°ë³¸ ìƒì„±ìë¥¼ ë„£ì–´ì£¼ê³  ìƒˆë¡œ ì¡°íšŒë¥¼ í•´ë³´ë©´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì˜ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.

![](https://velog.velcdn.com/images/bibiboy/post/95cda81f-4ba6-4b38-828b-0b083831df2f/image.png)

```java
// UserJpaResource.java

// Get path ìˆ˜ì •
	@GetMapping("/jpa/users/{id}")
	public EntityModel<User> retrieveUser(@PathVariable Integer id ) {
		Optional<User> user = repository.findById(id);
		if (user.isEmpty()) {
			throw new UserNotFoundException("id:" + id);
		}
		EntityModel<User> entityModel = EntityModel.of(user.get());
		WebMvcLinkBuilder link = linkTo(methodOn(this.getClass()).retrieveAllUsers());
		entityModel.add(link.withRel("all-users"));

		return entityModel;
	}
```

ê¸°ì¡´ì´ë‘ ë°”ë€ì ì€ ì¼ë‹¨ `repository` ì—ëŠ” `findOne` ì´ ì—†ê¸° ë•Œë¬¸ì— `findById` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í–ˆê³ , `user.isMEmpty()` ë¡œ íŠ¹ì • idì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ìê°€ ì—†ëŠ”ì§€ í™•ì¸í•œë‹¤.
ì´ë ‡ê²Œ ë˜ë©´ íƒ€ì…ì´ `Optional<User>` ë¡œ ë°”ê¾¸ì–´ì•¼ í•˜ëŠ”ë° ë°”ê¾¸ê²Œ ë˜ë©´ `EntityModel.of(user.get())` ì²˜ëŸ¼ `get` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì´í›„ì— `localhost:8080/jpa/users/1001` ë¡œ ê²€ìƒ‰í•´ë³´ë©´ ì‚¬ìš©ìê°€ ì œëŒ€ë¡œ ë‚´ë ¤ì˜¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```java
// DELETE user
@DeleteMapping("/jpa/users/{id}")
public void deleteUser(@PathVariable Integer id ) {
	repository.deleteById(id);
}
```

`delete` ì˜ ê²½ìš°ì—ëŠ” ê·¸ëƒ¥ `repository` ë¡œë§Œ ë°”ê¾¸ì–´ì£¼ë©´ ëœë‹¤.

`save` ë˜í•œ ë§ˆì°¬ê°€ì§€ë¡œ repository ë¼ê³ ë§Œ ë°”ê¾¸ì–´ì£¼ë©´ ëœë‹¤.

ì´ë ‡ê²Œ `UserDaoService` ë¡œ ì“°ë˜ê²ƒì„ `UserRepository` ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í–ˆë‹¤.
