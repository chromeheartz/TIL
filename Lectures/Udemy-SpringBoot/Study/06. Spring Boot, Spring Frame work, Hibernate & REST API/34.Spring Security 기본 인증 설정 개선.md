## Spring Boot, Spring Frame work, Hibernate / REST API

### 34. Spring Security ê¸°ë³¸ ì¸ì¦ ì„¤ì • ê°œì„ 

---

### ğŸ“Œ Spring Security ê¸°ë³¸ ì¸ì¦ ì„¤ì • ê°œì„ 

`POST` ë¡œëŠ” ì¸ì¦ í—¤ë”ë¥¼ ì„¤ì •í•˜ê³  ì‚¬ìš©í–ˆì—ˆë‹¤.
ì „ì†¡ì„ ëˆ„ë¥´ë©´ 403ì´ ëŒì•„ì˜¤ëŠ”ë° ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?

ì¼ë‹¨ ë¬¸ì œ í•´ê²°ë°©ë²•ì„ ì•Œì•„ë³´ê¸° ì „ì— `Spring Security` ì˜ ì›ë¦¬ë¥¼ ê³ ì°¨ì›ìœ¼ë¡œ ì‚´í´ë³´ì.
ìš”ì²­ì„ ë³´ë‚¼ ë•Œë§ˆë‹¤ í•´ë‹¹ ìš”ì²­ì„ Spring Securityê°€ ê°€ë¡œì±„ëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´ APIë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì´ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì¼ë ¨ì˜ í•„í„°ë¥¼ ì‹¤í–‰í•œë‹¤.

#### â­ï¸ í•„í„° ì²´ì¸

ì´ëŸ° ì¼ë ¨ì˜ í•„í„°ë¥¼ `í•„í„° ì²´ì¸` ì´ë¼ê³  í•˜ëŠ”ë°, ì´ í•„í„°ì²´ì¸ì—ì„œ í™•ì¸ì´ ì—¬ëŸ¬ ì°¨ë¡€ ì´ë£¨ì–´ì§„ë‹¤. 1ë²ˆì€ ëª¨ë“  ìš”ì²­ì´ ì¸ì¦ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì¸ë°, ëª¨ë“  ìš”ì²­ì— `ìê²© ì¦ëª…` ì´ ì²¨ë¶€ë˜ì–´ì•¼ í•œë‹¤. ì´ê²ƒì´ ì²« ë²ˆì§¸ í™•ì¸ ì ˆì°¨.

ìš”ì²­ì´ ì¸ì¦ë˜ì§€ ì•Šê±°ë‚˜, ìê²©ì¦ëª…ì´ ì—†ë‹¤ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ `ì›¹í˜ì´ì§€` ê°€ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤.
í•„í„° ì²´ì¸ì—ì„œ ìˆ˜í–‰ë˜ëŠ”ê²ƒ ì¤‘ í•˜ë‚˜ê°€ `CSRF` ë¼ê³  í•˜ëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆê²Œ ì„¤ì •í•˜ëŠ” ê²ƒì¸ë°, ì´ë ‡ê²Œ í•˜ë©´ `POST / PUT` ìš”ì²­ì— ì˜í–¥ì„ ì£¼ê²Œ ëœë‹¤.

ê·¸ ì™¸ì—ë„ í•„í„° ì²´ì¸ì—ì„œ ìˆ˜í–‰ë˜ëŠ” ê²ƒë“¤ì´ ì•„ì£¼ ë§ì€ë°, ì´ í•„í„°ì²´ì¸ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•´ë³´ì.

#### ğŸ“ ê¸°ì¡´í˜ì´ì§€ì—ì„œ ìˆ˜ì •í•´ì•¼í•  2ê°€ì§€

1. `ë‚˜íƒ€ë‚˜ê³  ìˆëŠ” ê¸°ë³¸ ì›¹í˜ì´ì§€`
   ê¸°ë³¸ ì›¹í˜ì´ì§€ê°€ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì€ ë³¼ ìˆ˜ ìˆëŠ”ë°, ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ë‚˜ì˜¤ë©´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì •ë§ ì¢‹ì„ê²ƒì´ë‹¤. í•˜ì§€ë§Œ `REST API` ì˜ ê²½ìš°ì—ëŠ” `HTTP ê¸°ë³¸ ì¸ì¦` ì´ë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë‹ˆ HTTP ì¸ì¦ì„ ì‚¬ìš©í•  ë•ŒëŠ” `localhost users` ë¥¼ ì…ë ¥í•˜ê²Œ ë˜ë©´ `ì‚¬ìš©ì ìê²© ì¦ëª…` ì„ ë¬»ëŠ” íŒì—…ì°½ì´ ë– ì•¼ í•œë‹¤.
   ì´ê²Œ ì²«ë²ˆì§¸ë¡œ ë³€ê²½í•˜ë ¤ëŠ” ì‚¬í•­ì´ë‹¤.

2. `CSRF` ë¥¼ í•´ì œí•´ì„œ POST ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•œë‹¤.
   Spring Securityì—ì„œ ê¸°ì¡´ í•„í„° ì²´ì¸ì„ ì˜¤ë²„ë¼ì´ë“œí•˜ë ¤ë©´ ì²´ì¸ ì „ì²´ë¥¼ `ë‹¤ì‹œ ì •ì˜` í•´ì•¼ í•œë‹¤.

ì„¤ì • íŒŒì¼ì„ ìƒì„±í•˜ê³  ì—¬ê¸°ì— í•„í„° ì²´ì¸ì„ ì •ì˜í•  `Bean` ì„ ìƒì„±. ì´í›„ í•„í„° ì²´ì¸ì„ êµ¬ì„±í•˜ëŠ” ëª¨ë“  ë‹¨ê³„ë¥¼ ì •ì˜í•œë‹¤.

`src/main/java` ë¡œ ë“¤ì–´ê°€ì„œ `.security` ë¼ëŠ” íŒ¨í‚¤ì§€ì— ìƒˆ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
`SpringSecurityConfiguration` ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ì—ˆëŠ”ë° ì„¤ì •ì´ë‹ˆ `@Configuration` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì¤€ë‹¤.
ì´ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ í•˜ë‚˜ ì´ìƒì˜ `@Bean` ë©”ì†Œë“œë¥¼ ì„ ì–¸í•œë‹¤ëŠ” ëœ»ì´ê³ , Spring Containerë¡œ ì²˜ë¦¬ë˜ì–´ `Bean ì •ì˜` ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

`@Bean` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì„œ í•„í„° ì²´ì¸ì„ ì •ì˜í• ê²ƒì¸ë°, `Spring Security` ì—ì„œëŠ” `SecurityFilterChain` ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ê°€ì ¸ì™€ì„œ êµ¬í˜„í•œë‹¤.
`HttpServletRequest` ì— ëŒ€ì‘í•˜ëŠ” í•„í„° ì²´ì¸ì„ ì •ì˜í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

httpë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤. ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜ˆì™¸ë¼ê³  ë‚˜ì˜¤ëŠ”ë° ì´ë•ŒëŠ” `cmd + 1` ë¡œ `throws ì„ ì–¸ ì¶”ê°€` ë¥¼ ì„ ì±…í•˜ë©´ ì´ êµ¬ë¬¸ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ë˜ì§€ê²Œ ëœë‹¤.

```
@Configuration
public class SpringSecurityConfiguration {

	@Bean
	public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
		return http.build();
	}
}
```

í˜„ì¬ ê¸°ì ì—ì„œ `localhost:8080/users` ë¥¼ ë“¤ì–´ê°€ë³´ë©´ ì‘ë‹µì´ ë‚˜ì˜¤ëŠ”ë°, ì´ì œ ì—¬ê¸°ì„œ Spring Securityì— ì •ì˜ë˜ì–´ ìˆëŠ” ê¸°ë³¸ê°’ í•„í„° ì²´ì¸ì„ ì˜¤ë²„ë¼ì´ë“œí• ê²ƒì´ë‹¤.

#### ğŸ“ ì¸ì¦

> ì¼ë‹¨ ì œì¼ ë¨¼ì € í•  ê²ƒì€ `ëª¨ë“  ìš”ì²­` ì´ `ì¸ì¦` ë˜ë„ë¡ í•  ê²ƒì´ë‹¤.

`http.authorizeHttpRequest` ë¥¼ ì…ë ¥í•˜ê³ , ë¡œì§ì„ ì •ì˜í•´ì•¼ í•œë‹¤.
ë³€ìˆ˜ëª…ì„ auth.anyRequestë¼ê³  ì…ë ¥í•˜ë©´ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì „ë¶€ ì¸ì¦ì„ ë°›ê²Œ ëœë‹¤.
`ëŒë‹¤ì‹` ìœ¼ë¡œ êµ¬í˜„.

```
http.authorizeHttpRequests(
	auth -> auth.anyRequest().authenticated();
)
```

![](https://velog.velcdn.com/images/bibiboy/post/92423d46-a543-4118-9f3b-516bdf11279a/image.png)

ì´ ìƒíƒœì—ì„œ APIë¥¼ ì‚¬ìš©í•´ë³´ë©´ `localhost` ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ê°€ ê±°ë¶€ë˜ì—ˆë‹¤ê³  ë‚˜ì˜¨ë‹¤.

`403` ì‘ë‹µì„ ë°›ê³  ìˆëŠ”ë°, ì´ í˜ì´ì§€ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ì—†ë‹¤.
ê¸°ë³¸ê°’ìœ¼ë¡œ ìš”ì²­ì´ ì¸ì¦ì„ ë°›ì§€ ëª»í•˜ë©´ ì›¹í˜ì´ì§€ê°€ ë‚˜íƒ€ë‚œë‹¤. í•˜ì§€ë§Œ `REST API` ì˜ ê²½ìš° ê¸°ë³¸ ì¸ì¦ì„ ì‚¬ìš© ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë° `http.httpBasic` ì„ ì…ë ¥í•´ì„œ ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
`withDefaults` ë¼ê³  ì…ë ¥í•´ì„œ ë©”ì†Œë“œë¥¼ ë„£ìœ¼ë©´ ëœë‹¤.
ì´ ë©”ì†Œë“œëŠ” `Customizer` í´ë˜ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ë©´ `org.springframework.security.config.Customizer` ë¼ëŠ” í´ë˜ìŠ¤ê°€ ìˆë‹¤

`import static org.springframework.security.config.Customizer.withDefaults;`
ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ë©´ í´ë˜ìŠ¤ëª…ì„ ì¨ì£¼ì§€ ì•Šì•„ë„ ê³§ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

![](https://velog.velcdn.com/images/bibiboy/post/ebf1aff8-41be-4ed8-ad09-83714dc41153/image.png)

ìƒˆë¡œê³ ì¹¨í•˜ê³  ë³´ê²Œë˜ë©´ `ê¸°ë³¸ ì¸ì¦` ì´ ë™ì‘í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ `CSRF` ë¥¼ í•´ì œí•˜ëŠ” ê²ƒì¸ë°,
`http.csrf().disable()` ì„ ì…ë ¥í•˜ê³  ì €ì¥í•œ ë‹¤ìŒ `POST` ìš”ì²­ì„ ë³´ë‚´ë³´ì.

```java
@Configuration
public class SpringSecurityConfiguration {

	@Bean
	public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
		http.authorizeHttpRequests(
					auth -> auth.anyRequest().authenticated()
				);
		http.httpBasic(withDefaults());
		http.csrf().disable();
		return http.build();
	}
}
```

ì´ë ‡ê²Œ í•˜ê³  POSTìš”ì²­ì„ ë³´ë‚´ë³´ë©´ 201ìœ¼ë¡œ ì œëŒ€ë¡œ ì‘ë‹µì´ ë“¤ì–´ì˜¤ê³  ì‹¤í–‰ë˜ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
``
