## Spring Boot, Spring Frame work, Hibernate / REST API

### 28. User ì—”í„°í‹°ì™€ ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ Post ì—”í„°í‹° ìƒì„±í•˜ê¸°

---

### ğŸ“Œ User ì—”í„°í‹°ì™€ ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ Post ì—”í„°í‹° ìƒì„±

í˜„ì¬ëŠ” `ì‚¬ìš©ì ê²€ìƒ‰ / ì‚¬ìš©ì ìƒì„± / ë‹¨ì¼ ì‚¬ìš©ì ê²€ìƒ‰ / ì‚¬ìš©ì ì‚­ì œ` ê¹Œì§€ í–ˆë‹¤.
ì´ì œ `ê²Œì‹œë¬¼` ê´€ë ¨í•œ `REST API` ë¥¼ ìƒì„±í•´ë³´ì.

íŠ¹ì • ì‚¬ìš©ìì— ëŒ€í•´ ëª¨ë“  ê²Œì‹œë¬¼ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ê³ í•˜ê³ , íŠ¹ì • ì‚¬ìš©ìì— ëŒ€í•œ ê²Œì‹œë¬¼ ìƒì„±ë„ ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ê³  í•œë‹¤. ì´ë¥¼ ìœ„í•´ ì¼ë‹¨ `ê²Œì‹œë¬¼` ì—”í„°í‹°ë¥¼ ë¨¼ì € ìƒì„±í•´ë³´ì.

```java

@Entity
public class Post {

	@Id
	@GeneratedValue
	private Integer id;

	private String description;

}
```

ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ê³  `cmd + opt + s` ë¡œ `getter,setter / toString` ì„ ì¶”ê°€í•œë‹¤.
ê·¸ë ‡ê²Œ ë˜ë©´ `Post` ì—”í„°í‹°ê°€ ì¤€ë¹„ê°€ ëœë‹¤.
ì´í›„ì— `H2 console` ë¡œ ë“¤ì–´ê°€ë³´ê²Œ ë˜ë©´ `POST` í…Œì´ë¸”ì´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ê²Œì‹œë¬¼ì´ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë‹ˆ ì´ì œ ê²Œì‹œë¬¼ì„ ì‚¬ìš©ìì—ê²Œ ë§¤í•‘í•´ì•¼ í•œë‹¤.

`Post.java` ì—ì„œ ê²Œì‹œë¬¼ì´ íŠ¹ì •ì‚¬ìš©ìì—ê²Œ ë§¤í•‘ëœë‹¤.
ì¼ë‹¨ `private User user;` ë¥¼ ì‘ì„±í•´ë†“ê³  Userì—”í„°í‹°ë¡œ ë“¤ì–´ê°€ì„œ ì—¬ê¸°ì„œë„ ê²Œì‹œë¬¼ ëª©ë¡ì„ ì €ì¥í•´ì•¼ í•œë‹¤.
ì‚¬ìš©ìì™€ ê²Œì‹œë¬¼ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ì•¼ í•˜ëŠ”ë° ì‚¬ìš©ìì™€ ê²Œì‹œë¬¼ì˜ ê´€ê³„ëŠ” ì–´ë–¤ ê´€ê³„ì¼ê¹Œ?
ì‚¬ìš©ì 1ëª…ì€ ì—¬ëŸ¬ ê²Œì‹œë¬¼ì„ ë‘˜ ìˆ˜ ìˆìœ¼ë‹ˆ `ì¼ëŒ€ë‹¤` ê´€ê³„ê°€ ë ê²ƒì´ë‹¤.

> âœ… `OneToMany` ì•ˆì— ì†ì„±ìœ¼ë¡œ ë§¤í•‘í•˜ê¸°ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
> íŠ¹ì • ê´€ê³„ë¥¼ ê°€ì§€ëŠ” í•„ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ê·¸ë ‡ê²Œë˜ë©´ `mappedby=` ë‹¤ìŒì— `Post` ì—ì„œ ì´ ê´€ê³„ë¥¼ ê°€ì§€ëŠ” í•„ë“œê°€ ë¬´ì—‡ì¸ì§€ ë„£ì–´ì£¼ë©´ ë˜ë‹ˆ `user` ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.

```java
@OneToMany(mappedBy="user")
private List<Post> posts;
```

`Post` ì—ì„œëŠ” ê´€ê³„ê°€ ë°˜ëŒ€ì¸ë° `ManyToOne` ìœ¼ë¡œ ë„£ì–´ì¤€ë‹¤.

> â­ï¸ `User Bean / Post Bean` ì´ ê°ê° ì„œë¡œì˜ ì‘ë‹µì˜ ì¼ë¶€ë¶„ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆëŠ”ê²ƒì´ë‹¤.
> User Beanì— ëŒ€í•´ ê²Œì‹œë¬¼ì„ JSON ì‘ë‹µì— í¬í•¨ì‹œí‚¤ë ¤ëŠ”ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— `JsonIgnore` ë¥¼ ë„£ì–´ì¤€ë‹¤.

ì—¬ê¸°ì„œ ì¶”ê°€ë¡œ `Post` ì˜ `ManyToOne` ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í• ê²ƒì´ë‹¤.
`cmd + space` ë¥¼ ëˆ„ë¥´ë©´ íŒì—…ì°½ì´ ì—´ë¦¬ë©´ì„œ ê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ì†ì„±ì´ ìˆëŠ”ë° í˜„ì¬ í•„ìš”í•œ ì†ì„±ì€ `fetch` ì´ë‹¤.

ì—¬ê¸° ìˆëŠ” `fetch` ì†ì„±ì€ ê´€ê³„ê°€ ì§€ì—°ë¡œë”© ë˜ëŠ”ì§€ ì•„ë‹ˆë©´ ì¦‰ì‹œ ë¡œë”©ë˜ëŠ”ì§€ ê²°ì •í•œë‹¤.

#### ì§€ì—°ë¡œë”© ? ì¦‰ì‹œë¡œë”© ?

ë™ì¼í•œ ì¿¼ë¦¬ì—ì„œ ê²Œì‹œë¬¼ê³¼ ì‚¬ìš©ìì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ë ¤ê³  í•œë‹¤ë©´ `EAGER fetch` ë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒì¸ë°, ê²Œì‹œë¬¼ ì„¸ë¶€ ì •ë³´ì™€ í•¨ê»˜ ê°€ì ¸ì˜¤ë„ë¡ ìš”ì²­í•˜ë©´ ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë„ ê°™ì´ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.
ì´ê²ƒì´ ë‹¤ëŒ€ì¼ ê´€ê³„ì—ì„œ ê¸°ë³¸ê°’ì´ë‹¤.
í•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” `LAZY fetch` íƒ€ì…ì„ ì‚¬ìš©í• ê²ƒì¸ë° ê·¸ë ‡ê²Œ í•˜ë ¤ë©´ fetch íƒ€ì…ìœ¼ë¡œ `FetchType.LAZY` ë¥¼ ë„£ì–´ì¤€ë‹¤.

`spring.jpa.show-sql=true` ì´ëŸ° êµ¬ë¬¸ì„ application.propertiesì— ì„¤ì •í•´ì¤„ê²ƒì¸ë° ì´ ìš©ë„ëŠ” ë¬´ì—‡ì¼ê¹Œ? ì½˜ì†”ì„ ë³´ê²Œ ë˜ë©´ ì¿¼ë¦¬ ëª‡ê°œê°€ ì¶œë ¥ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

```
Hibernate: drop table if exists post cascade
Hibernate: drop table if exists user_details cascade
Hibernate: drop sequence if exists post_seq
Hibernate: drop sequence if exists user_details_seq
Hibernate: create sequence post_seq start with 1 increment by 50
Hibernate: create sequence user_details_seq start with 1 increment by 50
Hibernate: create table post (id integer not null, user_id integer, description varchar(255), primary key (id))
Hibernate: create table user_details (birth_date date, id integer not null, name varchar(255), primary key (id))
Hibernate: alter table if exists post add constraint FKa3biitl48c71riii9uyelpdhb foreign key (user_id) references user_details
```

ë¡œê·¸ë¥¼ ë³´ê²Œ ë˜ë©´ `table` ì´ ìƒì„±ì´ ë˜ê³ , `id, ìƒë…„ì›”ì¼, ì´ë¦„` ë“±ì„ í•´ì£¼ê³  `post` í…Œì´ë¸”ë„ ìƒì„±ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆëŠ”ë°, í¥ë¯¸ë¡œìš´ ê²ƒì€ `user_id` í•„ë“œì´ë‹¤.

ê²Œì‹œë¬¼ì€ ì‚¬ìš©ìì™€ ì—°ê²°í•˜ê¸° ë•Œë¬¸ì— ì´ í•„ë“œê°€ ìœ ìš©í•œê²ƒì´ë‹¤.

#### ê·¸ëŸ¼ ì™œ user_id í•„ë“œê°€ Postì— ìƒì„±ë ê¹Œ

`Post` ì— `user` ê°ì²´ë¥¼ ìƒì„±í–ˆê³ , `User` í´ë˜ìŠ¤ì—ì„œ ê´€ê³„ì˜ ì†Œìœ ìëŠ” `user` ë¼ê³  í–ˆë‹¤. ê·¸ë˜ì„œ user_id ì—´ì´ Post í´ë˜ìŠ¤ì— ìƒì„±ëœê²ƒì´ë‹¤.

ë˜ í˜„ì¬ ë³´ë©´ `sequence` ê°€ ìƒê¸°ê³  ìˆëŠ”ë°,
`user_details_seq` ëŠ” Userì— `@GeneratedValue, id` ë¥¼ ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì´ê³ ,
`post_seq` ì—ì„œë„ idí•„ë“œì— `@GeneratedValue` ë¥¼ ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ¬ë‹ˆê¹Œ ì¦‰, ì´ ì‹œí€€ìŠ¤ 2ê°œëŠ” ìƒˆ ê²Œì‹œë¬¼ì´ë‚˜ ìƒˆ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ë•Œ `ID` ê°’ ìƒì„±ì— ì‚¬ìš©ëœë‹¤.

`data.sql` ì— ì´ëŸ° sqlì„ ë„£ê³  ì‹œì‘í•˜ê²Œ ë˜ë©´

```
insert into post(id, description, user_id)
values(2001, 'I Want to Learn AWS', 1001);

insert into post(id, description, user_id)
values(2002, 'I Want to Learn DevOps', 1002);

insert into post(id, description, user_id)
values(2003, 'I Want to Learn Cloud', 1001);
```

ì´ì œ ê²Œì‹œë¬¼ ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
![](https://velog.velcdn.com/images/bibiboy/post/6ac9fb64-cc01-4e85-8fae-aa03b140de02/image.png)
