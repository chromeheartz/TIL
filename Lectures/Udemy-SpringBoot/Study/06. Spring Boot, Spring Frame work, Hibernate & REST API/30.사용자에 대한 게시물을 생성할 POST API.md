## Spring Boot, Spring Frame work, Hibernate / REST API

### 30. ì‚¬ìš©ìì— ëŒ€í•œ ê²Œì‹œë¬¼ì„ ìƒì„±í•  POST API

---

### ğŸ“Œ ì‚¬ìš©ìì— ëŒ€í•œ ê²Œì‹œë¬¼ ìƒì„± API

ê¸°ì¡´ì— `ì‚¬ìš©ì` ë¥¼ ìœ„í•œ `UserRepository` ë¥¼ ë§Œë“¤ì—ˆì—ˆëŠ”ë° ì´ì œ ê²Œì‹œë¬¼ì„ ìœ„í•œ ê²Œì‹œë¬¼ ì €ì¥ì†Œê°€ í•„ìš”í•˜ë‹¤.
`Post` ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `import` ë¥¼ ì •ë¦¬í•´ì¤€ë‹¤.

```java
package com.in28minutes.rest.webservices_06.restful_web_services.jpa;
import org.springframework.data.jpa.repository.JpaRepository;
import com.in28minutes.rest.webservices_06.restful_web_services.user.Post;

public interface PostRepository extends JpaRepository<Post, Integer>{

}
```

ì´ì œ ì´ ê²Œì‹œë¬¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ `UserJpaResource` ì—ì„œ ë˜‘ê°™ì´ ì„ ì–¸ì„ í•´ì¤€ë‹¤.
ë˜í•œ ìƒì„±ì ì£¼ì…ì„ í•´ì£¼ê¸° ìœ„í•´ `UserJpaResource` í•¨ìˆ˜ì—ì„œ ë„£ì–´ì£¼ì—ˆë˜ ê²ƒì²˜ëŸ¼ `postRepository` ë˜í•œ ë„£ì–´ì¤€ë‹¤.

```
private UserRepository repository;
private PostRepository postRepository;

public UserJpaResource(UserDaoService service, UserRepository repository, PostRepository postRepository) {
	this.repository = repository;
	this.postRepository = postRepository;
}
```

`createPostForUser` ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆëŠ”ë° ì´ ì•ˆì— `id` ì™€ `@Valid / @RequestBody` ë¡œ ê²€ì¦í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

ê·¸ëŸ¼ ì´ íŠ¹ì • ì‚¬ìš©ì idì— ëŒ€í•´ ê²Œì‹œë¬¼ì„ ìƒì„±í•˜ê²Œ ë˜ëŠ”ë°, ê²Œì‹œë¬¼ì— ëŒ€í•œ ê²€ì¦ë„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ê¸°ì¡´ì— í–ˆë˜ê²ƒì²˜ëŸ¼ `@Size(min=10)` ê°™ì€ í˜•ì‹

ì¶”ê°€ë¡œ ì§€ê¸ˆ Post.javaì—ëŠ” `User` ì— ëŒ€í•´ ê²Œí„°/ì„¸í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— `setDescription` ë’¤ì— ì‚½ì…ì„ ì„ íƒí•˜ê³  ìƒì„±ì„ ëˆ„ë¥´ê²Œ ë˜ë©´ `getUser / setUser` ë©”ì†Œë“œê°€ ìƒê¸°ê²Œ ëœë‹¤.

`post.setUser(user)` ë¼ê³  í•˜ë©´ ê²Œì‹œë¬¼ì— ì‚¬ìš©ìë¥¼ ì„¤ì •í•˜ê²Œ ë˜ëŠ”ë°, ì´ë•Œ `.get()` ì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤.

ì´í›„ì— ê²Œì‹œë¬¼ ì €ì¥ì†Œê°€ ìˆìœ¼ë‹ˆê¹Œ `postRepository.save()` ë¼ê³  ì…ë ¥í•œ ì´í›„ì— `post` ë¥¼ ë„£ì–´ì¤€ë‹¤.

```java
	@PostMapping("/jpa/users/{id}/posts")
	public ResponseEntity<Post>  createPostForUser(@PathVariable Integer id, @Valid @RequestBody Post post) {
		Optional<User> user = repository.findById(id);
		if (user.isEmpty()) {
			throw new UserNotFoundException("id:" + id);
		}

		post.setUser(user.get());

		Post savedPost = postRepository.save(post);

		URI location = ServletUriComponentsBuilder.fromCurrentRequest().path("/{id}").buildAndExpand(savedPost.getId()).toUri();

		return ResponseEntity.created(location).build();
	}
```

ê¸°ì¡´ì— í–ˆë˜ createUserì™€ ë¹„ìŠ·í•œ í˜•ì‹ìœ¼ë¡œ ê°„ë‹¨íˆ ë§ˆë¬´ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤.

<img width="516" alt="Image" src="https://github.com/user-attachments/assets/ff393cc9-76b0-4936-a9a4-82e57c273c41" />
