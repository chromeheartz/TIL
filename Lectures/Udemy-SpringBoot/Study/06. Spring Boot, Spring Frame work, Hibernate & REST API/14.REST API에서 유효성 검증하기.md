## Spring Boot, Spring Frame work, Hibernate / REST API

### 14. REST APIì—ì„œ ìœ íš¨ì„± ê²€ì¦í•˜ê¸°

---

### ğŸ“Œ REST API ì—ì„œ ìœ íš¨ì„± ê²€ì¦

í˜„ì¬ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì€ ì™„ë£Œí–ˆë‹¤.
í•˜ì§€ë§Œ ì´ë¦„ì´ ë¹„ì–´ìˆê³ , ìƒì¼ì€ í˜„ ì‹œì  ê¸°ì¤€ ë¯¸ë˜ë¡œ ë³´ë‚´ê²Œë˜ë©´ ì—¬ì „íˆ ìƒì„±ë˜ê³ , ì¡°íšŒì—ë„ ì´ë¦„ì´ ì—†ê³  ìƒì¼ì´ ë¯¸ë˜ì¸ ì‚¬ìš©ìê°€ ë“¤ì–´ê°€ê²Œ ëœë‹¤.

ì´ë¥¼ í•´ê²°í•˜ë ¤ê³  í•œë‹¤.

#### ê²€ì¦

ê²€ì¦ì„ ì ìš©í•˜ë ¤ë©´ `ì¶”ê°€ ì˜ì¡´ì„±` ì´ í•„ìš”í•œë°, `starter-validation` ì´ë€ê²ƒì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.
`pom.xml` ì— ì¶”ê°€í•´ì£¼ê³  ë‚˜ì„œ `UserResource` íŒŒì¼ì—ì„œ `createUser` ë©”ì†Œë“œì—ì„œ `User` ê°€ ìœ íš¨í•œì§€ í™•ì¸í•´ë³´ì.
`@ReqwuestBody` ì•ì— `@Valid` ë¥¼ ë¶™ì´ë©´ ëœë‹¤.

> `@Valid` ì´ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ë°”ì¸ë”©ì´ ìˆ˜í–‰ë  ë•Œ ê°ì²´ì— ì •ì˜ëœ ìœ íš¨ì„± ê²€ì¦ì´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤.

ì•„ì§ ìš°ë¦¬ ë¹ˆì—ëŠ” ì •ì˜í•´ë‘” `ê²€ì¦ ì¡°ê±´` ì´ ì—†ê¸° ë•Œë¬¸ì— `User.java` ì—ì„œ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

```java
	private Integer id;

	@Size(min=2)
	private String name;

	@Past
	private LocalDate birthDate;
```

`@Size` ë¥¼ ë„£ì–´ì„œ ì´ë¦„ì´ ìµœì†Œ 2ê¸€ìì—¬ì•¼ í•œë‹¤ëŠ” ì¡°ê±´ì„ ë„£ê³ , ìƒì¼ì€ í•­ìƒ `ê³¼ê±°ì˜ ë‚ ì§œ` ë¡œ ì„¤ì •ë˜ê²Œ `@Past` ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ì¡°ê±´ì„ ì¶”ê°€í•œ ê²ƒì´ë‹¤.
`constraints` í´ë˜ìŠ¤ë¥¼ ì—´ì–´ë³´ê²Œ ë˜ë©´ `DemicalMax / DemicalMin` ë„ ìˆëŠ”ë° ìˆ«ì íƒ€ì…ì¸ í•­ëª©ì´ ìµœì†Ÿê°’ë³´ë‹¤ í°ì§€ ìµœëŒ€ê°’ë³´ë‹¤ ì‘ì€ì§€ë¥¼ í™•ì¸í•œë‹¤. `Digits` ëŠ” ìˆ«ìì˜ ê°œìˆ˜ë¥¼ í™•ì¸.

ëŒ€ìƒ í•­ëª©ì´ ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë§ì€ ìœ íš¨ì„±ê²€ì¦ ë°©ë²•ì´ ì •ì˜ë˜ì–´ ìˆë‹¤ëŠ” ëœ». ë˜í•œ `ì •ê·œì‹ í‘œí˜„` ë„ ì“¸ ìˆ˜ ìˆë‹¤.

<img width="1083" alt="Image" src="https://github.com/user-attachments/assets/d94d0b12-4708-4800-8fbe-7bfa0bd1841d" />

ì´ì œ `POST` ìš”ì²­ì„ ë³´ë‚´ë©´ `400` ì´ ë°˜í™˜ëœë‹¤.
ì—¬ê¸°ì„œ ë¬¸ì œê°€ ìˆë‹¤ë©´ ì´ ì‘ë‹µê°’ì€ ìš”ì²­ì— ë¬´ì—‡ì´ ì˜ëª»ëœì§€ ì „í˜€ ì•Œë ¤ì£¼ì§€ ì•Šê³  ìˆë‹¤. ê·¸ëŸ¼ ì–´ë–»ê²Œ ê°œì„ í• ê¹Œ?
`ResponseEntityExceptionHandler` ë¡œ ê°€ë©´

```java
protected ResponseEntity<Object> handleMethodArgumentNotValid(
		MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatusCode status, WebRequest request) {

	return handleExceptionInternal(ex, null, headers, status, request);
}
```

ê°€ ìˆëŠ”ë° ì´ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•´ì„œ ìš°ë¦¬ ìƒí™©ì— ë§ê²Œ ê³ ì³ì£¼ì–´ì•¼ í•œë‹¤.
ì´ ë©”ì†Œë“œë¥¼ ë³´ë©´ `í—¤ë”, ìƒíƒœ ì½”ë“œ, ì›¹ ìš”ì²­` ê¹Œì§€ ì¸ìë¡œ ë°›ëŠ”ë‹¤.

ì´ ì•ˆì—

```java
ErrorDetails errorDetails = new ErrorDetails(LocalDateTime.now(), ex.getMessage(), request.getDescription(false));

	return new ResponseEntity<ErrorDetails>(errorDetails, HttpStatus.BAD_REQUEST);
```

ë¥¼ ë„£ì–´ì£¼ëŠ”ë° ê¸°ì¡´ê³¼ ê°™ì´ `ErrorDetails` ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ì§€ìš°ê³ , `ì‹œê·¸ë‹ˆì²˜` ê°™ì€ê²ƒì„ ì¨ì•¼ í•œë‹¤. ì˜¤ë²„ë¼ì´ë“œ í• ê²ƒì´ë¼ì„œ `@Override` ë¥¼ ì¶”ê°€.
ì´ì œ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•´ë³´ë©´ ë¬´ì–¸ê°€ ë§ì€ ë©”ì„¸ì§€ê°€ ë°˜í™˜ì´ ëœë‹¤.

```
"message": "Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.in28minutes.rest.webservices_06.restful_web_services.user.User> com.in28minutes.rest.webservices_06.restful_web_services.user.UserResource.createUser(com.in28minutes.rest.webservices_06.restful_web_services.user.User) with 2 errors: [Field error in object 'user' on field 'name': rejected value []; codes [Size.user.name,Size.name,Size.java.lang.String,Size]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [user.name,name]; arguments []; default message [name],2147483647,2]; default message [í¬ê¸°ê°€ 2ì—ì„œ 2147483647 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤]] [Field error in object 'user' on field 'birthDate': rejected value [2034-03-20]; codes [Past.user.birthDate,Past.birthDate,Past.java.time.LocalDate,Past]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [user.birthDate,birthDate]; arguments []; default message [birthDate]]; default message [ê³¼ê±° ë‚ ì§œì—¬ì•¼ í•©ë‹ˆë‹¤]] ",
```

ì—ëŸ¬ê°€ 2ê°œ ìˆëŠ”ë°, í¬ê¸°ê°€ 2ë³´ë‹¤ëŠ” ì»¤ì•¼ í•˜ê³ , ê³¼ê±° ë‚ ì§œì—¬ì•¼ í•œë‹¤ê³  í•œë‹¤.
ì†Œë¹„ìëŠ” ì´ëŸ° ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ë³´ê³  ìš”ì²­ì— ì–´ë–¤ ë¬¸ì œê°€ ìˆëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

#### ë„ˆë¬´ ë§ì€ ì–‘ì˜ ì •ë³´

ë˜ ë„ˆë¬´ ë§ì€ ì–‘ì˜ ì •ë³´ë¥¼ ì†Œë¹„ìì—ê²Œ ì „ë‹¬í•˜ëŠ” ê²ƒ ê°™ì•„ì„œ. `User.java` ë¡œ ê°€ì„œ ê´€ë ¨í•´ì„œ ì „ë‹¬í•  ë©”ì„¸ì§€ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```java

	@Size(min=2, message="Name should have atleast 2 characters")
	private String name;

	@Past(message="Birth Date should be in the past")
	private LocalDate birthDate;

```

ì´ë ‡ê²Œ ë„£ì–´ì£¼ë©´ ëœë‹¤.
ê·¸ë ‡ê²Œ ë˜ë©´ ë‚´ê°€ ì»¤ìŠ¤í…€í•œ ë©”ì„¸ì§€ë¡œ ë‚˜ì˜¤ê²Œ í•  ìˆ˜ ìˆë‹¤.

#### ì „ë‹¬ëœ ì—ëŸ¬

ì „ë‹¬ëœ ì—ëŸ¬ë¥¼ ì‚´í´ë³´ë©´ ì—¬ëŸ¬ ì •ë³´ê°€ ì¡°íšŒ ê°€ëŠ¥í•œë°, ì—ëŸ¬ê°€ ë°œìƒí•œ í•„ë“œë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.;
`getFieldError()` ë¥¼ í˜¸ì¶œí•´ë³´ì.
í•„ë“œì™€ ê´€ë ¨ëœ ì²« ë²ˆì§¸ ì—ëŸ¬ë¥¼ ì¡°íšŒí•˜ë ¤ë©´ `getFieldError()` ë¥¼ í˜¸ì¶œí•œ ë‹¤ìŒ `getDefaultMessage()` ë¥¼ í˜¸ì¶œí•´ì£¼ê³  ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ë©´ ëœë‹¤.

ex.getMessage()ë¥¼ ë„£ì–´ì£¼ë˜ ìë¦¬ì—ë‹¤ê°€ ë„£ì–´ì£¼ë©´ ë¨.
ê·¸ë ‡ê²Œ í•˜ë©´ ì§§ì•„ì§€ê²Œ ë˜ê³  , ì²« ë²ˆì§¸ ì—ëŸ¬ë§Œ ë°˜í™˜í•œë‹¤.

<img width="993" alt="Image" src="https://github.com/user-attachments/assets/ac7beb76-5930-4d3e-a691-1c6339f6e64f" />

> ì—¬ê¸°ì„œ ë§Œì•½ `ëª¨ë“  ì—ëŸ¬ ë©”ì„¸ì§€` ë¥¼ ë‹¤ ì¶œë ¥ë˜ê²Œ í•˜ë ¤ë©´ ë°˜ë³µë¬¸ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì—ëŸ¬ í•˜ë‚˜ê°€ ì•„ë‹Œ ì „ë¶€ë¥¼ ëŒ€ìƒìœ¼ë¡œ `getFieldErros()` ë¥¼ í˜¸ì¶œí•˜ê³  ë°˜ë³µë¬¸ìœ¼ë¡œ ëŒë©´ì„œ ë©”ì œì‹œ ë¬¸ìì—´ì— ì¶”ê°€í•˜ë©´ ëœë‹¤.

ì—ëŸ¬ ê°œìˆ˜ë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì€ `ex.getErrorCount()` ë¡œ ê°€ëŠ¥í•˜ë‹¤.

```java
@Override
	protected ResponseEntity<Object> handleMethodArgumentNotValid(
			MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatusCode status, WebRequest request) {

		ErrorDetails errorDetails = new ErrorDetails(LocalDateTime.now(),"Total Erros Count : " + ex.getErrorCount() + "! First Error: " + ex.getFieldError().getDefaultMessage(), request.getDescription(false));


		return new ResponseEntity(errorDetails, HttpStatus.BAD_REQUEST);

	}
```

ìµœì¢…ìœ¼ë¡œ êµ¬í˜„ëœ ì½”ë“œë¥¼ ì‚´í´ë³´ê²Œë˜ë©´ ëª‡ê°œì˜ ì—ëŸ¬ì¹´ìš´íŠ¸ê°€ ìˆëŠ”ì§€ ë³´ì—¬ì£¼ê³ , ì²« ë²ˆì§¸ ì—ëŸ¬ë©”ì„¸ì§€ë§Œ ì „ë‹¬ì‹œì¼œì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
