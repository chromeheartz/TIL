## Spring AOP

### 03. AOP 로깅 애스팩트와 포인트컷 만들기

---

### 📌 AOP 로깅 애스팩트 / 포인트컷

일단 `build.gradle` 에 필요한 의존성을 추가해보자
`Spring AOP / AspectJ` 를 임포트

```
implementation 'org.springframework.boot:spring-boot-starter-aop'
```

`refresh gradle` 을 해주면 추가가 된다.

이제 실제로 AOP 코드 작업을 시작.

#### AOP 코드작업에서 무엇을 해야 하는가?

![](https://velog.velcdn.com/images/bibiboy/post/9e4bbf17-8782-4caf-ae53-e8d48d0eedf3/image.png)

지금까지는 `비즈니스 / 데이터` 총 2개의 레이어를 만들었는데, 이젠 공통된 코드로 `애스팩트` 로 작성할 차례이다.

일단 `로그를 출력하는 애스팩트` 를 만들어보자.
비즈니스 레이어와 데이터레이어에 있는 빈에 포함되는 모든 메소드의 로그를 출력할것이다.

`new class` 로 `LoggingAspect` 패키지는 `aspects` 로 만든다.
먼저 이 클래스가 설정 클래스인걸 명시해야 한다. `AOP 설정` 의

> ✅ 또한 로직을 구현할 메소드를 정의해야한다. 메소드 호출을 로그로 출력하는 것을 만들었는데, 이 메소드가 언제 호출돼야 하는지를 정의해야 한다. 비즈니스 레이어 / 데이터 레이어 빈에서 호출되는 메소드 호출을 인터셉트해야한다. 그것을 `포인트컷` 이라는 걸로 정의해줄것이다.

먼저 `@Configuration` 을 설정해주고 나서, AOP 관련 설정이라는 것을 명시해주기 위해 `@Aspect` 어노테이션 또한 추가해준다.

`logger.info` 로 출력 메시지를 만들어준다.
이때 어떤 정보가 필요한데, 두 가지 작업이 필요하다.

#### `포인트 컷` 을 정의하는 것이고, `어떤 메소드` 를 대상으로 하는지이다.

먼저 `포인트 컷` 을 정의할때 `syntax` 를 주의해야하는데, 이 신택스는 특정 패키지에 속한 모든 클래스의 메소드를 대상으로 호출을 인터셉트 하기 위한 포인트 컷이다
`execution(* PAKAGE.*.*(..))`

일단 비즈니스 패키지에서 발생하는 모든 호출을 인터셉트해보자.
해당 패키지에서 우클릭 `Copy Qualifed Name` 을 해서 패키지 이름을 복사하고
`@Pointcut("execution(* com.in28minutes.learn_springaop_13.business.*.*(..))")`
이렇게 적용해놓고 특정메소드 실행은 `joinPoint` 를 가져와서 사용해보자.
중괄호 한쌍에 `joinPoint` 가 출력되도록 하고나서

포인트 컷을 `메소드가 호출되기 전` 에 실행시킬것이니 `@Before` 어노테이션을 사용해보자.

```java
@Configuration
@Aspect
public class LoggingAspect {

	private Logger logger = LoggerFactory.getLogger(getClass());
	// PointCut
	@Before("execution(* com.in28minutes.learn_springaop_13.business.*.*(..))")
	public void logMethodCall(JoinPoint joinPoint) {
		logger.info("Before Aspect - Method is called - {}", joinPoint);
	}
}
```

이렇게 하고 실행해보면 `2025-08-23T14:57:27.725+09:00  INFO 44567 --- [learn-springaop-13] [           main] c.i.l.a.LoggingAspect$$SpringCGLIB$$0    : Before Aspect - Method is called - execution(int com.in28minutes.learn_springaop_13.business.BusinessService1.calculateMax())
`

라고 로그가 나오는 것을 볼 수 있다. `calculateMax` 가 호출되기 전에 인터셉트가 가능하게 된것이다.
`data` 로 바꾸고 실행해보면
`2025-08-23T14:57:59.805+09:00  INFO 45055 --- [learn-springaop-13] [           main] c.i.l.a.LoggingAspect$$SpringCGLIB$$0    : Before Aspect - Method is called - execution(int[] com.in28minutes.learn_springaop_13.data.DateService1.retrieveData())
`

대상이 바뀌어서 인터셉트 한것을 볼 수 있다. 패키지 이름만 바꿔줬을 뿐인데 인터셉트하는 대상 메소드를 바꿀 수 있다.
비즈니스 패키지든 데이터 패키지든 다 인터셉트 하고싶다면 `*.*.*(..))` 이런식으로 data가 아니라 \* 으로 넣어주면 된다.
