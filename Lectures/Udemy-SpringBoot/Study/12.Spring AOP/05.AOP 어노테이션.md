## Spring AOP

### 05. AOP 어노테이션

---

### 📌 @After, @AfterReturning, @AfterThrowing

![](https://velog.velcdn.com/images/bibiboy/post/58f2cb97-9722-4c70-b902-cf1070760af6/image.png)

기존에 `@Before` 을 써서 메소드 호출전에 무언가를 하도록 했다.
메소드가 호출되기 전 로그를 출력하거나 `인증이 필요할 때 @Before` 을 사용하면 좋다.

`@After, @AfterReturning, @AfterThrowing`
이 3개의 차이점은 무엇일까?

#### @After

먼저 `@After` 는 메소드가 실행되고 난 뒤 수행할 작업을 지정한다.
메소드의 결과가 성공이든 실패든 익셉션을 던지던 상관없이.

메소드가 성공적으로 실행됐든 메소드가 익셉션을 던지던 상황이 어떻든 `메소드 실행 후에 할 작업` 을 지정할때 명시하면 된다.

#### @AfterReturning

메소드가 `성공적으로 실행됐다면` 하려는 작업을 명시한다.
📍 익셉션이 발생했을때는 수행하지 않는다.

#### @AfterThrowing

메소드가 익셉션을 던졌을때 무언가를 해야할때 쓴다.
메소드가 성공적으로 값을 반환하면 이건 실행되지 않는다.

#### 사용

```java
// LoggingAspect
@After("execution(* com.in28minutes.learn_springaop_13.*.*.*(..))")
	public void logMethodCallAfterExecution(JoinPoint joinPoint) {
	logger.info("After Aspect - {}", joinPoint);
}

@AfterThrowing(
		pointcut = "execution(* com.in28minutes.learn_springaop_13.*.*.*(..))",
		throwing = "exception"
)
public void logMethodCallAfterExeption(JoinPoint joinPoint, Exception exception) {
	logger.info("AfterThrowing Aspect - {}" , joinPoint, exception);
}

@AfterReturning(
		pointcut = "execution(* com.in28minutes.learn_springaop_13.*.*.*(..))",
		returning = "resultValue"
)
public void logMethodCallAfterSuccessfulExecution(JoinPoint joinPoint, Object resultValue) {
	logger.info("AfterThrowing Aspect - {}" , joinPoint, resultValue);
}


// BusinessService
public int calculateMax() {
	int[] data = dataService1.retrieveData();
	throw new RuntimeException("Something Went Wrong!");
	return Arrays.stream(data).max().orElse(0);
}
```

기존에 사용하던 비즈니스 서비스에서 `런타임 익셉션` 을 던져보게 해놓으면, 실행을 완료하지 못하게 된다.

이렇게하고 실행하면 익셉션이 나오게 된다.
`@After` 를 사용했기 때문에 익셉션이 발생해도 실행이 되는것을 볼 수 있다.

`@AfterThrowing` 을 사용할때는 인자가 3개가 있는데, 포인트컷을 추가해주고, 쉽표를 구분자로해서 `throwing` 을 넣어 발생할 익셉션을 바인드시킬 어드바이스 시그니처의 인자 이름을 넣어주면 된다.

해당 익셉션이 발생할때 인터셉트되고 해당 익셉션은 이 이름으로 매핑이 된다.

`2025-08-24T11:54:07.170+09:00  INFO 12456 --- [learn-springaop-13] [           main] c.i.l.a.LoggingAspect$$SpringCGLIB$$0    : After Aspect - execution(int com.in28minutes.learn_springaop_13.business.BusinessService1.calculateMax())
`

실행해보면 정보를 볼 수 있게 된다.
익셉션을 던졌다는 정보를 알 수 있고, 그 이후에 상세 정보가 출력돼 있다.
이 부분은 익셉션이 발생했을 때만 실행된다.

`@AfterReturning` 을 사용할때의 인자는, `returning` 으로 넣어주고 반환값을 바인드 해 줄 어드바이스 시그니처의 인자 이름이다.

실행해보면 `2025-08-24T11:57:57.997+09:00  INFO 16050 --- [learn-springaop-13] [           main] c.i.l.LearnSpringaop13Application        : Value returned is 44
`

resultValue를 통해 출력된 값을 볼 수 있다.

> ✅
> `@After` - 실행 후에 뭔가를 할 수 있게 해준다. 성공하던 실패하던
> `@AfterThrowing` - 메소드가 익셉션을 던졌을때만 할 수 있게 해준다.
> `@AfterReturning` - 메소드가 성공했을때만 할 수 있게 해준다.
