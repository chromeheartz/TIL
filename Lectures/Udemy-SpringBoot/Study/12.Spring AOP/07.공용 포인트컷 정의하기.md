## Spring AOP

### 07. κ³µμ© ν¬μΈνΈμ»· μ •μν•κΈ°

---

### π“ κ³µμ© ν¬μΈνΈμ»·

λ§μ•½ ν¨ν‚¤μ§€ μ΄λ¦„μ„ λ°”κΎΈλ©΄ μ–΄λ–»κ² λ κΉ? μ§€κΈ λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤ , λ°μ΄ν„° μ„λΉ„μ¤μ ν¨ν‚¤μ§€ μ΄λ¦„μ΄ λ°”λ€λ‹¤κ³  ν•λ©΄ μ •μν•΄λ‘” ν¬μΈνΈμ»·μ„ λ‹¤ λ°”κΏ”μ•Όν•λ” μƒν™©μ΄ μƒκΈΈκ²ƒμ΄λ‹¤.
μμ •μ‘μ—…μ„ μ—¬λ¬ κ³³μ— ν•΄μ¤μ•Ό ν•λ”λ°, μ΄κ±Έ ν”Όν•  μ μλ” λ°©λ²•μ΄ μμ„κΉ?

`CommonPointcutConfig` λΌλ” ν΄λμ¤λ¥Ό `aspects` ν¨ν‚¤μ§€ μ•μ— λ§λ“¤μ–΄μ„ κ³µν†µμΌλ΅ μ‚¬μ©ν•΄λ³΄μ.`businessPackageConfig` λΌλ” λ©”μ†λ“λ¥Ό λΉ λ©”μ†λ“λ΅ λ§λ“¤μ–΄μ„ μ‚¬μ©ν• κ²ƒμΈλ° μ—¬κΈ°μ— `Pointcut` μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ—¬λ†“κ³ , κΈ°μ΅΄μ— μ‚¬μ©ν•λ μΈμλ¥Ό λ„£μ–΄μ¤€λ‹¤.

```java
@Pointcut("execution(* com.in28minutes.learn_springaop_13.*.*.*(..))")
	public void businesAndDataPackageConfig() {}

// κΈ°μ΅΄μ— μ‚¬μ©ν•λ ν¬μΈνΈμ»·
@Before("com.in28minutes.learn_springaop_13.aspects.CommonPointcutConfig.businesAndDataPackageConfig()")
	public void logMethodCallBeforeExecution(JoinPoint joinPoint) {
		logger.info("Before Aspect - {} is called with arguments: {}", joinPoint, joinPoint.getArgs());
	}
```

μ΄λ ‡κ² λ§λ“¤κ³  λ‚μ„ λ©”μ†λ“ μ°ν΄λ¦­ `Copy Qualified Name` μ„ μ„ νƒν• ν›„μ— κΈ°μ΅΄μ— μ‚¬μ©ν–λ ν¬μΈνΈμ»·μ— λ¶™μ—¬λ„£μ–΄λ³΄μ. μ•„μ£Ό κΈ΄ μ΄λ¦„μ΄ λ“¤μ–΄κ°€λ”λ°, μ΄ μ‘μ—…μ€ ν¬μΈνΈμ»·μ— μ΄λ¦„μ„ λ¶€μ—¬ν• μ‘μ—…μ΄λ‹¤.
`businessPackageConfig` κ°€ μ΄λ¦„μΈλ°, μ΄ μ΄λ¦„μ΄ λ§¤ν•‘λλ”κ²ƒμ€ λ°”λ΅ ν¬μΈνΈμ»· κ°’μ΄λ‹¤.

μ΄λ ‡κ²ν•κ³  μ‹¤ν–‰ν•΄λ³΄λ©΄ κ²°κ³Όμ μΌλ΅ λ°”λ€μ§€λ” μ•μ•λ‹¤.

#### μ™ μ΄λ ‡κ² ν•λ”κ²ƒμ΄ μΆ‹μ„κΉ?

μ΄λ ‡κ²ν•λ©΄ λ‚μ¤‘μ— λΉ„μ¦λ‹μ¤λ“  λ°μ΄ν„°λ“  ν¨ν‚¤μ§€ μ΄λ¦„μ„ λ°”κΎΈλ©΄, λ°”κΎΌ μ΄λ¦„λ§ μ μ©ν•΄μ£Όλ©΄ λλ‹¤λ”κ²ƒμ΄λ‹¤.
λ‹¤λ¥Έ ν΄λμ¤μ— μ‘μ—…μ„ ν•΄μ¤„ ν•„μ”κ°€ μ—†λ‹¤.

```java
public class CommonPointcutConfig {

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.*.*.*(..))")
	public void businesAndDataPackageConfig() {}

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.business.*.*(..))")
	public void businesPackageConfig() {}

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.data.*.*(..))")
	public void allPackageConfigUsingBean() {}
}

```

μ΄λ ‡κ² λ‚λ μ„ ν•„μ”ν• ν¨ν‚¤μ§€μ—μ„λ§ μ μ©ν•΄λ†“μ„ μλ„ μλ‹¤.

### π“ bean μ§€μ‹μ

ν¬μΈνΈμ»· μ„¤μ •μ„ μΆ€ λ” κ°„λ‹¨ν•κ² ν•  μ μλ” λ°©λ²•μ€ `bean μ§€μ‹μ` λ¥Ό μ΄μ©ν•λ” κ²ƒμ΄λ‹¤.
λ‘κ°™μ΄ λΉ λ©”μ†λ“λ¥Ό λ§λ“λ”λ° μ–΄λ…Έν…μ΄μ…μ„ `@Pointcut("bean(*Service*")` μ΄λ°λ°©μ‹μΌλ΅ λ³„ν‘ λ‘κ°λ¥Ό λ„£κ³  κ·Έ μ‚¬μ΄μ— μ„λΉ„μ¤λ¥Ό λ…μ‹ν•λ©΄ λλ‹¤.

> β… `Service` λΌλ” λ‹¨μ–΄κ°€ ν¬ν•¨λ λΉμ΄λΌλ©΄ μΈν„°μ…‰νΈ λ€μƒμ΄ λλ‹¤.
> `DataService / BusinessService` μ΄λ“ μ§€ μ΄λ¦„μ— λ“¤μ–΄κ°„ κ²ƒμ΄ λ€μƒμ΄ λλ‹¤.

```
// CommonPointCutConfig
package com.in28minutes.learn_springaop_13.aspects;

import org.aspectj.lang.annotation.Pointcut;

public class CommonPointcutConfig {

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.*.*.*(..))")
	public void businesAndDataPackageConfig() {}

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.business.*.*(..))")
	public void businesPackageConfig() {}

	@Pointcut("execution(* com.in28minutes.learn_springaop_13.data.*.*(..))")
	public void dataPackageConfig() {}

	@Pointcut("bean(*Service*")
	public void allPackageConfigUsingBean() {}
}


// LoggingAspect
package com.in28minutes.learn_springaop_13.aspects;

import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.After;
import org.aspectj.lang.annotation.AfterReturning;
import org.aspectj.lang.annotation.AfterThrowing;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Configuration;

//AOP Configuration
@Configuration
@Aspect
public class LoggingAspect {

	private Logger logger = LoggerFactory.getLogger(getClass());
	// PointCut
	@Before("com.in28minutes.learn_springaop_13.aspects.CommonPointcutConfig.allPackageConfigUsingBean()")
	public void logMethodCallBeforeExecution(JoinPoint joinPoint) {
		logger.info("Before Aspect - {} is called with arguments: {}", joinPoint, joinPoint.getArgs());
	}

	@After("com.in28minutes.learn_springaop_13.aspects.CommonPointcutConfig.businesPackageConfig()")
	public void logMethodCallAfterExecution(JoinPoint joinPoint) {
		logger.info("After Aspect - {}", joinPoint);
	}

	@AfterThrowing(
			pointcut = "com.in28minutes.learn_springaop_13.aspects.CommonPointcutConfig.businesAndDataPackageConfig()",
			throwing = "exception"
	)
	public void logMethodCallAfterExeption(JoinPoint joinPoint, Exception exception) {
		logger.info("AfterThrowing Aspect - {}" , joinPoint, exception);
	}

	@AfterReturning(
			pointcut = "com.in28minutes.learn_springaop_13.aspects.CommonPointcutConfig.dataPackageConfig()",
			returning = "resultValue"
	)
	public void logMethodCallAfterSuccessfulExecution(JoinPoint joinPoint, Object resultValue) {
		logger.info("AfterThrowing Aspect - {}" , joinPoint, resultValue);
	}
}
```

> β… ν¬μΈνΈμ»· μ„¤μ •μ„ κ°„λµν™”ν•  μ μλ” λ°©λ²•μ€ ν¬μΈνΈμ»· μ •μλ¥Ό κ³µλ™ νμΌμ— ν•λ” κ²ƒμ΄λ‹¤.
> λ ν•λ‚λ” `execution` μ§€μ‹μ λ€μ‹  `bean` μ§€μ‹μλ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ μλ‹¤.
> `bean` μ§€μ‹μλ¥Ό μ‚¬μ©ν•κ² λλ©΄ ν•΄λ‹Ή λΉμ μ΄λ¦„μ„ κΈ°μ¤€μΌλ΅ μΈν„°μ…‰νΈ λ€μƒμ„ μ§€μ •ν•  μ μλ‹¤.
