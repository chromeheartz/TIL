## Spring AOP

### 06. Timer ν΄λμ¤ / Around AOP μ–΄λ…Έν…μ΄μ…

---

### π“ @Around

`@Around` λ” λ©”μ†λ“ `μ‹¤ν–‰ μ „ κ³Ό ν›„` μ— λ¬΄μ–Έκ°€λ¥Ό ν•λ‹¤.
μ¦‰, λ©”μ†λ“ μ‹¤ν–‰ μ£Όλ³€μ— λ¬΄μ–Έκ°€λ¥Ό ν•λ”κ²ƒμ΄λ‹¤.
Aspectsμ— μƒλ΅μ΄ ν΄λμ¤λ¥Ό ν•λ‚ μƒμ„±ν•΄μ„ ν™•μΈν•΄λ³΄μ.`PerformanceTrackingAspect` λΌλ” μ΄λ¦„μΌλ΅ μ§€μ–΄μ„ λ©”μ†λ“κ°€ μ‹¤ν–‰λ μ‹κ°„μ„ μ•μ•„λ³΄μ.

κ·ΈλΌ λ¨Όμ € νƒ€μ΄λ¨Έλ¥Ό μ‹μ‘ν•κ³  λ©”μ†λ“λ¥Ό μ‹¤ν–‰μ‹ν‚¤κ³  νƒ€μ΄λ¨Έλ¥Ό λ©μ¶”κ² ν•¨μΌλ΅μ¨ λ©”μ†λ“λ¥Ό μ‹¤ν–‰ν•λ”λ° μ–Όλ§λ‚ κ±Έλ Έλ”μ§€ μ• μ μλ‹¤.

κ·Έλμ„ `@Around` μ–΄λ“λ°”μ΄μ¤λ¥Ό μ¶”κ°€ν•΄μ¤€λ‹¤.
ν¬μΈνΈμ»·μΌλ΅ `μΈν„°μ…‰νΈν•  λ€μƒ` μ„ λ…μ‹ν•΄μ¤„κ²ƒμΈλ°, μ΄μ „μ— μΌλ κ°’μ„ κ·Έλ€λ΅ μ¨λ³΄μ.
μ΄ν›„μ— ν΄λμ¤λ¥Ό `@Aspect` λ΅ λ§λ“¤μ–΄μ£Όκ³ , `@Configurration` μ„ μ¶”κ°€ν•΄μ¤€λ‹¤.

λ©”μ†λ“ μ•μ—λ” νƒ€μ΄λ¨Έλ¥Ό κµ¬ν„ν•κΈ° μ„ν•΄ `System.currentTimeMillis` λ¥Ό μ‚¬μ©ν•λ‹¤.
μ‹μ‘μ‹κ°„κ³Ό λμ‹κ°„μ„ κ°€μ Έμ¤κ³  λμ‹κ°„μ—μ„ μ‹μ‘μ‹κ°„μ„ λΉΌλ©΄ μ–Όλ§λ‚ κ±Έλ¦°μ§€ μ• μ μλ‹¤.

```java
long startTimeMillis = System.currentTimeMillis();
long endTimeMillis = System.currentTimeMillis();
long executionDuration = endTimeMillis - startTimeMillis;
```

`logger.info("Around Aspect - {} Method executed in {} ms", ,executionDuration);`

μ—¬κΈ°μ„ μƒκ°ν•΄λ³΄μ•„μ•Όν• κ²ƒμ΄ 2λ²μ§Έ μΈμμ—μ„ κΈ°μ΅΄μ—λ” `joinPoint` λ¥Ό μ‚¬μ©ν–μ—λ‹¤.
κ·Έλ°λ° μ΅°μΈν¬μΈνΈλ” λ©”μ†λ“λ¥Ό μ‹¤ν–‰μ‹μΌμ£Όμ§€ μ•μ•„μ„ μ΅°μΈν¬μΈνΈ λ€μ‹  `ProceedingJoinPoint` λ¥Ό μ¨μ•Ό ν•λ‹¤.

`proceed` λ€ λ©”μ†λ“λ¥Ό μ κ³µν•΄ `AspectJ` μ• μ¤ν©νΈμ¤‘ Aroundμ• μ¤ν©νΈλ¥Ό μ§€μ›ν•λ‹¤. κ²°κµ­ `ProceedingJoinPoint` κ±΄ κ²°κµ­ λ©”μ†λ“λ¥Ό μ‹¤ν–‰μ‹μΌμ£Όλ” κ²ƒμ΄λ‹¤.
`proceed` λ¥Ό νΈμ¶ν•΄ λ€μƒ λ©”μ†λ“λ¥Ό μ‹¤ν–‰μ‹ν‚¬ μ μλ‹¤.

```java
@Aspect
@Configuration
public class PerformanceTrackingAspect {
	private Logger logger = LoggerFactory.getLogger(getClass());

	@Around("execution(* com.in28minutes.learn_springaop_13.*.*.*(..))")
	public Object findExecutionTime(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
		long startTimeMillis = System.currentTimeMillis();

		Object returnValue = proceedingJoinPoint.proceed();

		long endTimeMillis = System.currentTimeMillis();

		long executionDuration = endTimeMillis - startTimeMillis;

		logger.info("Around Aspect - {} Method executed in {} ms", proceedingJoinPoint ,executionDuration);
		return returnValue;
	}
}


// κ²°κ³Ό
2025-08-24T15:48:43.204+09:00  INFO 59287 --- [learn-springaop-13] [           main] erformanceTrackingAspect$$SpringCGLIB$$0 : Around Aspect - execution(int[] com.in28minutes.learn_springaop_13.data.DateService1.retrieveData()) Method executed in 0 ms
2025-08-24T15:48:43.205+09:00  INFO 59287 --- [learn-springaop-13] [           main] erformanceTrackingAspect$$SpringCGLIB$$0 : Around Aspect - execution(int com.in28minutes.learn_springaop_13.business.BusinessService1.calculateMax()) Method executed in 1 ms
```

μ΄λ ‡κ² μ‹κ°„μ„ λ³Ό μ μλ‹¤. `BusinessService1` λ΅ κ°€μ„ μ‹κ°„μ΄ κ±Έλ¦¬κ² ν•  μλ„ μλ‹¤.
`Thread.sleep` μ„ νΈμ¶ν•΄μ£Όκ³  `try-catch` λ¬Έμ„ μ‚½μ…ν•΄μ£Όλ©΄ λλ‹¤.

```java
	public int calculateMax() {
		int[] data = dataService1.retrieveData();
//		throw new RuntimeException("Something Went Wrong!");

		try {
			Thread.sleep(30);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		return Arrays.stream(data).max().orElse(0);
	}

// κ²°κ³Ό
2025-08-24T15:51:40.112+09:00  INFO 61733 --- [learn-springaop-13] [           main] erformanceTrackingAspect$$SpringCGLIB$$0 : Around Aspect - execution(int com.in28minutes.learn_springaop_13.business.BusinessService1.calculateMax()) Method executed in 37 ms
```

μ•„κΉλ³΄λ‹¨ μ‹¤ν–‰μ‹κ°„μ΄ μ΅°κΈ λ” ν¬κ² λ‚μ™”λ‹¤.
`dataService` μ½μ—λ„ μ¶”κ°€μ‹μΌμ¤„ μ μλ‹¤.
μ΄μ  κµ¬ν„ν• λ΅μ§μ΄ κ³µν†µμ μΌλ΅ μ μ©λκ³  μλ‹¤. `BusinessService2` λ¥Ό λ§λ“¤μ–΄μ„ `max` κ°€ μ•„λ‹ `min` μΌλ΅ μµμ†κ°’μ„ κµ¬ν•΄λ³΄μ. μ—¬κΈ°μ„ μ‚¬μ©ν•λ” λ°μ΄ν„°λ” `DataService2` λ΅ λ§λ“¤μ–΄μ„ λ‹¤λ¥Έ λ°°μ—΄μ„ λ§λ“¤μ–΄μ„ νΈμ¶ν•΄λ³΄μ.

λ¬Όλ΅  κ°κ° ν•„μ”ν• `μƒμ„±μ μ£Όμ…` λ“¤μ€ λ‹¤ ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.
μ΄λ ‡κ² ν•λ©΄ λ΅κ·Έμ— λ‹¤ λ‚μ¤λ” κ²ƒμ„ λ³Ό μ μλ‹¤.

> β… μ§€κΈκΉμ§€ ν–λ μ–΄λ…Έν…μ΄μ…λ“¤μ€ ν•΄λ‹Ή ν¨ν‚¤μ§€μ— μ†ν• ν΄λμ¤λΌλ©΄ λ‹¤ μ μ©ν•  μ μλ‹¤.
> ν•λ² μ“΄ μ½”λ“λ¥Ό νΉμ • ν¨ν‚¤μ§€ μ•μ— μλ” μ—¬λ¬ κ° ν΄λμ¤μ—μ„ μ μ©ν•  μ μλ”κ²ƒμΈλ°, `AOP` λΌμ„ κ°€λ¥ν•κ²ƒμ΄λ‹¤. μ–΄λ“λ°”μ΄μ¤λ” ν•λ‚ λ§λ“¤μ–΄μ„ λ‹¤μ–‘ν• μ—¬λ¬ λ μ΄μ–΄μ— λ‹¤ μ μ©μ‹ν‚¬ μ μλ‹¤.
