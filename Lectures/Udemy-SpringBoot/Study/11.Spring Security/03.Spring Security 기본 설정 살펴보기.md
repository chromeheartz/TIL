## Spring Security

### 03. Spring Security 기본 설정 살펴보기

---

### 📌 Spring Security 시작하기

보안은 현재 기업에서 가장 중요한 과제이다. 그리고 Spring 생태계에서 `Spring Security` 는 가장 인기 있는 보안 프로젝트이다.
처음 사용할 때는 매우 어려울 수 있다.
`필터 체인 / 인증 관리자 / 인증 제공자 / JWT` 같은 여러 개념이 있는데, 이런 다양한 개념을 이해해야 사용할 수 있다. 하지만 `Spring Security` 는 커스터마이즈가 가능한 유연한 보안 시스템을 제공한다.

프로젝트에 사용 설정을하면 모든 것이 보호되고 `filter chain` 을 통해 적절한 인증과 권한 부여가 적용 된다.

#### Spring MVC의 작동방식

그 전에 `Spring MVC` 의 작동 방식을 살펴보자.
Spring으로 웹 애플리케이션이나 REST API를 빌드할 때 백그라운드에서 사용하게 되는데, 요청이 들어오면 먼저 `Dispatcher Servlet` 에서 처리한다.

디스패처 서블릿은 `URL / 요청 메소드` 를 확인한 후 요청을 적절한 컨트롤러로 라우팅한다.
즉, `front controller` 역할을 하게 되는 것이다.
모든 요청을 인터셉트한다.

#### 그렇다면 Spring Security는 어떻게 작동할까?

`Spring Security` 는 이 체계에 또 다른 레이어로 추가된다.
들어오는 모든 요청을 `Spring Security` 가 필터 체인을 설정해서 이 필터 체인으로 인터셉트한다. 그리고 인증과 권한 부여를 확인하고 나면 요청이 디스패처 서블릿으로 전송되고 그 다음 단계인 컨트롤러까지 처리가 된다.

> 결국 `Spring Security` 를 사용하게 되면 모든 요청은 `Spring Security Filter Chain` 을 통해 인터셉트된 후 인증과 권한 부여를 위한 확인을 받는다.

### 📌 Spring Security 기본 설정 살펴보기

`Filter Chain` 은 다양한 기능을 제공한다.
기본적인 기능은 인증인데, 적절한 사용자인지 확인하는 것이다.

Spring Security가 지원하는 인증 메커니즘에는 여러 가지가 있는데, 관련된 필터로 인증을 제공하고, 권한을 부여한다.

사용자가 적절한 액세스 권한을 보유했는지 확인하는 것인데, `AuthorizationFilter` 가 그 예가 된다.
또한, 보안과 관련된 베스트 프렉티스를 제공하는데, 한 가지 예로 `CORS` 즉, 오리진 간 리소스 공유를 설정할 수 있다.

📍 풀 스택 애플리케이션을 빌드하는 경우 한 도메인에는 `FE` 다른 도메인에는 `BE REST API` 를 배포할 텐데, 이 때 브라우저에서 실행되는 `FE` 로 부터 호출을 받는다. 이것을 설정하는 방법이 `CORS`

📍 `CSRF` 이는 사이트 간 요청 위조이다.
사용자가 웹 사이트에 로그인하면 사용자 세션이 생성되는데, 이 세션은 쿠키를 사용해 식별된다.
사용자가 이 웹사이트에서 로그아웃 하지 않은 채 악성 웹사이트로 이동하면, 해당 웹사이트에서는 이전 인증정보 `쿠키` 를 이용할 수 있는데 이러한 취약성을 `CSRF / 사이트 간 요청 위조` 라고 한다.

Spring Security를 사용하면 `CSRF` 보호가 자동으로 설정된다.

#### 필터의 실행 순서

`Spring Security` 는 특정 애플리케이션에 액세스 할 때마다 다양한 기능의 필터를 실행하는데, 중요한 것은 이러한 필터가 특정한 순서대로 실행된다는 점이다.
필터의 실행 순서는 매우 중요하다.

> - 첫 번째로 확인해야 할 필터는 기본 필터인 `CORS / CSRF` 이다.

- 이 후 인증을 거치고 적절한 자격증명을 보유 했는지 확인
- 권한 부여 필터를 통해 해당 리소스에 적절한 작업을 수행할 권한이 있는지 확인
