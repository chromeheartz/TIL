## Spring Security

### 15. JWT로 인증설정하기 - 1

---

### 📌 JWT의 보안 설정

`Spring Boot` 의 `OAuth2` 리소스 서버를 이용해서 `JWT 설정` 을 적용해볼것이다.
`JWT` 인증을 적용하기 위해서는 많은 단계를 거쳐야 한다.
`키 쌍` 을 만들고 `RSA 키 객체` 를 만들고, 이후에 `JWKSource (JSON Web Key)` 소스를 만들어야 하고, `디코딩 / 인코딩` 을 설정해야 한다.

읻단 `build.gradle` 로 가서 `OAuth2 리소스 서버` 를 설정해보려고 한다.
`implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'`

이렇게 `REST API` 를 노출시킬것이고, 인증과 승인에 `JWT` 를 사용한다.
의존성을 다운로드 시켜주고 앱을 재시작해보자.
`BasicAuthSecurityConfiguration` 을 사용했는데, 기본인증에 관련된 모든 설정이 이 클래스 안에 있다. `JWT` 용으로 그것과 비슷한 클래스를 만들어보자.

복붙해서 `JwtSecurityConfiguration` 이름으로 만들어보고 오류부터 수정하자.
일단 기존에 사용했던 `Basic` 에서 `@Configuration` 어노테이션을 주석으로 해보면 모든 설정은 새로 만든 `Config` 로 넘어가게 된다.

일단 패키지를 `basic -> jwt` 로 옮겨주고 새로고침.
`JWT` 의 기본인증을 위한 시작 설정은 대부분 똑같다. 주석들만 지워주면 된다.

이제 `OAuth2 리소스 서버` 를 활성화할것인데, `OAuth2ResourceServerConfigurer` 를 검색해보자.
해당 파일에 주석에 적힌 것처럼 기본값으로 `BearerTokenAuthenticationFilter` 를 연결해준다.

앞서 언급한대로 `JWT` 는 요청 헤더의 일부로서 전송될것이고, `Bearer 토큰` 형태로 전송된다.

#### 그럼 리소스 서버는 뭘 해야할까?

리소스 서버는 토큰을 받아서 그걸 디코딩하고 인증과 승인을 적절히 수행하는 역할을 한다.
그 안에 `jwt()` 라는 메소드가 있는데 이걸 사용해서 `OAuth 서버 설정` 을 할 수 있다.

`http.oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt)`

`Config` 안에 이런식으로 생성을 해주면 된다.
이렇게 하고 실행을 해보면 오류가 나는 것을 볼 수 있다.

```
Method securityFilterChain in com.in28minutes.learn_spring_security_11.jwt.JwtSecurityConfiguration required a bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' that could not be found.

Consider defining a bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' in your configuration.
```

`JwtSecurityConfiguration` 에 있는 `SecurityFilterChain` 메소드가 `JwtDecoder` 타입의 `Bean` 을 요구했는데 그것을 찾을 수 없다는 뜻이다.

리소스 서버를 설정하고 있는데, 이 리소스 서버가 `JWT 토큰` 을 받으면, 그것을 디코딩하기 위한 `JwtDecoder` 가 필요하다.
결론적으로 `JwtDecoder` 를 정의해야한다.

`디코더` 를 만들려면 많은 단계를 거쳐야 하기 때문에 이후에 진행해보자.
