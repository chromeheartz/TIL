## Spring Security

### 14. JWT 인증 시작하기

---

### 📌 JWT

![](https://velog.velcdn.com/images/bibiboy/post/0a2c101e-28c5-4354-96a5-1a90e9c0f3e9/image.png)

`JOT / JWT` 에 대해 알아보자.

기본 인증의 경우에는 기본 인증 헤더에 만료 기한이 없고, 사용자에 관련된 세부정보도 전혀 없다.
사용자에게 어떤 권한이 있는지 또한 알 수 없다. 또한 아주 쉽게 디코딩 할 수 있고, `보안 결함` 이 있을 수 있다는 문제가 있다.

이런 때에 `JWT(Json Web Token)` 을 이용해야 한다.
이는 안전하게 클레임을 표시하기 위한 공개 산업 표준이다.
`JWT` 에는 사용자 세부정보 / 인증을 모두 담을 수 있다.

#### 어떤 세부정보를 담을 수 있을까?

![](https://velog.velcdn.com/images/bibiboy/post/734ccf96-3513-43a4-b72c-776e3fef0174/image.png)

`헤더` 를 담을 수 있고, `토큰의 타입 / 알고리즘` 즉, 사용된 해싱 알고리즘을 담을 수 있고, `payload` 또한 담을 수 있다.

- 토큰의 발행자가 누군인지를 나타내는 `iss`
- 토큰의 주제를 나타내는 `sub`
- 사용 대상을 나타내는 `aud`
- 토큰의 만료 날짜를 나타내는 `exp`
- 토큰이 발행된 시간을 나타내는 `iat`
  등등 표준 속성들이 있다.

자신만의 사용자 지정 속성을 추가할 수도 있다.
또한 JWT에는 `시그니처` 도 포함되어 있는데, `Base64` 로 인코딩된 헤더의 값, 그리고 `Base64` 로 인코딩된 페이로드의 값, 그리고 숨겨야할 것들이 조합되어 있다.

`jwt.io` 에서 `JWT` 를 `디코드, 검증, 생성` 할 수 있다.
`JWT` 에서 우리는 키를 이용하여 `암호화 / 복호화` 를 할 수 있다.

#### 암호화

여기서 말하는 암호화에는 `두 가지 타입` 이 있다.

- `대칭 키 암호화` : 동일한 키를 이용하여 `암호화 / 복호화`
  즉, 암호화 알고리즘, 복호화 알고리즘 모두에서 `동일한 데이터 암호화 키` 를 사용한다.

여기서 `대칭 키 암호화` 를 사용할 때 중요한 점은, `올바른 알고리즘` 을 선택해야 한다는 점이다.
그 다음으로는 키를 안전하게 보관해야 한다. 타인이 액세스하면 안되기 때문에.
또한 암호화키를 `공유` 하는 방법이 중요하다.

타인과 암호문을 공유한다면 데이터 암호화 키를 공유할 방법도 찾아야 한다. `대칭 키 암호화의 대안` 이 바로 `비대칭 키 암호화` 이다.

- `비대칭 키 암호화` : 서로 다른 키를 이용하여 `암호화 / 복호화`
  비대칭 키 암호화에는 두 가지 키가 있다. `공개 키 / 비밀 키` 이걸 `공개 키 암호기법` 이라고도 부른다.
  내가 `공개 키` 를 이용해서 데이터를 암호화하고 `비밀 키` 를 이용해서 복호화 할 수 있다.

공개 키는 누구에게나 공유할 수 있고, 비밀 키는 내가 보관하면 된다. `개인 키` 인 셈이다.

> 누군가가 공개 키를 이용해서 비밀 키를 알아낼 수 있지 않을까 하는데, 이런 알고리즘은 아주 강력하다. 설령 `공개 키` 가 있다고 하더라도 그에 상응하는 `비밀 키` 를 쉽게 생성할 수는 없다.
> 그리고 `JWT` 를 사용하는 경우에는 `비대칭 키` 를 사용하는 것이 정석이다.

#### JWT의 전반적인 흐름

어떤 앱이 `JWT` 를 사용하고 있다고 해보자. JWT를 생성하기 위해 다양한 세부정보를 인코딩 해야한다.
먼저 `사용자 자격증명` 을 인코딩 해야하기 때문에 `사용자 이름 / 패스워드` 가 필요하고, 사용자 데이터도 필요하고, 자격증명을 기초로 `사용자 데이터` 를 받을 수도 있다. 이걸 `페이로드` 라고 한다.

그리고 또 `키 쌍` 이 필요하다. 비대칭 키를 사용하려고 하는데, 그것을 `키 쌍` 이라고 말한다.
그래서 `RSA 키 쌍` 도 필요하다.
일단 JWT를 생성했다면 `요청 헤더의 일부` 로서 `JWT` 를 전송해야 한다.
인증 헤더의 일부로서 `Bearer 토큰 형태` 로 그것을 전송하고, 즉, `Authorization: Bearer` 라고 하고, 생성한 토큰을 전송한다.

이렇게 첫 단계는 `JWT를 생성` 하는 단계이고, 그 이후에는 `리소스에 액세스` 하기 위해 요청 헤더의 일부로서 전송하는 단계이다. 마지막으로는 `JWT가 서버에서 확인` 되는 단계이다.
서버가 그걸 받으면 디코딩 해야하고, 그것을 하기 위해 다시 `키 쌍(공개키)` 가 필요하다.
