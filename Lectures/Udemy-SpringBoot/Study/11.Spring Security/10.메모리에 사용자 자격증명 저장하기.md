## Spring Security

### 10. 메모리에 사용자 자격증명 저장하기

---

### 📌 사용자 자격증명 저장

지금까지는 `application.properties` 에서 사용자 자격증명을 설정했다.

```
spring.security.user.name=in28minutes
spring.security.user.password=dummy
```

이 설정이 백그라운드에서 사용하는 것은 `인메모리 저장소` 이다.
더 효율적으로 저장하는 방법은 뭐가 있을까?

#### 사용자 자격증명은 메모리에 저장할 수 있다.

테스트 목적으로는 좋지만 `production` 환경으로는 권장되지 않는다.
또한 `데이터베이스` 에도 저장할 수 있다. `JDBC / JPA` 를 이용해 자격증명에 액세스하고 Spring Security를 데이터베이스에 저장된 테이블과 통합하는 것이다.

많이 사용되는 다른 옵션은 `LDAP` 경량 디렉터리 액세스 프로토콜이다.
디렉터리 서비스와 인증에 사용되는 오픈 프로토콜이다.

지금까지 인메모리 설정을 사용했는데, 여기에서 문제는 `ID / PASSWORD` 를 하나만 설정할 수 있다는 것이다. 더 많이 설정해야 할 때 문제가 생긴다.

일단 여러 사용자를 생성하기 위해 `BasicAuthSecurityConfiguration` 을 열어서 `UserDetailsService` 를 설정한다.

```java
@Bean
public UserDetailsService useDetailService () {
	return new InMemoryUserDetailsManager();
}
```

이렇게 구현해놓고 `import` 로 가져오면 된다.
`UserDetailsService` 는 `core` 에 들어있고, `InMemoryUserDetailsManager` 는 `provisioning` 에 있다.

이렇게 구현해놓고 `application.properties` 에서 사용자 부분을 주석처리하고 애플리케이션을 시작해서 콘솔로 가면 제대로 시작되는 것을 볼 수 있다.

현재 요청을 보내보면 `401` 오류가 반환된다. 사용자를 모두 해제했기 때문에 사용자를 생성해야 한다.

User.withUsername으로 사용자를 지정할 수 있고, 이 코드는 빌더를 반환하기 때문에 다른 세부정보도 모두 설정할 수 있다. `.password` 로 패스워드를 지정할건데 지금은 `해시 / 암호화` 를 하지 않을 것이기 때문에 일단은 `dummy` 로 지정한다.

```java
var user = User.withUsername("bibi").password("{noop}dummy").roles("USER").build();
		var admin = User.withUsername("admin").password("{noop}dummy").roles("ADMIN").build();

		return new InMemoryUserDetailsManager(user, admin);
```

이렇게 `roles` 로 역할또한 지정할 수 있다.
여기서 조금 더 나아가면

```java
enum Roles {
	ADMIN,
    USER
}
```

이러한 형식으로 `Enum` 으로 역할을 관리하는게 좋다.
이렇게 만든것을 `InMemoryUserDetailsManager` 생성자에 전달해야 한다.

> 메모리에 세부 정보를 저장하는 것은 테스트 목적으로는 좋지만 `프로덕션` 환경에서는 권장되지 않는다.
