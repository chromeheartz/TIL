## NextJS Core (App router)

### 21. NextJS ë° í’€ìŠ¤íƒ ê¸°ëŠ¥ì„ í™œìš©í•œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

---

### ğŸ“Œ ë°ì´í„° ë¡œë”©

`NextJS` ì—ì„œ ë°ì´í„° ë¡œë”©ì„ í•˜ëŠ” ê²ƒì— ìˆì–´ì„œ ëª‡ê°€ì§€ ì„ íƒê¶Œì´ ìˆë‹¤.

`useEffect` ë¥¼ ì‚¬ìš©í•´ì„œ `fetch` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆê³ , í•˜ì§€ë§Œ ì‚¬ì‹¤ `NextJS` ì—ì„œëŠ” ì´ë¯¸ `ë°±ì—”ë“œ` ë¥¼ ê°€ì§€ê³  ìˆë‹¤.

ë°± / í”„ë¡ íŠ¸ê°€ ê²°í•©ì´ ë˜ì–´ìˆì–´ì„œ ë°±ì—”ë“œë¥¼ ë¶„ë¦¬ì‹œí‚¬ í•„ìš”ê°€ ì—†ë‹¤.
ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ `NextJS` ì—ì„œëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì„œë²„ì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸ì´ë‹¤. `useEffect` ì²˜ëŸ¼ `í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸` ê°€ ë˜ì–´ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•œ ê·¸ë ‡ë‹¤.

ëŒ€ì‹  ì»´í¬ë„ŒíŠ¸ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„œë²„ì—ì„œë§Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°”ë¡œ `ë°ì´í„°ë² ì´ìŠ¤` ë¡œ ê°ˆ ìˆ˜ ìˆë”°. ë¦¬ì•¡íŠ¸ì™€ëŠ” ë‹¤ë¥¸ êµ¬ì¡°.

#### âœ… ê²°êµ­ ì„œë²„ì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸ì´ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•˜ë‹¤.

ì¼ë‹¨ ëª‡ê°€ì§€ë¥¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ `root/lib/meals.js` ë¥¼ ë§Œë“¤ì–´ì„œ ì´ ì•ˆì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë„ë‹¬í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ í•œë‹¤.

dbì´ë¦„ì„ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ `sql()` í•¨ìˆ˜ì— ì „ë‹¬í•˜ê³  ì´ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì„œ ì‘ì—…í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

ê·¸ë ‡ê²Œ í•˜ê¸° ìœ„í•´ì„œ `getMeals`Â ë¼ëŠ” í•¨ìˆ˜ë˜í•œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
ìƒˆë¡œìš´ SQLë¬¸ì„ ì¤€ë¹„í•´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•˜ê³  ë‹¨ìˆœí•œ SQLë¬¸ì„ ì‘ì„±í•˜ëŠ”ë° `mealsí‘œì—ì„œ ëª¨ë“  ì—´ì„ select` í•œë‹¤. ì´ê²ƒì„ ì‹¤í–‰ì‹œì¼œì•¼ í•˜ëŠ”ë°
ğŸ“ `run` ë°©ì‹ì€ `ë°ì´í„°ë¥¼ ë°”ê¿€ ë•Œ ì‚¬ìš©`
ë”°ë¼ì„œ í˜„ì¬ëŠ” `All` ë°©ì‹ìœ¼ë¡œ `ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒ` ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```js
// lib/meals.js
import sql from "better-sqlite3";

const db = sql("meals.db");

export async function getMeals() {
  await new Promise((resolve) => setTimeout(resolve, 2000));
  return db.prepare("SELECT * FROM meals").all();
}
```

### ğŸ“Œ ì»´í¬ë„ŒíŠ¸ì—ì„œì˜ ì‚¬ìš©

ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `async` í‚¤ì›Œë“œë¡œ ë°”ê¾¸ì–´ì£¼ì–´ì•¼ í•œë‹¤. ì„œë²„ ì»´í¬ë„ŒíŠ¸ì´ê¸° ë•Œë¬¸ì— ê°€ëŠ¥. promiseë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•ˆì—ì„œ `await` ë˜í•œ ê°€ëŠ¥í•˜ë‹¤. ê·¸ë ‡ê²Œ í•˜ë ¤ë©´ `getMeals` ë˜í•œ `async` ë¡œ ë°”ë€Œì–´ì•¼ `promise` ê°€ ë¦¬í„´ëœë‹¤.

ì„ì˜ì˜ ì§€ì—°ì„ ìœ„í•´ setTimeoutì„ ì‚¬ìš©.
ì´í›„ì— `loading state` ë“±ì„ ë‹¤ë£° ë•Œ ë„ì›€ì´ ë ê²ƒì´ë‹¤.

```js
// meals/page.js
export default async function MealsPage() {
  const meals = await getMeals();
  return ...
}
```

ì´ë ‡ê²Œ í•˜ê²Œ ë˜ë©´ ë¶ˆí•„ìš”í•œ `fetch / useEffect` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ì„œë„ mealsë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
