## NextJS Core (App router)

### 17. 리액트 서버 컴포넌트 vs 클라이언트 컴포넌트 - 적절한 사용 선택 방법

---

### 📌 서버 컴포넌트 vs 클라이언트 컴포넌트

메인 페이지를 작업한 후에 `<ImageSlideShow />` 를 호출하려고 보니 해당 에러가 뜨는 것을 볼 수 있다.

<img width="950" alt="스크린샷 2024-10-21 오후 2 02 38" src="https://github.com/user-attachments/assets/d462700c-26b9-43d4-9ce7-7b21578e5a93">

이는 컴포넌트에서 `useState` 를 필요로 하는 컴포넌트를 가져오고 있으며 이는 클라이언트 컴포넌트에서만 작동한다.
그러나 부모 중 어떤 것도 `use client` 로 표시되지 않았기 때문에 서버 컴포넌트에 있다고 한다.

#### 이는 무엇을 의미할까?

`server / client` components는 nextjs에서 엄청 중요한 역할을 한다.
nextjs뿐만이 아니라 리액트 또한 자체적으로 구분이 있다. `create react app / vite` 의 도움을 받아 만드는 모든 바닐라 리액트 앱들에서 기본적으로 `클라이언트 컴포넌트` 를 사용한다.

왜냐하면 그런 프로젝트 들에서 `react.js` 는 순수한 클라이언트 사이드 라이브러리로 브라우저에서 `클라이언트 측에서 코드를 실행` 한다.

✅ `nextjs` 에서는 이것이 변경되는데 왜냐하면 `풀스택 프레임워크` 이기 때문이다.

프론트 뿐만아니라 백엔드가 있고, 작업할 때 코드는 백엔드에서도 실행이 된다.

예를 들어 기본적으로 `nextjs` 프로젝트에서 가지고 있는 모든 리액트 컴포넌트들은 `page / layout / components` 등에 상관없이 `오직 서버` 에서만 렌더링 된다.

이것이 `서버 컴포넌트` 라고 불리는 이유이다.

사실상 리액트에 내장된 기능이지만 특정한 뒷단 빌드 프로세스와 구조로 잠겨있어서 리액트 프로젝트의 일부는 아니다. 하지만 `nextjs` 에서는 열려있고, 기본적이다. 따라서 모든 리액트 컴포넌트는 `서버에서` 만 렌더링 된다고 했다.

> ⭐️ 이 말은 현재 기점에서 `layout / header / slideshow ...` 같은 모든 컴포넌트는 `브라우저에서 실행되지 않는다` 는 뜻. 이러한 컴포넌트 함수들은 `서버` 에서 실행된다

![스크린샷 2024-10-21 오후 2 10 58](https://github.com/user-attachments/assets/bbdf1a1f-94f9-4f09-a819-1486d43aac2d)

그렇기 때문에 `MainHeader` 컴포넌트에서 콘솔을 찍어보게 되면 `서버` 쪽에서 출력이 되는 것을 볼 수 있다.

#### 이후의 흥미로운 것

이러한 것들이 `초기 페이지를 로드할 때` 만의 사례가 아닌 이후 `네비게이션` 에도 같다는 것이다. `meals page` 로 넘어가게 되면 meals page에서 찍은 콘솔도 브라우저에서 확인할 수 없다.

✅ 이러한 상황의 이유는 `SPA 모드` 에 있고 움직이고 있더라도 모든 컴포넌트는 아직도 백엔드에서의 서버에 렌더링되고 결국은 클라이언트에 보내지는 완성된 `html` 같은 코드이기 때문이다.

### 📌 nextjs의 컨셉

nextjs는 이러한 서버 컴포넌트를 가지는 이 컨셉을 수용한다. 이것은 중요하고, 장점이다.
왜냐하면 서버 컴포넌트를 사용하면 `다운로드해야하는 클라이언트 측의 자바스크립트 코드` 가 줄어들 수 있어, 웹사이트의 `성능 향상` 에 도움이 되며, `검색엔진 최적화` 에도 도움이 된다.

또한 리액트와 비교해보면 페이지의 소스코드를 보면 본질적으로 비어있음을 알 수 있다. 왜냐하면 모든 내용은 `클라이언트 측 코드 / 클라이언트 측 컴포넌트` 의 도움으로 생성되고 채워지기 때문이다.

✅ `nextjs` 에서는 프로젝트의 상태가 다르게 나타난다. 소스코드를 보면 `모든 컨텐츠` 가 담겨있다. 스크린에 보여지는 모든 텍스트는 `실제 페이지 소스코드의 일부분` 이고 웹 검색엔진 크롤러들이 보는 것들이기도 하다.

> 이것이 중요한 이유이다.

### 📌 nextjs에서의 클라이언트 컴포넌트

nextjs에서도 클라이언트 컴포넌트들을 만들 수 있는데, 그것들은 기술적으로 서버에서 사전 렌더링되는 것들이고, 잠재적으로는 `클라이언트에 렌더링` 될 수 있다.

더 중요하게 이 컴포넌트들은 클라이언트에 무조건 렌더링 되야 하는 것으로 이유는 `클라이언트에만 사용가능한 코드 / 기능` 을 포함하기 때문이다.

예를들어 `useState / useEffect` 같은 훅을 사용하는 컴포넌트들은 서버측에서 사용 불가한다.

```js
useEffect(() => {
  const interval = setInterval(() => {
    setCurrentImageIndex((prevIndex) =>
      prevIndex < images.length - 1 ? prevIndex + 1 : 0
    );
  }, 5000);

  return () => clearInterval(interval);
}, []);
```

> 생각해보면 이해가 되는 이유는 `interval` 같은 간격을 `서버측` 에 설정하는 것에 관심이 있는 것이 아니라 ⭐️ 이 브라우저를 실행해서 `페이지가 로드된 후에` 변경되길 원하기 때문이다.

#### 또 하나의 클라이언트 컴포넌트에서 사용가능한 기능 예시

`eventHandler` 는 `onClick` 속성을 활용하여 몇 가지의 함수를 촉발하면 당연히 여기에서는 어떤 상호자의 `상호작용` 을 기대하고 있기 때문에 `클라이언트 컴포넌트` 가 되어야 한다.

> ✅ `nextjs` 에서의 모든 컴포넌트는 기본적으로 `서버 컴포넌트` 이기 때문에 특별한 지시어를 사용해서 `(use client)` 클라이언트 컴포넌트로 사용하도록 지시해주어야 한다.
