## Fetching

### 06. ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œì»¬ ë°ì´í„° ì†ŒìŠ¤(ë°ì´í„°ë² ì´ìŠ¤)ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸°

---

### ğŸ“Œ ë§ˆì´ê·¸ë ˆì´ì…˜

ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë‰´ìŠ¤ë¥¼ ë°›ì•„ì˜¤ê¸° ì‹œì‘í–ˆìœ¼ë‹ˆ ì „ì²´ `NextJS` ë¥¼ `ë§ˆì´ê·¸ë ˆì´ì…˜` í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë§Œì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ì.

ì¼ë‹¨ `news.js` íŒŒì¼ì€

```jsx
// news.js

// prev
import sql from "better-sqlite3";

const DUMMY_NEWS = [
  {
    id: "n1",
    slug: "will-ai-replace-humans",
    title: "Will AI Replace Humans?",
    image: "ai-robot.jpg",
    date: "2021-07-01",
    content:
      "Since late 2022 AI is on the rise and therefore many people worry whether AI will replace humans. The answer is not that simple. AI is a tool that can be used to automate tasks, but it can also be used to augment human capabilities. The future is not set in stone, but it is clear that AI will play a big role in the future. The question is how we will use it.",
  },
  {
    id: "n2",
    slug: "beaver-plague",
    title: "A Plague of Beavers",
    image: "beaver.jpg",
    date: "2022-05-01",
    content:
      "Beavers are taking over the world. They are building dams everywhere and flooding entire cities. What can we do to stop them?",
  },
  {
    id: "n3",
    slug: "couple-cooking",
    title: "Spend more time together!",
    image: "couple-cooking.jpg",
    date: "2024-03-01",
    content:
      "Cooking together is a great way to spend more time with your partner. It is fun and you get to eat something delicious afterwards. What are you waiting for? Get cooking!",
  },
  {
    id: "n4",
    slug: "hiking",
    title: "Hiking is the best!",
    image: "hiking.jpg",
    date: "2024-01-01",
    content:
      "Hiking is a great way to get some exercise and enjoy the great outdoors. It is also a great way to clear your mind and reduce stress. So what are you waiting for? Get out there and start hiking!",
  },
  {
    id: "n5",
    slug: "landscape",
    title: "The beauty of landscape",
    image: "landscape.jpg",
    date: "2022-07-01",
    content:
      "Landscape photography is a great way to capture the beauty of nature. It is also a great way to get outside and enjoy the great outdoors. So what are you waiting for? Get out there and start taking some pictures!",
  },
];

const db = sql("data.db");

export async function getAllNews() {
  const news = db.prepare("SELECT * FROM news").all();
  await new Promise((resolve) => setTimeout(resolve, 2000));

  return news;
}

export function getLatestNews() {
  return DUMMY_NEWS.slice(0, 3);
}

export function getAvailableNewsYears() {
  return DUMMY_NEWS.reduce((years, news) => {
    const year = new Date(news.date).getFullYear();
    if (!years.includes(year)) {
      years.push(year);
    }
    return years;
  }, []).sort((a, b) => b - a);
}

export function getAvailableNewsMonths(year) {
  return DUMMY_NEWS.reduce((months, news) => {
    const newsYear = new Date(news.date).getFullYear();
    if (newsYear === +year) {
      const month = new Date(news.date).getMonth();
      if (!months.includes(month)) {
        months.push(month + 1);
      }
    }
    return months;
  }, []).sort((a, b) => a - b);
}

export function getNewsForYear(year) {
  return DUMMY_NEWS.filter(
    (news) => new Date(news.date).getFullYear() === +year
  );
}

export function getNewsForYearAndMonth(year, month) {
  return DUMMY_NEWS.filter((news) => {
    const newsYear = new Date(news.date).getFullYear();
    const newsMonth = new Date(news.date).getMonth() + 1;
    return newsYear === +year && newsMonth === +month;
  });
}

// migration
import sql from "better-sqlite3";

const db = sql("data.db");

export async function getAllNews() {
  const news = db.prepare("SELECT * FROM news").all();
  await new Promise((resolve) => setTimeout(resolve, 2000));
  return news;
}

export async function getNewsItem(slug) {
  const newsItem = db.prepare("SELECT * FROM news WHERE slug = ?").get(slug);

  await new Promise((resolve) => setTimeout(resolve, 2000));

  return newsItem;
}

export async function getLatestNews() {
  const latestNews = db
    .prepare("SELECT * FROM news ORDER BY date DESC LIMIT 3")
    .all();
  await new Promise((resolve) => setTimeout(resolve, 2000));
  return latestNews;
}

export async function getAvailableNewsYears() {
  const years = db
    .prepare("SELECT DISTINCT strftime('%Y', date) as year FROM news")
    .all()
    .map((year) => year.year);

  await new Promise((resolve) => setTimeout(resolve, 2000));

  return years;
}

export function getAvailableNewsMonths(year) {
  return db
    .prepare(
      "SELECT DISTINCT strftime('%m', date) as month FROM news WHERE strftime('%Y', date) = ?"
    )
    .all(year)
    .map((month) => month.month);
}

export async function getNewsForYear(year) {
  const news = db
    .prepare(
      "SELECT * FROM news WHERE strftime('%Y', date) = ? ORDER BY date DESC"
    )
    .all(year);

  await new Promise((resolve) => setTimeout(resolve, 2000));

  return news;
}

export async function getNewsForYearAndMonth(year, month) {
  const news = db
    .prepare(
      "SELECT * FROM news WHERE strftime('%Y', date) = ? AND strftime('%m', date) = ? ORDER BY date DESC"
    )
    .all(year, month);

  await new Promise((resolve) => setTimeout(resolve, 2000));

  return news;
}
```

ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ë°©ì‹ê³¼ ë‹¤ë¥´ê²Œ `ë°ì´í„°ë² ì´ìŠ¤` ì— ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•˜ê²Œ í•œë‹¤. ì´ í•¨ìˆ˜ ì¤‘ ëŒ€ë¶€ë¶„ì€ `ì§€ì—° ì‹œê°„` ì´ ì¶”ê°€ë˜ì–´ ìˆì–´ ëŠë¦° ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜ í•  ìˆ˜ ìˆë‹¤.

ëª¨ë“  í˜ì´ì§€ë¥¼ ë‹¤ ì—…ë°ì´íŠ¸ í•´ì£¼ë©´ ë˜ëŠ”ë° ì—¬ê¸°ì„œ í¬ì¸íŠ¸ëŠ” `async / await` ë¥¼ ì‚¬ìš©í•˜ê³  `news.js` ì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ë˜í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°ì— `ì‚¬ìš©ì ê²½í—˜ ê°œì„ ` ì„ ìœ„í•´ì„œ `loading.js` ë¥¼ ì˜ ë§Œë“¤ì–´ì£¼ì–´ í´ë°±ìœ¼ë¡œ í˜¸ì¶œë˜ê²Œ í•˜ë©´ ëœë‹¤.

#### ê¹Œë‹¤ë¡œìš´ ê²½ìš°

```jsx
// app/(content)/news/[slug]/@modal/(.)image/page.js

// prev
"use client";

import { notFound, useRouter } from 'next/navigation';

import { DUMMY_NEWS } from '@/dummy-news';

export default function InterceptedImagePage({ params }) {
  const router = useRouter()

  const newsItemSlug = params.slug;
  const newsItem = DUMMY_NEWS.find(
    (newsItem) => newsItem.slug === newsItemSlug
  );

  if (!newsItem) {
    notFound();
  }

  return (
    <>
      <div className="modal-backdrop" onClick={router.back} />
      <dialog className="modal" open>
        <div className="fullscreen-image">
          <img src={`/images/news/${newsItem.image}`} alt={newsItem.title} />
        </div>
      </dialog>
    </>
  );
}

// migration
import { notFound } from "next/navigation";

import ModalBackdrop from "@/components/modal-backdrop";

export default async function InterceptedImagePage({ params }) {
  const newsItemSlug = params.slug;
  const newsItem = await getNewsItem(newsItemSlug);

  if (!newsItem) {
    notFound();
  }

  return (
    <>
      <ModalBackdrop />
      <dialog className="modal" open>
        <div className="fullscreen-image">
          <img src={`/images/news/${newsItem.image}`} alt={newsItem.title} />
        </div>
      </dialog>
    </>
  );
}
```

`app/(content)/news/[slug]/@modal/(.)image/page.js` í•´ë‹¹ íŒŒì¼ì„ ë³´ê²Œ ë˜ë©´ `use client` ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê³ , ë³´ì´ëŠ” ê²ƒê³¼ ê°™ì´ ì»´í¬ë„ŒíŠ¸ê°€ `í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ì•„ë‹ ê²½ìš°` ì—ë§Œ `async / await` ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

âœ… ì¼ë‹¨ ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°”ê¾¸ë ¤ë©´ `ì™œ ë°˜ë“œì‹œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸` ì—¬ì•¼ í•˜ëŠ”ì§€ ì•Œì•„ì•¼ í•œë‹¤. ì´ëŠ” `useRouter` ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°°ê²½ì„ í´ë¦­í•˜ë©´ ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ë°©ë²•ìœ¼ë¡œ `use client` ë¥¼ ì œê±°í•˜ê³  ì‚¬ìš©í•˜ëŠ” `div` ë¥¼ ë³„ë„ì˜ ì»´í¬ë„ŒíŠ¸ë¡œ ë§Œë“¤ì–´ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
ì´ë¥¼ ìœ„í•´ `components/modal-backdrop.js` íŒŒì¼ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì„œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

ì´í›„ì— í•´ë‹¹ í˜ì´ì§€ì—ì„œ `not found` ì—ëŸ¬ê°€ ë‚˜ì˜¤ëŠ” ì´ìœ ëŠ”
â­ï¸ `ë³‘ë ¬ ë¼ìš°íŠ¸` ì— ëŒ€í•œ ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ê¸° ë•Œë¬¸ì— ë°œìƒí•œë‹¤. ì´ ì˜¤ë¥˜ëŠ” `@modal` í´ë”ì— ìˆëŠ” `page.js` ì˜ ì´ë¦„ì„ `default.js` ë¡œ ë³€ê²½í•¨ìœ¼ë¡œì¨ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

> â­ï¸ ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ ì „ì²´ ì•±ì„ `ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤` ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì´ì „í–ˆìœ¼ë©° ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë¡œë”© ëŒ€ì²´í™”ë©´ì„ ë³´ì—¬ì£¼ë©´ì„œ ê°œì„ í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.
