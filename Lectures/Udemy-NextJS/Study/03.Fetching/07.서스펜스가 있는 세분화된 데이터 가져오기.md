## Fetching

### 07. ì„œìŠ¤íœìŠ¤ê°€ ìˆëŠ” ì„¸ë¶„í™”ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

---

### ğŸ“Œ ì„œìŠ¤íœìŠ¤ê°€ ìˆëŠ” ì„¸ë¶„í™”ëœ ë°ì´í„°

í˜„ì¬ ì•±ì€ ëª‡ê°€ì§€ ì‚¬ì†Œí•œ ë¬¸ì œê°€ ìˆë‹¤.
ê°€ì¥ í° ë¬¸ì œëŠ” `05` ê°™ì€ ë…„ë„ë¥¼ ì„ íƒí–ˆì„ ë•Œ `ëª‡ ì´ˆê°€ ê±¸ë¦¬ëŠ” ë°ì´í„°ê°€ ë¡œë“œ` ë  ë•Œê¹Œì§€ ì•„ë¬´ëŸ° í”¼ë“œë°±ì„ ë°›ì§€ ëª»í•œë‹¤ëŠ” ì ì´ë‹¤.
ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ì•„ë¬´ëŸ° í”¼ë“œë°±ì´ ì—†ìœ¼ë‹ˆ, ì´ìƒí•˜ê²Œ ìƒê°í•  ìˆ˜ë„ ìˆë‹¤.

#### loading.js íŒŒì¼ì´ ìˆìŒì—ë„ ë¡œë”© í”¼ë“œë°±ì„ ë°›ì§€ ëª»í•˜ëŠ” ì´ìœ ê°€ ë¬´ì—‡ì¼ê¹Œ?

í”¼ë“œë°±ì„ ë°›ì§€ ëª»í•˜ëŠ” ì´ìœ ëŠ” `ì›”` ì„ ì„ íƒí•  ë•Œ ì´ë¯¸ ì´ í•„í„° í˜ì´ì§€ì— ìˆê¸° ë•Œë¬¸ì´ê³ , ë”°ë¼ì„œ `ì¼ë¶€ ë°ì´í„°ê°€ ìˆëŠ” ìƒíƒœ` ì´ë¯€ë¡œ ë¡œë”© ëŒ€ì²´ í™”ë©´ìœ¼ë¡œ êµì²´í•˜ì§€ ì•ŠëŠ”ë‹¤.
ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì§€ë§Œ `ì´ë¯¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ ì ` ì´ ìˆê¸° ë•Œë¬¸ì— ë‹¤ì‹œ ë³´ì—¬ì£¼ì§€ ì•ŠëŠ”ê²ƒì´ë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” `loading.js` íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€ì•ˆìœ¼ë¡œ ë” ì„¸ë°€í•œ ë°©ì‹ìœ¼ë¡œ ë¡œë”© ëŒ€ì²´ í™”ë©´ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.

> âœ… ê·¸ ëŒ€ì•ˆì€ `React` ì—ì„œ ì œê³µí•˜ëŠ” `Suspense` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
> ì–´ë–¤ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ì‹¶ì€ì§€, ì–´ë–¤ ìƒí™©ì—ì„œ ë¡œë”© ëŒ€ì²´í™”ë©´ì´ í‘œì‹œë˜ì–´ì•¼ í•˜ëŠ”ì§€ë¥¼ `NextJS` ì— ìì„¸íˆ ì•Œë ¤ì¤„ ìˆ˜ ìˆë‹¤.

#### ì„œìŠ¤íœìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œ?

ì¼ë‹¨ `ë³„ë„ì˜ ì»´í¬ë„ŒíŠ¸` ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ë³„ë„ì˜ íŒŒì¼ / í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ì™€ ê°™ì€ íŒŒì¼ì—ì„œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
ì¼ë‹¨ ê°™ì€ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ìœ ì§€í•´ë³´ì.

```jsx
// [[...filter]]/page.js

async function FilteredNews({ year, month }) {
  let news;
  if (year && !month) {
    news = await getNewsForYear(year);
  } else if (year && month) {
    news = await getNewsForYearAndMonth(year, month);
  }

  let newsContent = <p>No news found for the selected period.</p>;

  if (news && news.length > 0) {
    newsContent = <NewsList news={news} />;
  }

  return newsContent;
}

// ...

<FilteredNews year={selectedYear} month={selectedMonth} />;
```

ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ë¡œì§ì„ ì¡°ê¸ˆ ë°”ê¿”ì„œ ìƒˆë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì. í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ ìœ„ì—ë‹¤ê°€ `FilteredNews` í•¨ìˆ˜ë¥¼ ì„ ì–¸í•´ì„œ ì‚¬ìš©í• ê²ƒì¸ë° ì´ëŠ” `async / await` í•¨ìˆ˜ì—¬ì•¼ í•˜ê³  (ì„œë²„ ì»´í¬ë„ŒíŠ¸ì´ê¸° ë•Œë¬¸) ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ ì»´í¬ë„ŒíŠ¸ë¥¼ `{newsContent}` ê°€ ìˆë˜ ìë¦¬ì— í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤.

ì´ ìƒíƒœì—ì„œë„ ì•„ì§ ë¡œë”© ëŒ€ì²´í™”ë©´ì„ ë³´ì§€ ëª»í•œë‹¤.
ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ì„ ë³„ë„ì˜ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¡œ ì˜®ê²¨ ë¶ˆëŸ¬ì˜¤ê¸° ë•Œë¬¸ì— `ì„œìŠ¤íœìŠ¤ í›…` ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
<Suspense fallback={<p>Loading news...</p>}>
  <FilteredNews year={selectedYear} month={selectedMonth} />
</Suspense>
```

`Suspense` ëŠ” í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆëŠ”ì§€ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  `fallback` ìœ¼ë¡œ ëŒ€ì²´ í™”ë©´ì„ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.
`loading.js` ì‚¬ìš©ì‹œì—ëŠ” ì„¸ë°€í•˜ì§€ ëª»í–ˆëŠ”ë° ì´ `loading.js` ë¥¼ ì‚¬ìš©í•˜ë©´ ì „ì²´ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°ì—ë§Œ ëŒ€ì²´ í™”ë©´ìœ¼ë¡œ êµì²´ë˜ëŠ”ë°, `ì„œìŠ¤íœìŠ¤` ê²½ê³„ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ ë§¤ìš° ì„¸ë°€í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

<img width="741" alt="Image" src="https://github.com/user-attachments/assets/38080cbc-7b28-4671-adc3-3caff7d963c5" />

ì‹¤ì œë¡œ `month` ë¥¼ í´ë¦­í•´ë³´ë©´ ë¡œë”©ì¤‘ì´ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
ì´ëŠ” `month` ë¥¼ í´ë¦­í•  ë•Œ í˜ì´ì§€ë¥¼ `ë‹¤ì‹œ ë Œë”ë§` í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ë£¨íŠ¸ ë§¤ê°œë³€ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê²Œ ë˜ëŠ”ê²ƒì´ë‹¤.

`header` ë˜í•œ ì„œìŠ¤íœìŠ¤ë¡œ ë˜í•‘í•  ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë˜ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆê³ , ë³„ë„ì˜ íŒŒì¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ê·¸ëƒ¥ í•´ë‹¹ í˜ì´ì§€ì—ì„œ ìœ ì§€í•´ì„œ ì§„í–‰.

```jsx
<>
  <Suspense fallback={<p>loading filter...</p>}>
    <FilterHeader year={selectedYear} month={selectedMonth} />
  </Suspense>
  <Suspense fallback={<p>Loading news...</p>}>
    <FilteredNews year={selectedYear} month={selectedMonth} />
  </Suspense>
</>
```

ë¶„ë¦¬ë¥¼ í•˜ê²Œ ë˜ë©´ ì´ëŸ° í˜•íƒœê°€ ë˜ëŠ”ë°, ê° ê²½ê³„ëŠ” ë°ì´í„°ê°€ ì¤€ë¹„ë˜ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ê³  ì¤€ë¹„ë ë•Œê¹Œì§€ëŠ” ëŒ€ì²´ í™”ë©´ì„ ë³´ì—¬ì¤€ë‹¤.

ì´ì œ í•„í„°ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ê°ê° ë¡œë”©ë˜ëŠ” í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.
ë‘ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ì— ëŒ€í•´ `í•˜ë‚˜ì˜ ì„œìŠ¤íœìŠ¤ ê²½ê³„` ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.

ì¼ë‹¨ì€ ê°ê°ì˜ ì„œìŠ¤íœìŠ¤ë¥¼ ë†”ë‘ê³  ë§ˆë¬´ë¦¬.

#### ìµœì¢… ì½”ë“œ

```jsx
// app/(content)/archive/@archive/[[...filter]]/page.js
import Link from "next/link";

import NewsList from "@/components/news-list";
import {
  getAvailableNewsMonths,
  getAvailableNewsYears,
  getNewsForYear,
  getNewsForYearAndMonth,
} from "@/lib/news";
import { Suspense } from "react";

async function FilterHeader({ year, month }) {
  const availableYears = await getAvailableNewsYears();
  let links = availableYears;

  if (
    (year && !availableYears.includes(year)) ||
    (month && !availableYears.includes(month))
  ) {
    throw new Error("Invalid filter.");
  }

  if (year && !month) {
    links = getAvailableNewsMonths(year);
  }

  if (year && month) {
    links = [];
  }

  return (
    <header id="archive-header">
      <nav>
        <ul>
          {links.map((link) => {
            const href = year ? `/archive/${year}/${link}` : `/archive/${link}`;

            return (
              <li key={link}>
                <Link href={href}>{link}</Link>
              </li>
            );
          })}
        </ul>
      </nav>
    </header>
  );
}

async function FilteredNews({ year, month }) {
  let news;
  if (year && !month) {
    news = await getNewsForYear(year);
  } else if (year && month) {
    news = await getNewsForYearAndMonth(year, month);
  }

  let newsContent = <p>No news found for the selected period.</p>;

  if (news && news.length > 0) {
    newsContent = <NewsList news={news} />;
  }

  return newsContent;
}

export default async function FilteredNewsPage({ params }) {
  const filter = params.filter;

  const selectedYear = filter?.[0];
  const selectedMonth = filter?.[1];

  return (
    <>
      <Suspense fallback={<p>loading filter...</p>}>
        <FilterHeader year={selectedYear} month={selectedMonth} />
      </Suspense>
      <Suspense fallback={<p>Loading news...</p>}>
        <FilteredNews year={selectedYear} month={selectedMonth} />
      </Suspense>
    </>
  );
}
```
