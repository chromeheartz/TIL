## Express.js

### 03. 미들웨어 작동 방식

---

### 📌 미들웨어 작동 방식

미들웨어는 Express 프레임워크의 필수적인 개념이며 응답을 보내지 않으면 `next` 를 호출해야 한다. 그러지 않으면 요청이 실패하고 다음 미들웨어로 이어지지 않는다.

`res.send` 로 응답전송을 쉽게 할 수 있는데 이렇게 하는 대신에 `유틸리티 함수` 를 사용할 수도 있다.

#### send

`send` 를 사용해서 응답을 보낼 수 있다.
`any` 유형의 본문을 첨부할 수 있다.
`res.send("<h1>Hello from Express!</h1>");` 이렇게하고 응답을 보낸 뒤에 `Network` 탭을 살펴보면 `Headers` 에서 `Content-type` 이 `text/html` 으로 되어있음을 볼 수 있다.

![](https://velog.velcdn.com/images/chromeheartz/post/6429ecf3-bc50-4c44-b49e-8730f7fed2df/image.png)

기본적으로 `send` 메소드는 `html 콘텐츠 유형` 을 선택해준다. `setHeader` 를 사용해서 수동으로 설정할 수도 있다. 언제든 `Express.js` 의 기본값을 무시할 수 있지만 기본 응답 헤더는 `text/html` 이다.
따라서 `next` 를 호출하지 않고 있음에도 더 이상 요청 실패가 없음을 볼 수 있다.
대신 `send` 로 응답을 보낸다. 당연히 `write` 메소드를 사용하는 것보다 쉽고, 앞으로 실제 파일이나 파일 내용을 전송하기 시작하면 특히 더 쉬워진다.

> ✅ **미들웨어의 기본 개념**
> 요청이 통과하는 퍼널(funnel)에 연결된 기능을 추가하고 next로 다음 미들웨어로 넘어가거나 응답을 보내게 된다. next를 호출하는 대신 응답을 전송하면 미들웨어는 도달하지 못하게 되고, next를 호출해서 위에서 아래로 미들웨어 사이를 이동할 수 있다.
