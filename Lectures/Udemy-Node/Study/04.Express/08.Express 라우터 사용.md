## Express.js

### 08. Express 라우터 사용

---

### 📌 Express 라우터 사용

지금까지 본 것이 `Express.js` 의 핵심 개념이다.
이후에 `Express.js` 의 작동 원리를 기반으로 진행되기 때문에 이는 매우 중요한 모듈이다.
매우 간단한 더미앱이긴 하지만, 모든 코드를 현재처럼 `app.js` 파일에 기록하게 되면 규모가 커졌을때 문제가 될 수 있다.

그래서 일반적으로는 `라우팅 코드` 를 여러 파일로 나누는 것이 좋다.
로직을 여러 파일로 내보내서 파일로 임포트 할 수 있다. 이는 충분히 가능한 일로 함수를 내보낼 파일을 직접 만들 수도 있지만 `Express.js` 는 라우팅을 다른 파일에 위탁하는 편리한 방법을 제공한다.

이를 위해 폴더 구조를 약간 변경하자.`route` 라는 이름의 새로운 폴더를 생성.
다른 이름으로 만들어도 되지만 `관행` 같은 것이다.
다양한 경로와 `http` 메소드에 대해 실행할 라우팅 관련 코드를 파일에 담아서 해당 폴더에 저장해보자.

현재 `온라인 매장 구현` 을 목표로 하고 있으므로 `admin.js` 를 만들어서 매장 관리자가 담당하게 될 제품 생성을 처리하는 라우팅 파일을 직관적으로 만들어보자.
또한 `shop.js` 를 만들어서 여기에는 사용자가 보게 될 내용을 담자.

기존에 `app.js` 에서 만들어주었던 경로들을 파일에 맞게 옮겨주자.
이후에 `Express.js` 에서 제공하는 편리한 기능을 사용하기 위해 `express` 를 임포트해주고, `Router` 라는 기능을 만들어서 사용해보자. 이름은 맘대로해도 되고, `express.router` 를 호출해서 객체로 넣어주면 된다.

```node
// admin.js

const express = require("express");

const router = express.Router();

router.get("/add-product", (req, res, next) => {
  console.log("In another middleware!");
  res.send(
    '<form action="/product" method="POST"><input type="text" name="title"><button type="submit">Add Product</button></input></form>',
  );
});

router.post("/product", (req, res, next) => {
  console.log(req.body);
  res.redirect("/");
});

module.exports = router;
```

이 라우터는 다른 `Express` 앱에 연결되어 있거나 꽂아넣을 수 있는 앱과 같으며 내보낼 수 있다.
라우트를 등록한 객체를 내보냈으니 동일한 기능을 수행하므로 그대로 사용할 수 있다.
상품을 추가하고 폼을 회신하는 데는 `get` 요청만을 처리하고자 함으로 `get` 으로 바꾸고 진행하자. 이제 `app.js` 에 `express` 와 분리된 임포트를 위에 추가해준다.
`adminRoutes` 라는 이름으로 해서 상대 경로로 가져온다.

```node
// app.js
const express = require("express");
const adminRoutes = require("./routes/admin.js");
const shopRoutes = require("./routes/shop.js");
const bodyParser = require("body-parser");

const app = express();

app.use(bodyParser.urlencoded({ extended: false }));
app.use(adminRoutes);
app.use(shopRoutes);

app.listen(3000);
```

이렇게 가져와서 `app.use` 에 등록해주면 된다. 호출하지 않고 괄호 없이 객체 자체를 입력하면 된다. 이제 미들웨어를 통해 요청을 처리할 때 자동으로 admin.js 파일의 라우트를 고려하게 된다.

순서가 중요한데, `/` 같은 미들웨어 후에 두면 절대 도달하지 못한다.
이제 전처럼 모든 http 메소드를 처리하는 `use` 가 아니기 때문에 라우터를 통해서 매칭된다.
따라서 무작위 경로를 입력하면 오류가 발생한다. 이를 처리할 단일 미들웨어가 존재하지 않기 때문이다.
