## Express.js

### 06. 수신 요청 분석

---

### 📌 수신 요청 분석

이제 들어오는 요청을 실제로 어떻게 처리하고 데이터를 추출하는지 알아보자.
이를 위해 `POST` 요청을 처리할 수 있어야 한다.

`/add-product` 라는 주소로 POST를 보내기 위해 `form` 이 포함된 html코드를 작성해주고 method랑 action을 적어준다.

```node.js
app.use("/add-product", (req, res, next) => {
  console.log("In another middleware!");
  res.send('<form action="/product" method="POST"><input type="text" name="title"><button type="submit">Add Product</button></input></form>');
});
```

이제 `product` 요청을 처리할 `라우트 / 미들웨어` 가 필요하기 때문에 `app.use('/product')` 를 입력한다.
중요한 점은 이를 이 미들웨어 `전 / 후` 어디에 두어도 충돌하지 않는다.
또한 `세 인수` 를 받는 함수가 있는데, 사용할 계획이 없다면 생략해도 된다.

이 안에서 리다이렉트를 하려 하고, 들어오는 데이터를 콘솔에 기록해보자.
`res.redirect` 를 사용하자. 수동으로 상태 코드를 설정하고 위치 헤더를 설정하는 것보다 확실히 쉽다.`redirect` 에 /를 입력하면 자동으로 /경로로 리다이렉트 된다.

그냥 리다이렉트 되는것뿐만 아니라 들어오는 요청의 본문에도 관심을 두어야 한다. 사용자가 보낸 내용을 추출하도록 `console.log(req.body)` 로 확인을 해보자.
리다이렉트로 잘 동작하는데 콘솔에는 `undefined` 가 표시된다.

`req.` 가 본문에 편의 속성을 주지만 기본적으로 `req.` 는 들어오는 요청의 `본문을 분석하려 하지 않는다` 이를 위해 분석기를 등록해야 하는데 또 다른 미들웨어를 추가해서 구현해야 한다.
이는 일반적으로 경로 처리 미들웨어 이전에 두는데 요청이 어디로 향하든 본문 분석이 이루어지도록 하기 위해서이다.

따라서 `npm install --save` 를 실행해서 `body-parser` 를 설치한다
사실 이는 `Express` 에 기본적으로 추가 되어 있다.
이 패키지가 향후에 Express에서 빠지더라도 현재같은 방식으로 추가해주면 된다. `bodyParser` 라는 상수에 저장해서 패키지를 불러온다.

해당 객체를 사용하고 `.urlencoded` 를 입력하면 된다.
이는 실행해야 하는 함수로 옵션을 입력해 설정할 수 있지만 현재는 그럴 필요가 없다.
`app.use(bodyParser.urlencoded({ extended: false }));` 이렇게 해주면 미들웨어를 등록하는데, `urlencoded` 는 마지막에 `(req, res, next) => {}` 같은형태를 내놓게 된다.

눈에 보이지는 않더라도 이 패키지는 최종적으로 `next` 를 호출해서 요청이 미들웨어에 도달하도록 해준다. 하지만 그 이전에 `본문 분석` 을 수행한다.
물론 `파일, json` 등의 가능한 모든 본문을 분석해주지는 않는다. 그러나 현재같이 `폼` 을 통해 전송된 본문은 분석해준다.

`extended: false` 로 설정해서 설정옵션을 입력한다. 이는 `비표준 대산의 분석이 가능한지` 를 나타낸다.

![](https://velog.velcdn.com/images/chromeheartz/post/b8717872-a7dd-488d-bd3a-3d7f6c4b8bc6/image.png)

이제 /add-product 에서 확인을 해보면 `키-값` 쌍이 있는 JS객체를 얻게 ㄷ괸다.
`split` 함수를 사용하고 수동으로 배열을 만드는 등의 방식보다 더 쉽게 값을 추출할 수 있다.

> 이는 이전의 맞춤식 접근법에 비해 훨씬 더 간단하다.
> 이제 사용자들이 전송하는 데이터를 처리할 수 있고 데이터베이스에 저장할 수 있으며 응답을 보여주는 등 원하는 작업을 할 수 있다.

#### ✅ 지금은 들어오는 모든 요청에 대해서 실행된다. 하지만 `POST` 요청에만 하려면 어떻게 할까?
