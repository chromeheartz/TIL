## Dynamic Contents & Template Engine

### 01. 요청 및 사용자 간의 데이터 공유

---

### 📌 요청 및 사용자 간의 데이터 공유

현재까지는 정적 콘텐츠를 회신하는 방법만 보았다.
이제 데이터에 집중해보자. 아직은 앱에 데이터를 많이 다루고 있지 않다. `admin.js` 에서 호스트 경로를 위한 제품의 데이터가 있긴 하지만, 콘솔에 로그로 남긴것 뿐이지 저장해서 작업하고 있지는 않다.
게다가 데이터를 영구적으로 저장할 수 있는 데이터베이스가 없기 때문에 작업하기 힘들것이다.

대신 `Javscript` 변수에 저장해서 여러 사용자로부터 들어오는 요청 간 공유되는지 확인해볼 수 있다.
하지만 대개 이런 데이터를 공유하기를 원하지는 않을것이다. 추후 영구적인 데이터베이스에 기반한 솔루션을 보기 전에 변수에 저장하는 방법을 확인해보자.

현재 `POST` 요청으로 들어오는 `req.body` 의 제품명을 영구적인 장소에 저장해야 한다고 가정해보자. 보통 제품에 몇 가지 필드를 추가하겠지만 일단은 `제품명` 만 먼저 작업해보자.

`console.log(req.body)` 를 확인해보면 사용자가 입력한 `key, value` 가 있는 객체가 나온다.

#### 이 객체를 어떻게 저장할 수 있을까

일단 저장할 변수를 추가해야 한다.
`admin.js` 에 변수를 추가한뒤에 새로운 상수로 `products` 배열을 만든다.
상수이기는 하지만 배열 자체는 같은 객체이기 때문에 새로운 요소를 받을 수 있다.
요소를 추가하거나 제거해도 전체적인 객체에는 영향이 없다. 이제 이것을 `exports.products = products` 로 내보내준다.

내보내는 방식을 바꾸어주었기 때문에 `app.use('/admin', adminData.routes);` 로 app.js구문도 바꾸어야 한다.

> ✅ `module.exports = router` 방식으로 하면 하나만 내보낼 수 있고,
> exports.routes = router;
> exports.products = products;
> 해당 방식으로 다중 객체를 내보낼 수 있다.

이제 `router.post` 부분에서 `products.push` 로 배열에 새로운 객체를 추가할 수 있다.
객체 자체를 푸시해도 되지만, 나중에 필드를 추가할거라 새로운 객체를 만들어서 추가해준다.

```js
router.post("/add-product", (req, res, next) => {
  products.push({ title: req.body.title });
  res.redirect("/");
});
```

이렇게 하고 `shop.js` 에서 `get` 요청으로 들어올때 `adminData.products` 를 확인하게 되면 추가한 객체가 제대로 들어오는 것을 볼 수 있다.

```js
// shop.js
router.get("/", (req, res, next) => {
  console.log("shop.js", adminData.products);
  res.sendFile(path.join(rootDir, "views", "shop.html"));
});
```

이렇게 하면 데이터가 공유된다. 하지만 한 가지 단점이 있어 추후에는 다른 방법을 사용할것이다.
실행 중인 노드 서버에 내재된 데이터에서 사용자간에 공유된다는 뜻인데, 모든 사용자의 요청에 같은 데이터가 겹쳤다고 하면 괜찮겠지만 요청 간 혹은 사용자 간 데이터를 공유하는 것을 피하는 것이 좋다.

사용자 A가 변경 사항을 만들면 원하지 않더라도 사용자 B에게 노출될 수 있기 때문이다.
아직 데이터베이스에 저장되어있지 않은 상태에서 다른 사용자에게 데이터를 보여주면 안된다. 개인정보일 수도 있기 때문.

여기까지는 패턴이고, 추후 Node.js앱의 메모리에 있는 데이터를 공유하는 기술을 확인해보자.
이때 데이터는 한 사용자의 여러 요청간에 공유되는 것이지, 지금처럼 요청 및 사용자 간에 공유되지는 않는다.
